{
  "version": "1.0",
  "description": "Contract for the business identification flow",
  "endpoints": {
    "identify": {
      "method": "POST",
      "path": "/vc/identify",
      "description": "Initial business identification with minimal data",
      "request_schema": {
        "type": "object",
        "required": ["business_name", "address_or_city", "consent"],
        "properties": {
          "business_name": {
            "type": "string",
            "minLength": 2,
            "maxLength": 100,
            "description": "Name of the business"
          },
          "address_or_city": {
            "type": "string", 
            "minLength": 2,
            "maxLength": 200,
            "description": "Full address or city for geocoding"
          },
          "website": {
            "type": "string",
            "format": "uri",
            "description": "Optional business website URL"
          },
          "instagram": {
            "type": "string",
            "description": "Instagram handle or URL"
          },
          "facebook": {
            "type": "string", 
            "description": "Facebook page URL"
          },
          "consent": {
            "type": "object",
            "required": ["analytics"],
            "properties": {
              "analytics": {
                "type": "boolean",
                "description": "Consent for analysis and email report"
              },
              "marketing": {
                "type": "boolean",
                "description": "Optional consent for marketing communications"
              }
            }
          },
          "utm_source": {"type": "string"},
          "utm_medium": {"type": "string"},
          "utm_campaign": {"type": "string"},
          "utm_content": {"type": "string"},
          "ref": {"type": "string"},
          "partner": {"type": "string"}
        }
      },
      "response_schema": {
        "type": "object",
        "required": ["candidates", "normalized_query", "tracking_id"],
        "properties": {
          "candidates": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["name", "address", "place_id", "confidence"],
              "properties": {
                "name": {"type": "string"},
                "address": {"type": "string"},
                "place_id": {"type": "string"},
                "confidence": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 1
                },
                "category": {"type": "string"},
                "phone": {"type": "string"},
                "website": {"type": "string"}
              }
            }
          },
          "normalized_query": {
            "type": "string",
            "description": "Normalized search query used"
          },
          "tracking_id": {
            "type": "string",
            "description": "Session tracking identifier"
          }
        }
      }
    },
    "confirm": {
      "method": "POST", 
      "path": "/vc/identify/confirm",
      "description": "Confirm business selection and get teaser result",
      "request_schema": {
        "type": "object",
        "required": ["tracking_id", "place_id"],
        "properties": {
          "tracking_id": {"type": "string"},
          "place_id": {"type": "string"},
          "email": {
            "type": "string",
            "format": "email",
            "description": "Email for full report (triggers DOI)"
          }
        }
      },
      "response_schema": {
        "$ref": "teaser_result.json#/schema"
      }
    }
  },
  "rate_limits": {
    "identify": {
      "requests_per_minute": 30,
      "requests_per_hour": 100
    },
    "confirm": {
      "requests_per_minute": 20,
      "requests_per_hour": 60
    }
  },
  "error_responses": {
    "400": {
      "invalid_business_name": "Business name is required and must be at least 2 characters",
      "invalid_location": "Location is required and must be at least 2 characters", 
      "invalid_consent": "Analytics consent is required",
      "invalid_email": "Valid email address is required for full report"
    },
    "429": {
      "rate_limited": "Too many requests. Please try again later."
    },
    "500": {
      "geocoding_failed": "Unable to process location. Please try a different format.",
      "analysis_failed": "Analysis temporarily unavailable. Please try again."
    }
  },
  "caching_strategy": {
    "candidates_cache_ttl": "24h",
    "competitor_set_ttl": "7d", 
    "benchmark_data_ttl": "24h"
  },
  "style": {
    "tone_preferences": {
      "formality": "neutral|casual|professional",
      "empathy": "low|medium|high",
      "directness": "low|medium|high",
      "brevity": "short|medium|long"
    },
    "audience_profile": {
      "gender_pref": "unspecified|female|male",
      "time_pressure": "low|medium|high"
    },
    "rules": [
      "Nutze inklusive, respektvolle Sprache; vermeide Stereotype.",
      "Erkläre Fachbegriffe in einfacher Sprache, wenn 'profi' nicht aktiv ist.",
      "Gib konkrete, umsetzbare Handlungsvorschläge mit Nutzen-Hinweis in Euro.",
      "Im Invisible-UI-Kontext: liefere 1–2 kurze Antworten, dann 3–5 Follow-ups."
    ]
  }
}