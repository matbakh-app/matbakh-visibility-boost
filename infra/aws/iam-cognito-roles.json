{
  "CognitoLambdaExecutionRole": {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Effect": "Allow",
        "Principal": {
          "Service": "lambda.amazonaws.com"
        },
        "Action": "sts:AssumeRole"
      }
    ]
  },
  "CognitoTriggerPolicy": {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Sid": "BasicLambdaExecution",
        "Effect": "Allow",
        "Action": [
          "logs:CreateLogGroup",
          "logs:CreateLogStream",
          "logs:PutLogEvents"
        ],
        "Resource": "arn:aws:logs:eu-central-1:*:*"
      },
      {
        "Sid": "CognitoUserManagement",
        "Effect": "Allow",
        "Action": [
          "cognito-idp:AdminUpdateUserAttributes",
          "cognito-idp:AdminGetUser",
          "cognito-idp:AdminSetUserPassword",
          "cognito-idp:AdminConfirmSignUp"
        ],
        "Resource": "arn:aws:cognito-idp:eu-central-1:*:userpool/*"
      },
      {
        "Sid": "SecretsManagerAccess",
        "Effect": "Allow",
        "Action": [
          "secretsmanager:GetSecretValue"
        ],
        "Resource": "arn:aws:secretsmanager:eu-central-1:*:secret:matbakh/*"
      },
      {
        "Sid": "SESEmailSending",
        "Effect": "Allow",
        "Action": [
          "ses:SendEmail",
          "ses:SendRawEmail"
        ],
        "Resource": [
          "arn:aws:ses:eu-central-1:*:identity/matbakh.app",
          "arn:aws:ses:eu-central-1:*:identity/noreply@matbakh.app"
        ]
      },
      {
        "Sid": "CloudWatchLogsAccess",
        "Effect": "Allow",
        "Action": [
          "logs:CreateLogGroup",
          "logs:CreateLogStream",
          "logs:PutLogEvents",
          "logs:DescribeLogGroups",
          "logs:DescribeLogStreams"
        ],
        "Resource": [
          "arn:aws:logs:eu-central-1:*:log-group:/aws/lambda/matbakh-cognito-*",
          "arn:aws:logs:eu-central-1:*:log-group:/aws/lambda/matbakh-cognito-audit",
          "arn:aws:logs:eu-central-1:*:log-group:/aws/lambda/matbakh-cognito-errors"
        ]
      }
    ]
  },
  "PostConfirmationAdditionalPolicy": {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Sid": "RDSDataAccess",
        "Effect": "Allow",
        "Action": [
          "rds-data:ExecuteStatement",
          "rds-data:BatchExecuteStatement",
          "rds-data:BeginTransaction",
          "rds-data:CommitTransaction",
          "rds-data:RollbackTransaction"
        ],
        "Resource": "arn:aws:rds:eu-central-1:*:cluster:matbakh-prod"
      },
      {
        "Sid": "VPCNetworkAccess",
        "Effect": "Allow",
        "Action": [
          "ec2:CreateNetworkInterface",
          "ec2:DescribeNetworkInterfaces",
          "ec2:DeleteNetworkInterface",
          "ec2:AttachNetworkInterface",
          "ec2:DetachNetworkInterface"
        ],
        "Resource": "*"
      }
    ]
  }
}