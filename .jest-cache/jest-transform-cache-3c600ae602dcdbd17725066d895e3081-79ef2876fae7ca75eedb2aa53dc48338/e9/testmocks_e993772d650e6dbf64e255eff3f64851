63a31f951997f78c2b5eef5eb537ffe9
"use strict";
/**
 * Test Mocks for Unified AI API
 *
 * Provides complete mock implementations for all dependencies
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.createTimeoutMock = exports.setupUnifiedAiMocks = exports.createRouterGatewayMock = exports.createMultiProviderMock = exports.createProviderAdapterMock = exports.createFeatureFlagsMock = exports.createCircuitBreakerMock = exports.createCacheMock = exports.createMonitorMock = void 0;
const globals_1 = require("@jest/globals");
/**
 * Create monitor mock
 */
const createMonitorMock = () => ({
    recordError: globals_1.jest.fn().mockResolvedValue(void 0),
    recordSuccess: globals_1.jest.fn().mockResolvedValue(void 0),
    recordAttempt: globals_1.jest.fn().mockResolvedValue(void 0),
    recordCacheHit: globals_1.jest.fn().mockResolvedValue(void 0),
    recordLatency: globals_1.jest.fn().mockResolvedValue(void 0),
    recordHealthCheck: globals_1.jest.fn().mockResolvedValue(void 0),
    getHealth: globals_1.jest.fn().mockResolvedValue({ providers: [] }),
    getProviderMetrics: globals_1.jest.fn().mockResolvedValue({
        averageLatency: 500,
        errorRate: 0.02,
    }),
    shutdown: globals_1.jest.fn().mockResolvedValue(void 0),
});
exports.createMonitorMock = createMonitorMock;
/**
 * Create cache mock
 */
const createCacheMock = () => ({
    get: globals_1.jest.fn().mockResolvedValue(undefined),
    set: globals_1.jest.fn().mockResolvedValue(void 0),
    clear: globals_1.jest.fn().mockResolvedValue(void 0),
});
exports.createCacheMock = createCacheMock;
/**
 * Create circuit breaker mock
 */
const createCircuitBreakerMock = () => ({
    getState: globals_1.jest.fn().mockReturnValue("closed"),
    isOpen: globals_1.jest.fn().mockReturnValue(false),
    recordSuccess: globals_1.jest.fn(),
    recordFailure: globals_1.jest.fn(),
    reset: globals_1.jest.fn(),
    execute: globals_1.jest.fn().mockImplementation(async (operation) => {
        return await operation();
    }),
});
exports.createCircuitBreakerMock = createCircuitBreakerMock;
/**
 * Create feature flags mock
 */
const createFeatureFlagsMock = () => ({
    isProviderEnabled: globals_1.jest.fn().mockResolvedValue(true),
    setProviderEnabled: globals_1.jest.fn().mockResolvedValue(void 0),
});
exports.createFeatureFlagsMock = createFeatureFlagsMock;
/**
 * Create provider adapter mock
 */
const createProviderAdapterMock = (provider) => ({
    name: provider,
    generateResponse: globals_1.jest.fn().mockResolvedValue({
        content: `Mock response from ${provider}`,
        provider,
        requestId: "mock-request-id",
        processingTime: 500,
        success: true,
    }),
    testConnection: globals_1.jest.fn().mockResolvedValue({ success: true }),
    healthCheck: globals_1.jest.fn().mockResolvedValue(void 0),
});
exports.createProviderAdapterMock = createProviderAdapterMock;
/**
 * Create multi-provider integration mock
 */
const createMultiProviderMock = () => ({
    routeRequest: globals_1.jest.fn().mockResolvedValue({
        content: "Mock multi-provider response",
        provider: "bedrock",
        requestId: "mock-request-id",
        processingTime: 500,
        success: true,
    }),
    getProviderHealth: globals_1.jest.fn().mockResolvedValue([
        {
            provider: "bedrock",
            status: "healthy",
            latency: 500,
            errorRate: 0.01,
            lastCheck: new Date(),
            circuitBreakerState: "closed",
        },
    ]),
    updateProviderConfig: globals_1.jest.fn(),
});
exports.createMultiProviderMock = createMultiProviderMock;
/**
 * Create router gateway mock
 */
const createRouterGatewayMock = () => ({
    execute: globals_1.jest.fn().mockResolvedValue({
        provider: "bedrock",
        modelId: "claude-3-5-sonnet",
        text: "Mock router response",
        latencyMs: 500,
        costEuro: 0.01,
        success: true,
        requestId: "mock-request-id",
    }),
    getAvailableModels: globals_1.jest.fn().mockReturnValue([]),
    updateModelCapability: globals_1.jest.fn(),
});
exports.createRouterGatewayMock = createRouterGatewayMock;
/**
 * Setup all mocks for unified AI API tests
 */
const setupUnifiedAiMocks = () => {
    const monitor = (0, exports.createMonitorMock)();
    const cache = (0, exports.createCacheMock)();
    const circuitBreakers = new Map();
    const featureFlags = (0, exports.createFeatureFlagsMock)();
    const multiProvider = (0, exports.createMultiProviderMock)();
    const router = (0, exports.createRouterGatewayMock)();
    // Setup circuit breakers for each provider
    ["bedrock", "google", "meta"].forEach((provider) => {
        circuitBreakers.set(provider, (0, exports.createCircuitBreakerMock)());
    });
    return {
        monitor,
        cache,
        circuitBreakers,
        featureFlags,
        multiProvider,
        router,
    };
};
exports.setupUnifiedAiMocks = setupUnifiedAiMocks;
/**
 * Mock timeout promise for testing
 */
const createTimeoutMock = (timeoutMs) => {
    return new Promise((_, reject) => {
        setTimeout(() => {
            reject(new Error(`Request timeout after ${timeoutMs}ms`));
        }, timeoutMs);
    });
};
exports.createTimeoutMock = createTimeoutMock;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hdGJha2gtdmlzaWJpbGl0eS1ib29zdC4yMDI1MDkyMC9zcmMvbGliL2FpLW9yY2hlc3RyYXRvci90ZXN0LW1vY2tzLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7OztHQUlHOzs7QUFFSCwyQ0FBcUM7QUF1RHJDOztHQUVHO0FBQ0ksTUFBTSxpQkFBaUIsR0FBRyxHQUFjLEVBQUUsQ0FBQyxDQUFDO0lBQ2pELFdBQVcsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDaEQsYUFBYSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNsRCxhQUFhLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2xELGNBQWMsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDbkQsYUFBYSxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNsRCxpQkFBaUIsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdEQsU0FBUyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLFNBQVMsRUFBRSxFQUFFLEVBQUUsQ0FBQztJQUN6RCxrQkFBa0IsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUM7UUFDOUMsY0FBYyxFQUFFLEdBQUc7UUFDbkIsU0FBUyxFQUFFLElBQUk7S0FDaEIsQ0FBQztJQUNGLFFBQVEsRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUM7Q0FDOUMsQ0FBQyxDQUFDO0FBYlUsUUFBQSxpQkFBaUIscUJBYTNCO0FBRUg7O0dB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Q0FBQyxRQUFRLEVBQUUsRUFBRTtRQUNqRSxlQUFlLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxJQUFBLGdDQUF3QixHQUFFLENBQUMsQ0FBQztJQUM1RCxDQUFDLENBQUMsQ0FBQztJQUVILE9BQU87UUFDTCxPQUFPO1FBQ1AsS0FBSztRQUNMLGVBQWU7UUFDZixZQUFZO1FBQ1osYUFBYTtRQUNiLE1BQU07S0FDUCxDQUFDO0FBQ0osQ0FBQyxDQUFDO0FBckJXLFFBQUEsbUJBQW1CLHVCQXFCOUI7QUFFRjs7R0FFRztBQUNJLE1BQU0saUJBQWlCLEdBQUcsQ0FBQyxTQUFpQixFQUFFLEVBQUU7SUFDckQsT0FBTyxJQUFJLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsRUFBRTtRQUMvQixVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ2QsTUFBTSxDQUFDLElBQUksS0FBSyxDQUFDLHlCQUF5QixTQUFTLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDNUQsQ0FBQyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQ2hCLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDO0FBTlcsUUFBQSxpQkFBaUIscUJBTTVCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXRiYWtoLXZpc2liaWxpdHktYm9vc3QuMjAyNTA5MjAvc3JjL2xpYi9haS1vcmNoZXN0cmF0b3IvdGVzdC1tb2Nrcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRlc3QgTW9ja3MgZm9yIFVuaWZpZWQgQUkgQVBJXG4gKlxuICogUHJvdmlkZXMgY29tcGxldGUgbW9jayBpbXBsZW1lbnRhdGlvbnMgZm9yIGFsbCBkZXBlbmRlbmNpZXNcbiAqL1xuXG5pbXBvcnQgeyBqZXN0IH0gZnJvbSBcIkBqZXN0L2dsb2JhbHNcIjtcbmltcG9ydCB7IFByb3ZpZGVyIH0gZnJvbSBcIi4vdHlwZXNcIjtcblxuLy8gTW9uaXRvciBJbnRlcmZhY2VcbmV4cG9ydCBpbnRlcmZhY2UgQWlNb25pdG9yIHtcbiAgcmVjb3JkRXJyb3IoZXJyOiBFcnJvciwgbWV0YT86IGFueSk6IFByb21pc2U8dm9pZD47XG4gIHJlY29yZFN1Y2Nlc3MobWV0YT86IGFueSk6IFByb21pc2U8dm9pZD47XG4gIHJlY29yZEF0dGVtcHQ/KFxuICAgIHByb3ZpZGVyOiBzdHJpbmcsXG4gICAgbGF0ZW5jeU1zOiBudW1iZXIsXG4gICAgc3VjY2VzczogYm9vbGVhblxuICApOiBQcm9taXNlPHZvaWQ+O1xuICByZWNvcmRDYWNoZUhpdD8oKTogUHJvbWlzZTx2b2lkPjtcbiAgcmVjb3JkTGF0ZW5jeShsYXRlbmN5TXM6IG51bWJlciwgbWV0YT86IGFueSk6IFByb21pc2U8dm9pZD47XG4gIHJlY29yZEhlYWx0aENoZWNrKFxuICAgIHByb3ZpZGVyOiBzdHJpbmcsXG4gICAgc3VjY2VzczogYm9vbGVhbixcbiAgICBsYXRlbmN5OiBudW1iZXJcbiAgKTogUHJvbWlzZTx2b2lkPjtcbiAgZ2V0SGVhbHRoPygpOiBQcm9taXNlPGFueT47XG4gIGdldFByb3ZpZGVyTWV0cmljcyhwcm92aWRlcjogc3RyaW5nKTogUHJvbWlzZTxhbnk+O1xuICBzaHV0ZG93bigpOiBQcm9taXNlPHZvaWQ+O1xufVxuXG4vLyBDYWNoZSBJbnRlcmZhY2VcbmV4cG9ydCBpbnRlcmZhY2UgQWlDYWNoZTxUID0gYW55PiB7XG4gIGdldChrZXk6IHN0cmluZyk6IFByb21pc2U8VCB8IHVuZGVmaW5lZD47XG4gIHNldChrZXk6IHN0cmluZywgdmFsdWU6IFQsIHR0bFNlY29uZHM/OiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+O1xuICBjbGVhcigpOiBQcm9taXNlPHZvaWQ+O1xufVxuXG4vLyBDaXJjdWl0IEJyZWFrZXIgSW50ZXJmYWNlXG5leHBvcnQgaW50ZXJmYWNlIENpcmN1aXRCcmVha2VyIHtcbiAgZ2V0U3RhdGUoKTogXCJjbG9zZWRcIiB8IFwib3BlblwiIHwgXCJoYWxmLW9wZW5cIjtcbiAgaXNPcGVuKCk6IGJvb2xlYW47XG4gIHJlY29yZFN1Y2Nlc3MoKTogdm9pZDtcbiAgcmVjb3JkRmFpbHVyZSgpOiB2b2lkO1xuICByZXNldCgpOiB2b2lkO1xuICBleGVjdXRlPFQ+KG9wZXJhdGlvbjogKCkgPT4gUHJvbWlzZTxUPik6IFByb21pc2U8VD47XG59XG5cbi8vIEZlYXR1cmUgRmxhZ3MgSW50ZXJmYWNlXG5leHBvcnQgaW50ZXJmYWNlIEZlYXR1cmVGbGFncyB7XG4gIGlzUHJvdmlkZXJFbmFibGVkKHByb3ZpZGVyOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+O1xuICBzZXRQcm92aWRlckVuYWJsZWQocHJvdmlkZXI6IHN0cmluZywgZW5hYmxlZDogYm9vbGVhbik6IFByb21pc2U8dm9pZD47XG59XG5cbi8vIFByb3ZpZGVyIEFkYXB0ZXIgSW50ZXJmYWNlXG5leHBvcnQgaW50ZXJmYWNlIFByb3ZpZGVyQWRhcHRlciB7XG4gIG5hbWU6IFByb3ZpZGVyO1xuICBnZW5lcmF0ZVJlc3BvbnNlKHJlcXVlc3Q6IGFueSk6IFByb21pc2U8YW55PjtcbiAgdGVzdENvbm5lY3Rpb24/KCk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+O1xuICBoZWFsdGhDaGVjaz8oKTogUHJvbWlzZTx2b2lkPjtcbn1cblxuLyoqXG4gKiBDcmVhdGUgbW9uaXRvciBtb2NrXG4gKi9cbmV4cG9ydCBjb25zdCBjcmVhdGVNb25pdG9yTW9jayA9ICgpOiBBaU1vbml0b3IgPT4gKHtcbiAgcmVjb3JkRXJyb3I6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh2b2lkIDApLFxuICByZWNvcmRTdWNjZXNzOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodm9pZCAwKSxcbiAgcmVjb3JkQXR0ZW1wdDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHZvaWQgMCksXG4gIHJlY29yZENhY2hlSGl0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodm9pZCAwKSxcbiAgcmVjb3JkTGF0ZW5jeTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHZvaWQgMCksXG4gIHJlY29yZEhlYWx0aENoZWNrOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodm9pZCAwKSxcbiAgZ2V0SGVhbHRoOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBwcm92aWRlcnM6IFtdIH0pLFxuICBnZXRQcm92aWRlck1ldHJpY3M6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgYXZlcmFnZUxhdGVuY3k6IDUwMCxcbiAgICBlcnJvclJhdGU6IDAuMDIsXG4gIH0pLFxuICBzaHV0ZG93bjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHZvaWQgMCksXG59KTtcblxuLyoqXG4gKiBDcmVhdGUgY2FjaGUgbW9ja1xuICovXG5leHBvcnQgY29uc3QgY3JlYXRlQ2FjaGVNb2NrID0gKCk6IEFpQ2FjaGUgPT4gKHtcbiAgZ2V0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKSxcbiAgc2V0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodm9pZCAwKSxcbiAgY2xlYXI6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh2b2lkIDApLFxufSk7XG5cbi8qKlxuICogQ3JlYXRlIGNpcmN1aXQgYnJlYWtlciBtb2NrXG4gKi9cbmV4cG9ydCBjb25zdCBjcmVhdGVDaXJjdWl0QnJlYWtlck1vY2sgPSAoKTogYW55ID0+ICh7XG4gIGdldFN0YXRlOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKFwiY2xvc2VkXCIpLFxuICBpc09wZW46IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoZmFsc2UpLFxuICByZWNvcmRTdWNjZXNzOiBqZXN0LmZuKCksXG4gIHJlY29yZEZhaWx1cmU6IGplc3QuZm4oKSxcbiAgcmVzZXQ6IGplc3QuZm4oKSxcbiAgZXhlY3V0ZTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbihhc3luYyAob3BlcmF0aW9uKSA9PiB7XG4gICAgcmV0dXJuIGF3YWl0IG9wZXJhdGlvbigpO1xuICB9KSxcbn0pO1xuXG4vKipcbiAqIENyZWF0ZSBmZWF0dXJlIGZsYWdzIG1vY2tcbiAqL1xuZXhwb3J0IGNvbnN0IGNyZWF0ZUZlYXR1cmVGbGFnc01vY2sgPSAoKTogRmVhdHVyZUZsYWdzID0+ICh7XG4gIGlzUHJvdmlkZXJFbmFibGVkOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSksXG4gIHNldFByb3ZpZGVyRW5hYmxlZDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHZvaWQgMCksXG59KTtcblxuLyoqXG4gKiBDcmVhdGUgcHJvdmlkZXIgYWRhcHRlciBtb2NrXG4gKi9cbmV4cG9ydCBjb25zdCBjcmVhdGVQcm92aWRlckFkYXB0ZXJNb2NrID0gKFxuICBwcm92aWRlcjogUHJvdmlkZXJcbik6IFByb3ZpZGVyQWRhcHRlciA9PiAoe1xuICBuYW1lOiBwcm92aWRlcixcbiAgZ2VuZXJhdGVSZXNwb25zZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICBjb250ZW50OiBgTW9jayByZXNwb25zZSBmcm9tICR7cHJvdmlkZXJ9YCxcbiAgICBwcm92aWRlcixcbiAgICByZXF1ZXN0SWQ6IFwibW9jay1yZXF1ZXN0LWlkXCIsXG4gICAgcHJvY2Vzc2luZ1RpbWU6IDUwMCxcbiAgICBzdWNjZXNzOiB0cnVlLFxuICB9KSxcbiAgdGVzdENvbm5lY3Rpb246IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHN1Y2Nlc3M6IHRydWUgfSksXG4gIGhlYWx0aENoZWNrOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodm9pZCAwKSxcbn0pO1xuXG4vKipcbiAqIENyZWF0ZSBtdWx0aS1wcm92aWRlciBpbnRlZ3JhdGlvbiBtb2NrXG4gKi9cbmV4cG9ydCBjb25zdCBjcmVhdGVNdWx0aVByb3ZpZGVyTW9jayA9ICgpID0+ICh7XG4gIHJvdXRlUmVxdWVzdDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICBjb250ZW50OiBcIk1vY2sgbXVsdGktcHJvdmlkZXIgcmVzcG9uc2VcIixcbiAgICBwcm92aWRlcjogXCJiZWRyb2NrXCIgYXMgUHJvdmlkZXIsXG4gICAgcmVxdWVzdElkOiBcIm1vY2stcmVxdWVzdC1pZFwiLFxuICAgIHByb2Nlc3NpbmdUaW1lOiA1MDAsXG4gICAgc3VjY2VzczogdHJ1ZSxcbiAgfSksXG4gIGdldFByb3ZpZGVySGVhbHRoOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoW1xuICAgIHtcbiAgICAgIHByb3ZpZGVyOiBcImJlZHJvY2tcIiBhcyBQcm92aWRlcixcbiAgICAgIHN0YXR1czogXCJoZWFsdGh5XCIgYXMgY29uc3QsXG4gICAgICBsYXRlbmN5OiA1MDAsXG4gICAgICBlcnJvclJhdGU6IDAuMDEsXG4gICAgICBsYXN0Q2hlY2s6IG5ldyBEYXRlKCksXG4gICAgICBjaXJjdWl0QnJlYWtlclN0YXRlOiBcImNsb3NlZFwiIGFzIGNvbnN0LFxuICAgIH0sXG4gIF0pLFxuICB1cGRhdGVQcm92aWRlckNvbmZpZzogamVzdC5mbigpLFxufSk7XG5cbi8qKlxuICogQ3JlYXRlIHJvdXRlciBnYXRld2F5IG1vY2tcbiAqL1xuZXhwb3J0IGNvbnN0IGNyZWF0ZVJvdXRlckdhdGV3YXlNb2NrID0gKCkgPT4gKHtcbiAgZXhlY3V0ZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICBwcm92aWRlcjogXCJiZWRyb2NrXCIgYXMgUHJvdmlkZXIsXG4gICAgbW9kZWxJZDogXCJjbGF1ZGUtMy01LXNvbm5ldFwiLFxuICAgIHRleHQ6IFwiTW9jayByb3V0ZXIgcmVzcG9uc2VcIixcbiAgICBsYXRlbmN5TXM6IDUwMCxcbiAgICBjb3N0RXVybzogMC4wMSxcbiAgICBzdWNjZXNzOiB0cnVlLFxuICAgIHJlcXVlc3RJZDogXCJtb2NrLXJlcXVlc3QtaWRcIixcbiAgfSksXG4gIGdldEF2YWlsYWJsZU1vZGVsczogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShbXSksXG4gIHVwZGF0ZU1vZGVsQ2FwYWJpbGl0eTogamVzdC5mbigpLFxufSk7XG5cbi8qKlxuICogU2V0dXAgYWxsIG1vY2tzIGZvciB1bmlmaWVkIEFJIEFQSSB0ZXN0c1xuICovXG5leHBvcnQgY29uc3Qgc2V0dXBVbmlmaWVkQWlNb2NrcyA9ICgpID0+IHtcbiAgY29uc3QgbW9uaXRvciA9IGNyZWF0ZU1vbml0b3JNb2NrKCk7XG4gIGNvbnN0IGNhY2hlID0gY3JlYXRlQ2FjaGVNb2NrKCk7XG4gIGNvbnN0IGNpcmN1aXRCcmVha2VycyA9IG5ldyBNYXA8UHJvdmlkZXIsIENpcmN1aXRCcmVha2VyPigpO1xuICBjb25zdCBmZWF0dXJlRmxhZ3MgPSBjcmVhdGVGZWF0dXJlRmxhZ3NNb2NrKCk7XG4gIGNvbnN0IG11bHRpUHJvdmlkZXIgPSBjcmVhdGVNdWx0aVByb3ZpZGVyTW9jaygpO1xuICBjb25zdCByb3V0ZXIgPSBjcmVhdGVSb3V0ZXJHYXRld2F5TW9jaygpO1xuXG4gIC8vIFNldHVwIGNpcmN1aXQgYnJlYWtlcnMgZm9yIGVhY2ggcHJvdmlkZXJcbiAgKFtcImJlZHJvY2tcIiwgXCJnb29nbGVcIiwgXCJtZXRhXCJdIGFzIFByb3ZpZGVyW10pLmZvckVhY2goKHByb3ZpZGVyKSA9PiB7XG4gICAgY2lyY3VpdEJyZWFrZXJzLnNldChwcm92aWRlciwgY3JlYXRlQ2lyY3VpdEJyZWFrZXJNb2NrKCkpO1xuICB9KTtcblxuICByZXR1cm4ge1xuICAgIG1vbml0b3IsXG4gICAgY2FjaGUsXG4gICAgY2lyY3VpdEJyZWFrZXJzLFxuICAgIGZlYXR1cmVGbGFncyxcbiAgICBtdWx0aVByb3ZpZGVyLFxuICAgIHJvdXRlcixcbiAgfTtcbn07XG5cbi8qKlxuICogTW9jayB0aW1lb3V0IHByb21pc2UgZm9yIHRlc3RpbmdcbiAqL1xuZXhwb3J0IGNvbnN0IGNyZWF0ZVRpbWVvdXRNb2NrID0gKHRpbWVvdXRNczogbnVtYmVyKSA9PiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgoXywgcmVqZWN0KSA9PiB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICByZWplY3QobmV3IEVycm9yKGBSZXF1ZXN0IHRpbWVvdXQgYWZ0ZXIgJHt0aW1lb3V0TXN9bXNgKSk7XG4gICAgfSwgdGltZW91dE1zKTtcbiAgfSk7XG59O1xuIl0sInZlcnNpb24iOjN9