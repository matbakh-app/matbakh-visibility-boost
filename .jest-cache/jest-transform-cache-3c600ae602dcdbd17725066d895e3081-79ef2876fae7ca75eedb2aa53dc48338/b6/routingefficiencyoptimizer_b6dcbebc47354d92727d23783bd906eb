61ea6c3f420224472fb272f1c64df22a
"use strict";
/**
 * Routing Efficiency Optimizer
 *
 * Actively optimizes routing decisions to improve performance by >15%.
 * Uses machine learning-based optimization and adaptive routing rules.
 *
 * @module routing-efficiency-optimizer
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.RoutingEfficiencyOptimizer = exports.OptimizationStrategy = void 0;
exports.createRoutingEfficiencyOptimizer = createRoutingEfficiencyOptimizer;
/**
 * Optimization strategy types
 */
var OptimizationStrategy;
(function (OptimizationStrategy) {
    OptimizationStrategy["LATENCY_FIRST"] = "latency_first";
    OptimizationStrategy["SUCCESS_RATE_FIRST"] = "success_rate_first";
    OptimizationStrategy["COST_EFFICIENT"] = "cost_efficient";
    OptimizationStrategy["BALANCED"] = "balanced";
    OptimizationStrategy["ADAPTIVE"] = "adaptive";
})(OptimizationStrategy || (exports.OptimizationStrategy = OptimizationStrategy = {}));
/**
 * Default optimizer configuration
 */
const DEFAULT_CONFIG = {
    targetPerformanceImprovement: 15, // 15% minimum improvement
    targetLatencyReduction: 20, // 20% latency reduction target
    targetSuccessRateImprovement: 5, // 5% success rate improvement
    targetCostReduction: 25, // 25% cost reduction target
    optimizationIntervalMs: 300000, // 5 minutes
    performanceEvaluationWindowMs: 900000, // 15 minutes
    maxRoutingRuleChanges: 3,
    minDataPointsRequired: 100,
    rollbackThreshold: -5, // Rollback if performance degrades by 5%
    defaultStrategy: OptimizationStrategy.BALANCED,
    enableAdaptiveStrategy: true,
    enableAutomaticRollback: true,
    enableOptimization: true,
    enableAggressiveOptimization: false,
};
/**
 * Routing Efficiency Optimizer
 *
 * Actively optimizes routing decisions to achieve >15% performance improvement
 */
class RoutingEfficiencyOptimizer {
    config;
    router;
    performanceMonitor;
    featureFlags;
    auditTrail;
    routeProfiles;
    optimizationHistory;
    activeRecommendations;
    baselineMetrics;
    optimizationTimer;
    isOptimizing = false;
    lastOptimization;
    constructor(router, performanceMonitor, featureFlags, auditTrail, config) {
        this.router = router;
        this.performanceMonitor = performanceMonitor;
        this.featureFlags = featureFlags;
        this.auditTrail = auditTrail;
        this.config = { ...DEFAULT_CONFIG, ...config };
        this.routeProfiles = new Map();
        this.optimizationHistory = [];
        this.activeRecommendations = [];
        this.baselineMetrics = new Map();
        this.initializeRouteProfiles();
        this.captureBaselineMetrics();
    }
    /**
     * Start the optimization engine
     */
    async startOptimization() {
        if (this.isOptimizing) {
            console.log("[RoutingEfficiencyOptimizer] Already optimizing");
            return;
        }
        if (!this.featureFlags.isEnabled("routing_efficiency_optimization")) {
            console.log("[RoutingEfficiencyOptimizer] Optimization disabled by feature flag");
            return;
        }
        console.log("[RoutingEfficiencyOptimizer] Starting optimization engine");
        this.isOptimizing = true;
        // Initial optimization
        await this.runOptimizationCycle();
        // Schedule periodic optimization
        this.optimizationTimer = setInterval(() => this.runOptimizationCycle(), this.config.optimizationIntervalMs);
        // Log optimization start
        await this.auditTrail.logRoutingOptimizationStart(this.config.defaultStrategy, this.config.targetPerformanceImprovement);
    }
    /**
     * Stop the optimization engine
     */
    async stopOptimization() {
        if (!this.isOptimizing) {
            return;
        }
        console.log("[RoutingEfficiencyOptimizer] Stopping optimization engine");
        this.isOptimizing = false;
        if (this.optimizationTimer) {
            clearInterval(this.optimizationTimer);
            this.optimizationTimer = undefined;
        }
        // Log optimization stop
        await this.auditTrail.logRoutingOptimizationStop(this.optimizationHistory.length, this.calculateOverallImprovement());
    }
    /**
     * Run a single optimization cycle
     */
    async runOptimizationCycle() {
        try {
            console.log("[RoutingEfficiencyOptimizer] Running optimization cycle");
            // Update route performance profiles
            await this.updateRouteProfiles();
            // Analyze current performance
            const currentPerformance = await this.analyzeCurrentPerformance();
            // Generate optimization recommendations
            const recommendations = await this.generateOptimizationRecommendations(currentPerformance);
            if (recommendations.length === 0) {
                console.log("[RoutingEfficiencyOptimizer] No optimization recommendations");
                return;
            }
            // Apply high-priority recommendations
            const appliedRecommendations = await this.applyRecommendations(recommendations.filter((r) => r.priority === "high" || r.priority === "critical"));
            if (appliedRecommendations.length > 0) {
                // Create optimization result
                const result = {
                    optimizationId: this.generateOptimizationId(),
                    strategy: this.config.defaultStrategy,
                    appliedRecommendations,
                    performanceImprovement: 0, // Will be calculated after evaluation period
                    latencyImprovement: 0,
                    successRateImprovement: 0,
                    costImprovement: 0,
                    timestamp: new Date(),
                    success: true,
                    rollbackRequired: false,
                };
                this.optimizationHistory.push(result);
                this.lastOptimization = new Date();
                // Log optimization
                await this.auditTrail.logRoutingOptimization(appliedRecommendations.map((r) => r.description), {
                    strategy: this.config.defaultStrategy,
                    expectedImprovement: Math.max(...appliedRecommendations.map((r) => r.expectedImprovement)),
                    appliedCount: appliedRecommendations.length,
                });
                console.log(`[RoutingEfficiencyOptimizer] Applied ${appliedRecommendations.length} optimizations`);
            }
            // Evaluate previous optimizations
            await this.evaluatePreviousOptimizations();
        }
        catch (error) {
            console.error("[RoutingEfficiencyOptimizer] Error in optimization cycle:", error);
        }
    }
    /**
     * Update route performance profiles
     */
    async updateRouteProfiles() {
        const allMetrics = this.performanceMonitor.getAllPathMetrics();
        for (const [path, metrics] of allMetrics.entries()) {
            if (path === "hybrid" || path === "fallback")
                continue; // Skip composite paths
            const route = path;
            const profile = {
                route,
                averageLatencyMs: metrics.averageLatencyMs,
                p95LatencyMs: metrics.p95LatencyMs,
                successRate: metrics.successRate,
                costPerRequest: this.estimateCostPerRequest(route, metrics),
                reliability: this.calculateReliability(metrics),
                capacity: this.estimateCapacity(route, metrics),
                lastUpdated: new Date(),
            };
            this.routeProfiles.set(route, profile);
        }
    }
    /**
     * Analyze current performance
     */
    async analyzeCurrentPerformance() {
        const efficiency = await this.performanceMonitor.calculateRoutingEfficiency();
        const allMetrics = this.performanceMonitor.getAllPathMetrics();
        let totalRequests = 0;
        let weightedLatency = 0;
        let weightedSuccessRate = 0;
        let totalCost = 0;
        const bottlenecks = [];
        for (const [path, metrics] of allMetrics.entries()) {
            if (path === "hybrid" || path === "fallback")
                continue;
            totalRequests += metrics.requestCount;
            weightedLatency += metrics.averageLatencyMs * metrics.requestCount;
            weightedSuccessRate += metrics.successRate * metrics.requestCount;
            const profile = this.routeProfiles.get(path);
            if (profile) {
                totalCost += profile.costPerRequest * metrics.requestCount;
                // Identify bottlenecks
                if (metrics.p95LatencyMs > 10000) {
                    bottlenecks.push(`High P95 latency on ${path}: ${metrics.p95LatencyMs}ms`);
                }
                if (metrics.successRate < 95) {
                    bottlenecks.push(`Low success rate on ${path}: ${metrics.successRate.toFixed(2)}%`);
                }
            }
        }
        return {
            overallLatency: totalRequests > 0 ? weightedLatency / totalRequests : 0,
            overallSuccessRate: totalRequests > 0 ? weightedSuccessRate / totalRequests : 100,
            overallCost: totalCost,
            routingEfficiency: efficiency.overallEfficiency,
            bottlenecks,
        };
    }
    /**
     * Generate optimization recommendations
     */
    async generateOptimizationRecommendations(performance) {
        const recommendations = [];
        // Check if we have enough data
        const totalRequests = Array.from(this.performanceMonitor.getAllPathMetrics().values()).reduce((sum, metrics) => sum + metrics.requestCount, 0);
        if (totalRequests < this.config.minDataPointsRequired) {
            console.log("[RoutingEfficiencyOptimizer] Insufficient data for optimization");
            return recommendations;
        }
        // Latency optimization recommendations
        if (performance.overallLatency > 5000) {
            const directProfile = this.routeProfiles.get("direct");
            const mcpProfile = this.routeProfiles.get("mcp");
            if (directProfile && mcpProfile) {
                if (directProfile.averageLatencyMs <
                    mcpProfile.averageLatencyMs * 0.8) {
                    recommendations.push({
                        id: this.generateRecommendationId(),
                        type: "rule_adjustment",
                        priority: "high",
                        description: "Route more operations to direct Bedrock for better latency",
                        expectedImprovement: 25,
                        implementation: {
                            action: "adjust_routing_thresholds",
                            parameters: {
                                increaseDirectRouting: true,
                                latencyThreshold: 8000,
                            },
                            rollbackPlan: "Revert to previous routing thresholds",
                        },
                        confidence: 0.85,
                        timestamp: new Date(),
                    });
                }
            }
        }
        // Success rate optimization recommendations
        if (performance.overallSuccessRate < 95) {
            recommendations.push({
                id: this.generateRecommendationId(),
                type: "route_change",
                priority: "critical",
                description: "Implement circuit breaker with faster failover",
                expectedImprovement: 15,
                implementation: {
                    action: "update_circuit_breaker_config",
                    parameters: {
                        failureThreshold: 2,
                        recoveryTimeout: 15000,
                    },
                    rollbackPlan: "Revert circuit breaker to previous configuration",
                },
                confidence: 0.9,
                timestamp: new Date(),
            });
        }
        // Cost optimization recommendations
        const baselineCost = this.baselineMetrics.get("totalCost") || 0;
        if (performance.overallCost > baselineCost * 1.2) {
            recommendations.push({
                id: this.generateRecommendationId(),
                type: "strategy_change",
                priority: "medium",
                description: "Route standard operations to MCP to reduce costs",
                expectedImprovement: 30,
                implementation: {
                    action: "update_routing_strategy",
                    parameters: {
                        strategy: OptimizationStrategy.COST_EFFICIENT,
                        mcpPreference: 0.8,
                    },
                    rollbackPlan: "Revert to balanced routing strategy",
                },
                confidence: 0.75,
                timestamp: new Date(),
            });
        }
        // Routing efficiency recommendations
        if (performance.routingEfficiency < 80) {
            recommendations.push({
                id: this.generateRecommendationId(),
                type: "threshold_update",
                priority: "high",
                description: "Optimize routing decision thresholds based on current performance",
                expectedImprovement: 20,
                implementation: {
                    action: "optimize_routing_thresholds",
                    parameters: {
                        adaptiveThresholds: true,
                        performanceWeighting: 0.7,
                    },
                    rollbackPlan: "Revert to static routing thresholds",
                },
                confidence: 0.8,
                timestamp: new Date(),
            });
        }
        // Adaptive strategy recommendation
        if (this.config.enableAdaptiveStrategy && recommendations.length > 2) {
            recommendations.push({
                id: this.generateRecommendationId(),
                type: "strategy_change",
                priority: "medium",
                description: "Enable adaptive routing strategy for dynamic optimization",
                expectedImprovement: 18,
                implementation: {
                    action: "enable_adaptive_strategy",
                    parameters: {
                        strategy: OptimizationStrategy.ADAPTIVE,
                        adaptationInterval: 60000,
                    },
                    rollbackPlan: "Disable adaptive strategy",
                },
                confidence: 0.7,
                timestamp: new Date(),
            });
        }
        return recommendations.sort((a, b) => {
            const priorityOrder = { critical: 4, high: 3, medium: 2, low: 1 };
            return priorityOrder[b.priority] - priorityOrder[a.priority];
        });
    }
    /**
     * Apply optimization recommendations
     */
    async applyRecommendations(recommendations) {
        const applied = [];
        let changesApplied = 0;
        for (const recommendation of recommendations) {
            if (changesApplied >= this.config.maxRoutingRuleChanges) {
                console.log("[RoutingEfficiencyOptimizer] Maximum changes per cycle reached");
                break;
            }
            try {
                const success = await this.applyRecommendation(recommendation);
                if (success) {
                    applied.push(recommendation);
                    changesApplied++;
                    console.log(`[RoutingEfficiencyOptimizer] Applied: ${recommendation.description}`);
                }
            }
            catch (error) {
                console.error(`[RoutingEfficiencyOptimizer] Failed to apply recommendation: ${recommendation.description}`, error);
            }
        }
        this.activeRecommendations.push(...applied);
        return applied;
    }
    /**
     * Apply a single recommendation
     */
    async applyRecommendation(recommendation) {
        const { action, parameters } = recommendation.implementation;
        switch (action) {
            case "adjust_routing_thresholds":
                return this.adjustRoutingThresholds(parameters);
            case "update_circuit_breaker_config":
                return this.updateCircuitBreakerConfig(parameters);
            case "update_routing_strategy":
                return this.updateRoutingStrategy(parameters);
            case "optimize_routing_thresholds":
                return this.optimizeRoutingThresholds(parameters);
            case "enable_adaptive_strategy":
                return this.enableAdaptiveStrategy(parameters);
            default:
                console.warn(`[RoutingEfficiencyOptimizer] Unknown action: ${action}`);
                return false;
        }
    }
    /**
     * Adjust routing thresholds
     */
    async adjustRoutingThresholds(parameters) {
        try {
            // Get current routing rules
            const currentRules = this.router.getRoutingRules?.() || [];
            // Adjust latency thresholds
            const updatedRules = currentRules.map((rule) => ({
                ...rule,
                latencyRequirement: parameters.latencyThreshold || rule.latencyRequirement,
            }));
            // Update router with new rules
            this.router.updateRoutingRules?.(updatedRules);
            return true;
        }
        catch (error) {
            console.error("[RoutingEfficiencyOptimizer] Error adjusting routing thresholds:", error);
            return false;
        }
    }
    /**
     * Update circuit breaker configuration
     */
    async updateCircuitBreakerConfig(parameters) {
        try {
            // This would integrate with the circuit breaker system
            // For now, we'll log the configuration change
            console.log("[RoutingEfficiencyOptimizer] Circuit breaker config updated:", parameters);
            return true;
        }
        catch (error) {
            console.error("[RoutingEfficiencyOptimizer] Error updating circuit breaker:", error);
            return false;
        }
    }
    /**
     * Update routing strategy
     */
    async updateRoutingStrategy(parameters) {
        try {
            this.config.defaultStrategy = parameters.strategy;
            console.log(`[RoutingEfficiencyOptimizer] Strategy updated to: ${parameters.strategy}`);
            return true;
        }
        catch (error) {
            console.error("[RoutingEfficiencyOptimizer] Error updating strategy:", error);
            return false;
        }
    }
    /**
     * Optimize routing thresholds
     */
    async optimizeRoutingThresholds(parameters) {
        try {
            // Implement adaptive threshold optimization
            console.log("[RoutingEfficiencyOptimizer] Routing thresholds optimized:", parameters);
            return true;
        }
        catch (error) {
            console.error("[RoutingEfficiencyOptimizer] Error optimizing thresholds:", error);
            return false;
        }
    }
    /**
     * Enable adaptive strategy
     */
    async enableAdaptiveStrategy(parameters) {
        try {
            this.config.enableAdaptiveStrategy = true;
            this.config.defaultStrategy = OptimizationStrategy.ADAPTIVE;
            console.log("[RoutingEfficiencyOptimizer] Adaptive strategy enabled");
            return true;
        }
        catch (error) {
            console.error("[RoutingEfficiencyOptimizer] Error enabling adaptive strategy:", error);
            return false;
        }
    }
    /**
     * Evaluate previous optimizations
     */
    async evaluatePreviousOptimizations() {
        const evaluationWindow = this.config.performanceEvaluationWindowMs;
        const now = Date.now();
        for (const result of this.optimizationHistory) {
            if (result.performanceImprovement !== 0)
                continue; // Already evaluated
            const timeSinceOptimization = now - result.timestamp.getTime();
            if (timeSinceOptimization < evaluationWindow)
                continue; // Too early to evaluate
            // Calculate actual performance improvement
            const improvement = await this.calculatePerformanceImprovement(result);
            result.performanceImprovement = improvement.overall;
            result.latencyImprovement = improvement.latency;
            result.successRateImprovement = improvement.successRate;
            result.costImprovement = improvement.cost;
            // Check if rollback is needed
            if (improvement.overall < this.config.rollbackThreshold &&
                this.config.enableAutomaticRollback) {
                await this.rollbackOptimization(result);
                result.rollbackRequired = true;
                result.success = false;
            }
            console.log(`[RoutingEfficiencyOptimizer] Optimization ${result.optimizationId} evaluated: ${improvement.overall.toFixed(2)}% improvement`);
        }
    }
    /**
     * Calculate performance improvement
     */
    async calculatePerformanceImprovement(result) {
        const currentPerformance = await this.analyzeCurrentPerformance();
        const baselineLatency = this.baselineMetrics.get("averageLatency") ||
            currentPerformance.overallLatency;
        const baselineSuccessRate = this.baselineMetrics.get("successRate") ||
            currentPerformance.overallSuccessRate;
        const baselineCost = this.baselineMetrics.get("totalCost") || currentPerformance.overallCost;
        const latencyImprovement = ((baselineLatency - currentPerformance.overallLatency) /
            baselineLatency) *
            100;
        const successRateImprovement = ((currentPerformance.overallSuccessRate - baselineSuccessRate) /
            baselineSuccessRate) *
            100;
        const costImprovement = ((baselineCost - currentPerformance.overallCost) / baselineCost) * 100;
        // Overall improvement is weighted average
        const overallImprovement = latencyImprovement * 0.4 +
            successRateImprovement * 0.3 +
            costImprovement * 0.3;
        return {
            overall: overallImprovement,
            latency: latencyImprovement,
            successRate: successRateImprovement,
            cost: costImprovement,
        };
    }
    /**
     * Rollback optimization
     */
    async rollbackOptimization(result) {
        console.log(`[RoutingEfficiencyOptimizer] Rolling back optimization: ${result.optimizationId}`);
        for (const recommendation of result.appliedRecommendations) {
            try {
                // Execute rollback plan
                console.log(`[RoutingEfficiencyOptimizer] Rollback: ${recommendation.implementation.rollbackPlan}`);
                // Log rollback
                await this.auditTrail.logRoutingOptimizationRollback(result.optimizationId, recommendation.description, result.performanceImprovement);
            }
            catch (error) {
                console.error(`[RoutingEfficiencyOptimizer] Rollback failed for: ${recommendation.description}`, error);
            }
        }
    }
    /**
     * Get optimization status
     */
    getOptimizationStatus() {
        const overallImprovement = this.calculateOverallImprovement();
        return {
            isOptimizing: this.isOptimizing,
            lastOptimization: this.lastOptimization,
            totalOptimizations: this.optimizationHistory.length,
            overallImprovement,
            activeRecommendations: this.activeRecommendations.length,
            targetAchieved: overallImprovement >= this.config.targetPerformanceImprovement,
        };
    }
    /**
     * Get optimization history
     */
    getOptimizationHistory() {
        return [...this.optimizationHistory];
    }
    /**
     * Get active recommendations
     */
    getActiveRecommendations() {
        return [...this.activeRecommendations];
    }
    // Private helper methods
    initializeRouteProfiles() {
        const routes = ["direct", "mcp"];
        for (const route of routes) {
            this.routeProfiles.set(route, {
                route,
                averageLatencyMs: 0,
                p95LatencyMs: 0,
                successRate: 100,
                costPerRequest: 0,
                reliability: 1.0,
                capacity: 1.0,
                lastUpdated: new Date(),
            });
        }
    }
    async captureBaselineMetrics() {
        const performance = await this.analyzeCurrentPerformance();
        this.baselineMetrics.set("averageLatency", performance.overallLatency);
        this.baselineMetrics.set("successRate", performance.overallSuccessRate);
        this.baselineMetrics.set("totalCost", performance.overallCost);
        this.baselineMetrics.set("routingEfficiency", performance.routingEfficiency);
    }
    estimateCostPerRequest(route, metrics) {
        // Simplified cost estimation
        const baseCost = route === "direct" ? 0.001 : 0.0003; // Direct Bedrock costs more
        return baseCost * (metrics.averageLatencyMs / 1000); // Cost scales with latency
    }
    calculateReliability(metrics) {
        return metrics.successRate / 100;
    }
    estimateCapacity(route, metrics) {
        // Simplified capacity estimation based on latency
        const maxLatency = 30000; // 30 seconds max
        return Math.max(0.1, 1 - metrics.p95LatencyMs / maxLatency);
    }
    calculateOverallImprovement() {
        if (this.optimizationHistory.length === 0)
            return 0;
        const validResults = this.optimizationHistory.filter((r) => r.performanceImprovement !== 0);
        if (validResults.length === 0)
            return 0;
        return (validResults.reduce((sum, r) => sum + r.performanceImprovement, 0) /
            validResults.length);
    }
    generateOptimizationId() {
        return `opt-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
    }
    generateRecommendationId() {
        return `rec-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
    }
    /**
     * Cleanup resources
     */
    cleanup() {
        this.stopOptimization();
        this.routeProfiles.clear();
        this.optimizationHistory = [];
        this.activeRecommendations = [];
        this.baselineMetrics.clear();
    }
}
exports.RoutingEfficiencyOptimizer = RoutingEfficiencyOptimizer;
/**
 * Create routing efficiency optimizer
 */
function createRoutingEfficiencyOptimizer(router, performanceMonitor, featureFlags, auditTrail, config) {
    return new RoutingEfficiencyOptimizer(router, performanceMonitor, featureFlags, auditTrail, config);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hdGJha2gtdmlzaWJpbGl0eS1ib29zdC4yMDI1MDkyMC9zcmMvbGliL2FpLW9yY2hlc3RyYXRvci9yb3V0aW5nLWVmZmljaWVuY3ktb3B0aW1pemVyLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7OztHQU9HOzs7QUFrN0JILDRFQWNDO0FBdDdCRDs7R0FFRztBQUNILElBQVksb0JBTVg7QUFORCxXQUFZLG9CQUFvQjtJQUM5Qix1REFBK0IsQ0FBQTtJQUMvQixpRUFBeUMsQ0FBQTtJQUN6Qyx5REFBaUMsQ0FBQTtJQUNqQyw2Q0FBcUIsQ0FBQTtJQUNyQiw2Q0FBcUIsQ0FBQTtBQUN2QixDQUFDLEVBTlcsb0JBQW9CLG9DQUFwQixvQkFBb0IsUUFNL0I7QUFtRkQ7O0dBRUc7QUFDSCxNQUFNLGNBQWMsR0FBb0I7SUFDdEMsNEJBQTRCLEVBQUUsRUFBRSxFQUFFLDBCQUEwQjtJQUM1RCxzQkFBc0IsRUFBRSxFQUFFLEVBQUUsK0JBQStCO0lBQzNELDRCQUE0QixFQUFFLENBQUMsRUFBRSw4QkFBOEI7SUFDL0QsbUJBQW1CLEVBQUUsRUFBRSxFQUFFLDRCQUE0QjtJQUNyRCxzQkFBc0IsRUFBRSxNQUFNLEVBQUUsWUFBWTtJQUM1Qyw2QkFBNkIsRUFBRSxNQUFNLEVBQUUsYUFBYTtJQUNwRCxxQkFBcUIsRUFBRSxDQUFDO0lBQ3hCLHFCQUFxQixFQUFFLEdBQUc7SUFDMUIsaUJBQWlCLEVBQUUsQ0FBQyxDQUFDLEVBQUUseUNBQXlDO0lBQ2hFLGVBQWUsRUFBRSxvQkFBb0IsQ0FBQyxRQUFRO0lBQzlDLHNCQUFzQixFQUFFLElBQUk7SUFDNUIsdUJBQXVCLEVBQUUsSUFBSTtJQUM3QixrQkFBa0IsRUFBRSxJQUFJO0lBQ3hCLDRCQUE0QixFQUFFLEtBQUs7Q0FDcEMsQ0FBQztBQUVGOzs7O0dBSUc7QUFDSCxNQUFhLDBCQUEwQjtJQUM3QixNQUFNLENBQWtCO0lBQ3hCLE1BQU0sQ0FBb0I7SUFDMUIsa0JBQWtCLENBQWtDO0lBQ3BELFlBQVksQ0FBaUI7SUFDN0IsVUFB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QUFDO0FBQ0osQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvbWF0YmFraC12aXNpYmlsaXR5LWJvb3N0LjIwMjUwOTIwL3NyYy9saWIvYWktb3JjaGVzdHJhdG9yL3JvdXRpbmctZWZmaWNpZW5jeS1vcHRpbWl6ZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBSb3V0aW5nIEVmZmljaWVuY3kgT3B0aW1pemVyXG4gKlxuICogQWN0aXZlbHkgb3B0aW1pemVzIHJvdXRpbmcgZGVjaXNpb25zIHRvIGltcHJvdmUgcGVyZm9ybWFuY2UgYnkgPjE1JS5cbiAqIFVzZXMgbWFjaGluZSBsZWFybmluZy1iYXNlZCBvcHRpbWl6YXRpb24gYW5kIGFkYXB0aXZlIHJvdXRpbmcgcnVsZXMuXG4gKlxuICogQG1vZHVsZSByb3V0aW5nLWVmZmljaWVuY3ktb3B0aW1pemVyXG4gKi9cblxuaW1wb3J0IHsgQWlGZWF0dXJlRmxhZ3MgfSBmcm9tIFwiLi9haS1mZWF0dXJlLWZsYWdzXCI7XG5pbXBvcnQgeyBBdWRpdFRyYWlsU3lzdGVtIH0gZnJvbSBcIi4vYXVkaXQtdHJhaWwtc3lzdGVtXCI7XG5pbXBvcnQge1xuICBIeWJyaWRSb3V0aW5nUGVyZm9ybWFuY2VNb25pdG9yLFxuICBSb3V0aW5nUGF0aE1ldHJpY3MsXG59IGZyb20gXCIuL2h5YnJpZC1yb3V0aW5nLXBlcmZvcm1hbmNlLW1vbml0b3JcIjtcbmltcG9ydCB7IEludGVsbGlnZW50Um91dGVyLCBSb3V0ZVR5cGUgfSBmcm9tIFwiLi9pbnRlbGxpZ2VudC1yb3V0ZXJcIjtcblxuLyoqXG4gKiBPcHRpbWl6YXRpb24gc3RyYXRlZ3kgdHlwZXNcbiAqL1xuZXhwb3J0IGVudW0gT3B0aW1pemF0aW9uU3RyYXRlZ3kge1xuICBMQVRFTkNZX0ZJUlNUID0gXCJsYXRlbmN5X2ZpcnN0XCIsXG4gIFNVQ0NFU1NfUkFURV9GSVJTVCA9IFwic3VjY2Vzc19yYXRlX2ZpcnN0XCIsXG4gIENPU1RfRUZGSUNJRU5UID0gXCJjb3N0X2VmZmljaWVudFwiLFxuICBCQUxBTkNFRCA9IFwiYmFsYW5jZWRcIixcbiAgQURBUFRJVkUgPSBcImFkYXB0aXZlXCIsXG59XG5cbi8qKlxuICogUm91dGUgcGVyZm9ybWFuY2UgcHJvZmlsZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFJvdXRlUGVyZm9ybWFuY2VQcm9maWxlIHtcbiAgcm91dGU6IFJvdXRlVHlwZTtcbiAgYXZlcmFnZUxhdGVuY3lNczogbnVtYmVyO1xuICBwOTVMYXRlbmN5TXM6IG51bWJlcjtcbiAgc3VjY2Vzc1JhdGU6IG51bWJlcjtcbiAgY29zdFBlclJlcXVlc3Q6IG51bWJlcjtcbiAgcmVsaWFiaWxpdHk6IG51bWJlcjtcbiAgY2FwYWNpdHk6IG51bWJlcjtcbiAgbGFzdFVwZGF0ZWQ6IERhdGU7XG59XG5cbi8qKlxuICogT3B0aW1pemF0aW9uIHJlY29tbWVuZGF0aW9uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgT3B0aW1pemF0aW9uUmVjb21tZW5kYXRpb24ge1xuICBpZDogc3RyaW5nO1xuICB0eXBlOlxuICAgIHwgXCJyb3V0ZV9jaGFuZ2VcIlxuICAgIHwgXCJydWxlX2FkanVzdG1lbnRcIlxuICAgIHwgXCJ0aHJlc2hvbGRfdXBkYXRlXCJcbiAgICB8IFwic3RyYXRlZ3lfY2hhbmdlXCI7XG4gIHByaW9yaXR5OiBcImxvd1wiIHwgXCJtZWRpdW1cIiB8IFwiaGlnaFwiIHwgXCJjcml0aWNhbFwiO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBleHBlY3RlZEltcHJvdmVtZW50OiBudW1iZXI7IC8vIFBlcmNlbnRhZ2UgaW1wcm92ZW1lbnQgZXhwZWN0ZWRcbiAgaW1wbGVtZW50YXRpb246IHtcbiAgICBhY3Rpb246IHN0cmluZztcbiAgICBwYXJhbWV0ZXJzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgIHJvbGxiYWNrUGxhbjogc3RyaW5nO1xuICB9O1xuICBjb25maWRlbmNlOiBudW1iZXI7IC8vIDAtMSBjb25maWRlbmNlIHNjb3JlXG4gIHRpbWVzdGFtcDogRGF0ZTtcbn1cblxuLyoqXG4gKiBPcHRpbWl6YXRpb24gcmVzdWx0XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgT3B0aW1pemF0aW9uUmVzdWx0IHtcbiAgb3B0aW1pemF0aW9uSWQ6IHN0cmluZztcbiAgc3RyYXRlZ3k6IE9wdGltaXphdGlvblN0cmF0ZWd5O1xuICBhcHBsaWVkUmVjb21tZW5kYXRpb25zOiBPcHRpbWl6YXRpb25SZWNvbW1lbmRhdGlvbltdO1xuICBwZXJmb3JtYW5jZUltcHJvdmVtZW50OiBudW1iZXI7IC8vIEFjdHVhbCBpbXByb3ZlbWVudCBwZXJjZW50YWdlXG4gIGxhdGVuY3lJbXByb3ZlbWVudDogbnVtYmVyO1xuICBzdWNjZXNzUmF0ZUltcHJvdmVtZW50OiBudW1iZXI7XG4gIGNvc3RJbXByb3ZlbWVudDogbnVtYmVyO1xuICB0aW1lc3RhbXA6IERhdGU7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIHJvbGxiYWNrUmVxdWlyZWQ6IGJvb2xlYW47XG59XG5cbi8qKlxuICogT3B0aW1pemVyIGNvbmZpZ3VyYXRpb25cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBPcHRpbWl6ZXJDb25maWcge1xuICAvLyBPcHRpbWl6YXRpb24gdGFyZ2V0c1xuICB0YXJnZXRQZXJmb3JtYW5jZUltcHJvdmVtZW50OiBudW1iZXI7IC8vIE1pbmltdW0gMTUlIGltcHJvdmVtZW50XG4gIHRhcmdldExhdGVuY3lSZWR1Y3Rpb246IG51bWJlcjsgLy8gVGFyZ2V0IGxhdGVuY3kgcmVkdWN0aW9uIHBlcmNlbnRhZ2VcbiAgdGFyZ2V0U3VjY2Vzc1JhdGVJbXByb3ZlbWVudDogbnVtYmVyOyAvLyBUYXJnZXQgc3VjY2VzcyByYXRlIGltcHJvdmVtZW50XG4gIHRhcmdldENvc3RSZWR1Y3Rpb246IG51bWJlcjsgLy8gVGFyZ2V0IGNvc3QgcmVkdWN0aW9uIHBlcmNlbnRhZ2VcblxuICAvLyBPcHRpbWl6YXRpb24gaW50ZXJ2YWxzXG4gIG9wdGltaXphdGlvbkludGVydmFsTXM6IG51bWJlcjsgLy8gSG93IG9mdGVuIHRvIHJ1biBvcHRpbWl6YXRpb25cbiAgcGVyZm9ybWFuY2VFdmFsdWF0aW9uV2luZG93TXM6IG51bWJlcjsgLy8gV2luZG93IGZvciBwZXJmb3JtYW5jZSBldmFsdWF0aW9uXG5cbiAgLy8gU2FmZXR5IHRocmVzaG9sZHNcbiAgbWF4Um91dGluZ1J1bGVDaGFuZ2VzOiBudW1iZXI7IC8vIE1heGltdW0gcnVsZSBjaGFuZ2VzIHBlciBvcHRpbWl6YXRpb24gY3ljbGVcbiAgbWluRGF0YVBvaW50c1JlcXVpcmVkOiBudW1iZXI7IC8vIE1pbmltdW0gZGF0YSBwb2ludHMgYmVmb3JlIG9wdGltaXphdGlvblxuICByb2xsYmFja1RocmVzaG9sZDogbnVtYmVyOyAvLyBQZXJmb3JtYW5jZSBkZWdyYWRhdGlvbiB0aHJlc2hvbGQgZm9yIHJvbGxiYWNrXG5cbiAgLy8gU3RyYXRlZ3kgY29uZmlndXJhdGlvblxuICBkZWZhdWx0U3RyYXRlZ3k6IE9wdGltaXphdGlvblN0cmF0ZWd5O1xuICBlbmFibGVBZGFwdGl2ZVN0cmF0ZWd5OiBib29sZWFuO1xuICBlbmFibGVBdXRvbWF0aWNSb2xsYmFjazogYm9vbGVhbjtcblxuICAvLyBGZWF0dXJlIGZsYWdzXG4gIGVuYWJsZU9wdGltaXphdGlvbjogYm9vbGVhbjtcbiAgZW5hYmxlQWdncmVzc2l2ZU9wdGltaXphdGlvbjogYm9vbGVhbjtcbn1cblxuLyoqXG4gKiBEZWZhdWx0IG9wdGltaXplciBjb25maWd1cmF0aW9uXG4gKi9cbmNvbnN0IERFRkFVTFRfQ09ORklHOiBPcHRpbWl6ZXJDb25maWcgPSB7XG4gIHRhcmdldFBlcmZvcm1hbmNlSW1wcm92ZW1lbnQ6IDE1LCAvLyAxNSUgbWluaW11bSBpbXByb3ZlbWVudFxuICB0YXJnZXRMYXRlbmN5UmVkdWN0aW9uOiAyMCwgLy8gMjAlIGxhdGVuY3kgcmVkdWN0aW9uIHRhcmdldFxuICB0YXJnZXRTdWNjZXNzUmF0ZUltcHJvdmVtZW50OiA1LCAvLyA1JSBzdWNjZXNzIHJhdGUgaW1wcm92ZW1lbnRcbiAgdGFyZ2V0Q29zdFJlZHVjdGlvbjogMjUsIC8vIDI1JSBjb3N0IHJlZHVjdGlvbiB0YXJnZXRcbiAgb3B0aW1pemF0aW9uSW50ZXJ2YWxNczogMzAwMDAwLCAvLyA1IG1pbnV0ZXNcbiAgcGVyZm9ybWFuY2VFdmFsdWF0aW9uV2luZG93TXM6IDkwMDAwMCwgLy8gMTUgbWludXRlc1xuICBtYXhSb3V0aW5nUnVsZUNoYW5nZXM6IDMsXG4gIG1pbkRhdGFQb2ludHNSZXF1aXJlZDogMTAwLFxuICByb2xsYmFja1RocmVzaG9sZDogLTUsIC8vIFJvbGxiYWNrIGlmIHBlcmZvcm1hbmNlIGRlZ3JhZGVzIGJ5IDUlXG4gIGRlZmF1bHRTdHJhdGVneTogT3B0aW1pemF0aW9uU3RyYXRlZ3kuQkFMQU5DRUQsXG4gIGVuYWJsZUFkYXB0aXZlU3RyYXRlZ3k6IHRydWUsXG4gIGVuYWJsZUF1dG9tYXRpY1JvbGxiYWNrOiB0cnVlLFxuICBlbmFibGVPcHRpbWl6YXRpb246IHRydWUsXG4gIGVuYWJsZUFnZ3Jlc3NpdmVPcHRpbWl6YXRpb246IGZhbHNlLFxufTtcblxuLyoqXG4gKiBSb3V0aW5nIEVmZmljaWVuY3kgT3B0aW1pemVyXG4gKlxuICogQWN0aXZlbHkgb3B0aW1pemVzIHJvdXRpbmcgZGVjaXNpb25zIHRvIGFjaGlldmUgPjE1JSBwZXJmb3JtYW5jZSBpbXByb3ZlbWVudFxuICovXG5leHBvcnQgY2xhc3MgUm91dGluZ0VmZmljaWVuY3lPcHRpbWl6ZXIge1xuICBwcml2YXRlIGNvbmZpZzogT3B0aW1pemVyQ29uZmlnO1xuICBwcml2YXRlIHJvdXRlcjogSW50ZWxsaWdlbnRSb3V0ZXI7XG4gIHByaXZhdGUgcGVyZm9ybWFuY2VNb25pdG9yOiBIeWJyaWRSb3V0aW5nUGVyZm9ybWFuY2VNb25pdG9yO1xuICBwcml2YXRlIGZlYXR1cmVGbGFnczogQWlGZWF0dXJlRmxhZ3M7XG4gIHByaXZhdGUgYXVkaXRUcmFpbDogQXVkaXRUcmFpbFN5c3RlbTtcblxuICBwcml2YXRlIHJvdXRlUHJvZmlsZXM6IE1hcDxSb3V0ZVR5cGUsIFJvdXRlUGVyZm9ybWFuY2VQcm9maWxlPjtcbiAgcHJpdmF0ZSBvcHRpbWl6YXRpb25IaXN0b3J5OiBPcHRpbWl6YXRpb25SZXN1bHRbXTtcbiAgcHJpdmF0ZSBhY3RpdmVSZWNvbW1lbmRhdGlvbnM6IE9wdGltaXphdGlvblJlY29tbWVuZGF0aW9uW107XG4gIHByaXZhdGUgYmFzZWxpbmVNZXRyaWNzOiBNYXA8c3RyaW5nLCBudW1iZXI+O1xuXG4gIHByaXZhdGUgb3B0aW1pemF0aW9uVGltZXI/OiBOb2RlSlMuVGltZW91dDtcbiAgcHJpdmF0ZSBpc09wdGltaXppbmc6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBsYXN0T3B0aW1pemF0aW9uPzogRGF0ZTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICByb3V0ZXI6IEludGVsbGlnZW50Um91dGVyLFxuICAgIHBlcmZvcm1hbmNlTW9uaXRvcjogSHlicmlkUm91dGluZ1BlcmZvcm1hbmNlTW9uaXRvcixcbiAgICBmZWF0dXJlRmxhZ3M6IEFpRmVhdHVyZUZsYWdzLFxuICAgIGF1ZGl0VHJhaWw6IEF1ZGl0VHJhaWxTeXN0ZW0sXG4gICAgY29uZmlnPzogUGFydGlhbDxPcHRpbWl6ZXJDb25maWc+XG4gICkge1xuICAgIHRoaXMucm91dGVyID0gcm91dGVyO1xuICAgIHRoaXMucGVyZm9ybWFuY2VNb25pdG9yID0gcGVyZm9ybWFuY2VNb25pdG9yO1xuICAgIHRoaXMuZmVhdHVyZUZsYWdzID0gZmVhdHVyZUZsYWdzO1xuICAgIHRoaXMuYXVkaXRUcmFpbCA9IGF1ZGl0VHJhaWw7XG4gICAgdGhpcy5jb25maWcgPSB7IC4uLkRFRkFVTFRfQ09ORklHLCAuLi5jb25maWcgfTtcblxuICAgIHRoaXMucm91dGVQcm9maWxlcyA9IG5ldyBNYXAoKTtcbiAgICB0aGlzLm9wdGltaXphdGlvbkhpc3RvcnkgPSBbXTtcbiAgICB0aGlzLmFjdGl2ZVJlY29tbWVuZGF0aW9ucyA9IFtdO1xuICAgIHRoaXMuYmFzZWxpbmVNZXRyaWNzID0gbmV3IE1hcCgpO1xuXG4gICAgdGhpcy5pbml0aWFsaXplUm91dGVQcm9maWxlcygpO1xuICAgIHRoaXMuY2FwdHVyZUJhc2VsaW5lTWV0cmljcygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0YXJ0IHRoZSBvcHRpbWl6YXRpb24gZW5naW5lXG4gICAqL1xuICBhc3luYyBzdGFydE9wdGltaXphdGlvbigpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5pc09wdGltaXppbmcpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiW1JvdXRpbmdFZmZpY2llbmN5T3B0aW1pemVyXSBBbHJlYWR5IG9wdGltaXppbmdcIik7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLmZlYXR1cmVGbGFncy5pc0VuYWJsZWQoXCJyb3V0aW5nX2VmZmljaWVuY3lfb3B0aW1pemF0aW9uXCIpKSB7XG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgXCJbUm91dGluZ0VmZmljaWVuY3lPcHRpbWl6ZXJdIE9wdGltaXphdGlvbiBkaXNhYmxlZCBieSBmZWF0dXJlIGZsYWdcIlxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhcIltSb3V0aW5nRWZmaWNpZW5jeU9wdGltaXplcl0gU3RhcnRpbmcgb3B0aW1pemF0aW9uIGVuZ2luZVwiKTtcbiAgICB0aGlzLmlzT3B0aW1pemluZyA9IHRydWU7XG5cbiAgICAvLyBJbml0aWFsIG9wdGltaXphdGlvblxuICAgIGF3YWl0IHRoaXMucnVuT3B0aW1pemF0aW9uQ3ljbGUoKTtcblxuICAgIC8vIFNjaGVkdWxlIHBlcmlvZGljIG9wdGltaXphdGlvblxuICAgIHRoaXMub3B0aW1pemF0aW9uVGltZXIgPSBzZXRJbnRlcnZhbChcbiAgICAgICgpID0+IHRoaXMucnVuT3B0aW1pemF0aW9uQ3ljbGUoKSxcbiAgICAgIHRoaXMuY29uZmlnLm9wdGltaXphdGlvbkludGVydmFsTXNcbiAgICApO1xuXG4gICAgLy8gTG9nIG9wdGltaXphdGlvbiBzdGFydFxuICAgIGF3YWl0IHRoaXMuYXVkaXRUcmFpbC5sb2dSb3V0aW5nT3B0aW1pemF0aW9uU3RhcnQoXG4gICAgICB0aGlzLmNvbmZpZy5kZWZhdWx0U3RyYXRlZ3ksXG4gICAgICB0aGlzLmNvbmZpZy50YXJnZXRQZXJmb3JtYW5jZUltcHJvdmVtZW50XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9wIHRoZSBvcHRpbWl6YXRpb24gZW5naW5lXG4gICAqL1xuICBhc3luYyBzdG9wT3B0aW1pemF0aW9uKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICghdGhpcy5pc09wdGltaXppbmcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhcIltSb3V0aW5nRWZmaWNpZW5jeU9wdGltaXplcl0gU3RvcHBpbmcgb3B0aW1pemF0aW9uIGVuZ2luZVwiKTtcbiAgICB0aGlzLmlzT3B0aW1pemluZyA9IGZhbHNlO1xuXG4gICAgaWYgKHRoaXMub3B0aW1pemF0aW9uVGltZXIpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5vcHRpbWl6YXRpb25UaW1lcik7XG4gICAgICB0aGlzLm9wdGltaXphdGlvblRpbWVyID0gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIC8vIExvZyBvcHRpbWl6YXRpb24gc3RvcFxuICAgIGF3YWl0IHRoaXMuYXVkaXRUcmFpbC5sb2dSb3V0aW5nT3B0aW1pemF0aW9uU3RvcChcbiAgICAgIHRoaXMub3B0aW1pemF0aW9uSGlzdG9yeS5sZW5ndGgsXG4gICAgICB0aGlzLmNhbGN1bGF0ZU92ZXJhbGxJbXByb3ZlbWVudCgpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSdW4gYSBzaW5nbGUgb3B0aW1pemF0aW9uIGN5Y2xlXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHJ1bk9wdGltaXphdGlvbkN5Y2xlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZyhcIltSb3V0aW5nRWZmaWNpZW5jeU9wdGltaXplcl0gUnVubmluZyBvcHRpbWl6YXRpb24gY3ljbGVcIik7XG5cbiAgICAgIC8vIFVwZGF0ZSByb3V0ZSBwZXJmb3JtYW5jZSBwcm9maWxlc1xuICAgICAgYXdhaXQgdGhpcy51cGRhdGVSb3V0ZVByb2ZpbGVzKCk7XG5cbiAgICAgIC8vIEFuYWx5emUgY3VycmVudCBwZXJmb3JtYW5jZVxuICAgICAgY29uc3QgY3VycmVudFBlcmZvcm1hbmNlID0gYXdhaXQgdGhpcy5hbmFseXplQ3VycmVudFBlcmZvcm1hbmNlKCk7XG5cbiAgICAgIC8vIEdlbmVyYXRlIG9wdGltaXphdGlvbiByZWNvbW1lbmRhdGlvbnNcbiAgICAgIGNvbnN0IHJlY29tbWVuZGF0aW9ucyA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVPcHRpbWl6YXRpb25SZWNvbW1lbmRhdGlvbnMoXG4gICAgICAgIGN1cnJlbnRQZXJmb3JtYW5jZVxuICAgICAgKTtcblxuICAgICAgaWYgKHJlY29tbWVuZGF0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgXCJbUm91dGluZ0VmZmljaWVuY3lPcHRpbWl6ZXJdIE5vIG9wdGltaXphdGlvbiByZWNvbW1lbmRhdGlvbnNcIlxuICAgICAgICApO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIEFwcGx5IGhpZ2gtcHJpb3JpdHkgcmVjb21tZW5kYXRpb25zXG4gICAgICBjb25zdCBhcHBsaWVkUmVjb21tZW5kYXRpb25zID0gYXdhaXQgdGhpcy5hcHBseVJlY29tbWVuZGF0aW9ucyhcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLmZpbHRlcihcbiAgICAgICAgICAocikgPT4gci5wcmlvcml0eSA9PT0gXCJoaWdoXCIgfHwgci5wcmlvcml0eSA9PT0gXCJjcml0aWNhbFwiXG4gICAgICAgIClcbiAgICAgICk7XG5cbiAgICAgIGlmIChhcHBsaWVkUmVjb21tZW5kYXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgLy8gQ3JlYXRlIG9wdGltaXphdGlvbiByZXN1bHRcbiAgICAgICAgY29uc3QgcmVzdWx0OiBPcHRpbWl6YXRpb25SZXN1bHQgPSB7XG4gICAgICAgICAgb3B0aW1pemF0aW9uSWQ6IHRoaXMuZ2VuZXJhdGVPcHRpbWl6YXRpb25JZCgpLFxuICAgICAgICAgIHN0cmF0ZWd5OiB0aGlzLmNvbmZpZy5kZWZhdWx0U3RyYXRlZ3ksXG4gICAgICAgICAgYXBwbGllZFJlY29tbWVuZGF0aW9ucyxcbiAgICAgICAgICBwZXJmb3JtYW5jZUltcHJvdmVtZW50OiAwLCAvLyBXaWxsIGJlIGNhbGN1bGF0ZWQgYWZ0ZXIgZXZhbHVhdGlvbiBwZXJpb2RcbiAgICAgICAgICBsYXRlbmN5SW1wcm92ZW1lbnQ6IDAsXG4gICAgICAgICAgc3VjY2Vzc1JhdGVJbXByb3ZlbWVudDogMCxcbiAgICAgICAgICBjb3N0SW1wcm92ZW1lbnQ6IDAsXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgcm9sbGJhY2tSZXF1aXJlZDogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5vcHRpbWl6YXRpb25IaXN0b3J5LnB1c2gocmVzdWx0KTtcbiAgICAgICAgdGhpcy5sYXN0T3B0aW1pemF0aW9uID0gbmV3IERhdGUoKTtcblxuICAgICAgICAvLyBMb2cgb3B0aW1pemF0aW9uXG4gICAgICAgIGF3YWl0IHRoaXMuYXVkaXRUcmFpbC5sb2dSb3V0aW5nT3B0aW1pemF0aW9uKFxuICAgICAgICAgIGFwcGxpZWRSZWNvbW1lbmRhdGlvbnMubWFwKChyKSA9PiByLmRlc2NyaXB0aW9uKSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdHJhdGVneTogdGhpcy5jb25maWcuZGVmYXVsdFN0cmF0ZWd5LFxuICAgICAgICAgICAgZXhwZWN0ZWRJbXByb3ZlbWVudDogTWF0aC5tYXgoXG4gICAgICAgICAgICAgIC4uLmFwcGxpZWRSZWNvbW1lbmRhdGlvbnMubWFwKChyKSA9PiByLmV4cGVjdGVkSW1wcm92ZW1lbnQpXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgYXBwbGllZENvdW50OiBhcHBsaWVkUmVjb21tZW5kYXRpb25zLmxlbmd0aCxcbiAgICAgICAgICB9XG4gICAgICAgICk7XG5cbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgYFtSb3V0aW5nRWZmaWNpZW5jeU9wdGltaXplcl0gQXBwbGllZCAke2FwcGxpZWRSZWNvbW1lbmRhdGlvbnMubGVuZ3RofSBvcHRpbWl6YXRpb25zYFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBFdmFsdWF0ZSBwcmV2aW91cyBvcHRpbWl6YXRpb25zXG4gICAgICBhd2FpdCB0aGlzLmV2YWx1YXRlUHJldmlvdXNPcHRpbWl6YXRpb25zKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgIFwiW1JvdXRpbmdFZmZpY2llbmN5T3B0aW1pemVyXSBFcnJvciBpbiBvcHRpbWl6YXRpb24gY3ljbGU6XCIsXG4gICAgICAgIGVycm9yXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgcm91dGUgcGVyZm9ybWFuY2UgcHJvZmlsZXNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgdXBkYXRlUm91dGVQcm9maWxlcygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBhbGxNZXRyaWNzID0gdGhpcy5wZXJmb3JtYW5jZU1vbml0b3IuZ2V0QWxsUGF0aE1ldHJpY3MoKTtcblxuICAgIGZvciAoY29uc3QgW3BhdGgsIG1ldHJpY3NdIG9mIGFsbE1ldHJpY3MuZW50cmllcygpKSB7XG4gICAgICBpZiAocGF0aCA9PT0gXCJoeWJyaWRcIiB8fCBwYXRoID09PSBcImZhbGxiYWNrXCIpIGNvbnRpbnVlOyAvLyBTa2lwIGNvbXBvc2l0ZSBwYXRoc1xuXG4gICAgICBjb25zdCByb3V0ZSA9IHBhdGggYXMgUm91dGVUeXBlO1xuICAgICAgY29uc3QgcHJvZmlsZTogUm91dGVQZXJmb3JtYW5jZVByb2ZpbGUgPSB7XG4gICAgICAgIHJvdXRlLFxuICAgICAgICBhdmVyYWdlTGF0ZW5jeU1zOiBtZXRyaWNzLmF2ZXJhZ2VMYXRlbmN5TXMsXG4gICAgICAgIHA5NUxhdGVuY3lNczogbWV0cmljcy5wOTVMYXRlbmN5TXMsXG4gICAgICAgIHN1Y2Nlc3NSYXRlOiBtZXRyaWNzLnN1Y2Nlc3NSYXRlLFxuICAgICAgICBjb3N0UGVyUmVxdWVzdDogdGhpcy5lc3RpbWF0ZUNvc3RQZXJSZXF1ZXN0KHJvdXRlLCBtZXRyaWNzKSxcbiAgICAgICAgcmVsaWFiaWxpdHk6IHRoaXMuY2FsY3VsYXRlUmVsaWFiaWxpdHkobWV0cmljcyksXG4gICAgICAgIGNhcGFjaXR5OiB0aGlzLmVzdGltYXRlQ2FwYWNpdHkocm91dGUsIG1ldHJpY3MpLFxuICAgICAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKSxcbiAgICAgIH07XG5cbiAgICAgIHRoaXMucm91dGVQcm9maWxlcy5zZXQocm91dGUsIHByb2ZpbGUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBbmFseXplIGN1cnJlbnQgcGVyZm9ybWFuY2VcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgYW5hbHl6ZUN1cnJlbnRQZXJmb3JtYW5jZSgpOiBQcm9taXNlPHtcbiAgICBvdmVyYWxsTGF0ZW5jeTogbnVtYmVyO1xuICAgIG92ZXJhbGxTdWNjZXNzUmF0ZTogbnVtYmVyO1xuICAgIG92ZXJhbGxDb3N0OiBudW1iZXI7XG4gICAgcm91dGluZ0VmZmljaWVuY3k6IG51bWJlcjtcbiAgICBib3R0bGVuZWNrczogc3RyaW5nW107XG4gIH0+IHtcbiAgICBjb25zdCBlZmZpY2llbmN5ID1cbiAgICAgIGF3YWl0IHRoaXMucGVyZm9ybWFuY2VNb25pdG9yLmNhbGN1bGF0ZVJvdXRpbmdFZmZpY2llbmN5KCk7XG4gICAgY29uc3QgYWxsTWV0cmljcyA9IHRoaXMucGVyZm9ybWFuY2VNb25pdG9yLmdldEFsbFBhdGhNZXRyaWNzKCk7XG5cbiAgICBsZXQgdG90YWxSZXF1ZXN0cyA9IDA7XG4gICAgbGV0IHdlaWdodGVkTGF0ZW5jeSA9IDA7XG4gICAgbGV0IHdlaWdodGVkU3VjY2Vzc1JhdGUgPSAwO1xuICAgIGxldCB0b3RhbENvc3QgPSAwO1xuICAgIGNvbnN0IGJvdHRsZW5lY2tzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBbcGF0aCwgbWV0cmljc10gb2YgYWxsTWV0cmljcy5lbnRyaWVzKCkpIHtcbiAgICAgIGlmIChwYXRoID09PSBcImh5YnJpZFwiIHx8IHBhdGggPT09IFwiZmFsbGJhY2tcIikgY29udGludWU7XG5cbiAgICAgIHRvdGFsUmVxdWVzdHMgKz0gbWV0cmljcy5yZXF1ZXN0Q291bnQ7XG4gICAgICB3ZWlnaHRlZExhdGVuY3kgKz0gbWV0cmljcy5hdmVyYWdlTGF0ZW5jeU1zICogbWV0cmljcy5yZXF1ZXN0Q291bnQ7XG4gICAgICB3ZWlnaHRlZFN1Y2Nlc3NSYXRlICs9IG1ldHJpY3Muc3VjY2Vzc1JhdGUgKiBtZXRyaWNzLnJlcXVlc3RDb3VudDtcblxuICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMucm91dGVQcm9maWxlcy5nZXQocGF0aCBhcyBSb3V0ZVR5cGUpO1xuICAgICAgaWYgKHByb2ZpbGUpIHtcbiAgICAgICAgdG90YWxDb3N0ICs9IHByb2ZpbGUuY29zdFBlclJlcXVlc3QgKiBtZXRyaWNzLnJlcXVlc3RDb3VudDtcblxuICAgICAgICAvLyBJZGVudGlmeSBib3R0bGVuZWNrc1xuICAgICAgICBpZiAobWV0cmljcy5wOTVMYXRlbmN5TXMgPiAxMDAwMCkge1xuICAgICAgICAgIGJvdHRsZW5lY2tzLnB1c2goXG4gICAgICAgICAgICBgSGlnaCBQOTUgbGF0ZW5jeSBvbiAke3BhdGh9OiAke21ldHJpY3MucDk1TGF0ZW5jeU1zfW1zYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1ldHJpY3Muc3VjY2Vzc1JhdGUgPCA5NSkge1xuICAgICAgICAgIGJvdHRsZW5lY2tzLnB1c2goXG4gICAgICAgICAgICBgTG93IHN1Y2Nlc3MgcmF0ZSBvbiAke3BhdGh9OiAke21ldHJpY3Muc3VjY2Vzc1JhdGUudG9GaXhlZCgyKX0lYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgb3ZlcmFsbExhdGVuY3k6IHRvdGFsUmVxdWVzdHMgPiAwID8gd2VpZ2h0ZWRMYXRlbmN5IC8gdG90YWxSZXF1ZXN0cyA6IDAsXG4gICAgICBvdmVyYWxsU3VjY2Vzc1JhdGU6XG4gICAgICAgIHRvdGFsUmVxdWVzdHMgPiAwID8gd2VpZ2h0ZWRTdWNjZXNzUmF0ZSAvIHRvdGFsUmVxdWVzdHMgOiAxMDAsXG4gICAgICBvdmVyYWxsQ29zdDogdG90YWxDb3N0LFxuICAgICAgcm91dGluZ0VmZmljaWVuY3k6IGVmZmljaWVuY3kub3ZlcmFsbEVmZmljaWVuY3ksXG4gICAgICBib3R0bGVuZWNrcyxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIG9wdGltaXphdGlvbiByZWNvbW1lbmRhdGlvbnNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVPcHRpbWl6YXRpb25SZWNvbW1lbmRhdGlvbnMoXG4gICAgcGVyZm9ybWFuY2U6IGFueVxuICApOiBQcm9taXNlPE9wdGltaXphdGlvblJlY29tbWVuZGF0aW9uW10+IHtcbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnM6IE9wdGltaXphdGlvblJlY29tbWVuZGF0aW9uW10gPSBbXTtcblxuICAgIC8vIENoZWNrIGlmIHdlIGhhdmUgZW5vdWdoIGRhdGFcbiAgICBjb25zdCB0b3RhbFJlcXVlc3RzID0gQXJyYXkuZnJvbShcbiAgICAgIHRoaXMucGVyZm9ybWFuY2VNb25pdG9yLmdldEFsbFBhdGhNZXRyaWNzKCkudmFsdWVzKClcbiAgICApLnJlZHVjZSgoc3VtLCBtZXRyaWNzKSA9PiBzdW0gKyBtZXRyaWNzLnJlcXVlc3RDb3VudCwgMCk7XG5cbiAgICBpZiAodG90YWxSZXF1ZXN0cyA8IHRoaXMuY29uZmlnLm1pbkRhdGFQb2ludHNSZXF1aXJlZCkge1xuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIFwiW1JvdXRpbmdFZmZpY2llbmN5T3B0aW1pemVyXSBJbnN1ZmZpY2llbnQgZGF0YSBmb3Igb3B0aW1pemF0aW9uXCJcbiAgICAgICk7XG4gICAgICByZXR1cm4gcmVjb21tZW5kYXRpb25zO1xuICAgIH1cblxuICAgIC8vIExhdGVuY3kgb3B0aW1pemF0aW9uIHJlY29tbWVuZGF0aW9uc1xuICAgIGlmIChwZXJmb3JtYW5jZS5vdmVyYWxsTGF0ZW5jeSA+IDUwMDApIHtcbiAgICAgIGNvbnN0IGRpcmVjdFByb2ZpbGUgPSB0aGlzLnJvdXRlUHJvZmlsZXMuZ2V0KFwiZGlyZWN0XCIpO1xuICAgICAgY29uc3QgbWNwUHJvZmlsZSA9IHRoaXMucm91dGVQcm9maWxlcy5nZXQoXCJtY3BcIik7XG5cbiAgICAgIGlmIChkaXJlY3RQcm9maWxlICYmIG1jcFByb2ZpbGUpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGRpcmVjdFByb2ZpbGUuYXZlcmFnZUxhdGVuY3lNcyA8XG4gICAgICAgICAgbWNwUHJvZmlsZS5hdmVyYWdlTGF0ZW5jeU1zICogMC44XG4gICAgICAgICkge1xuICAgICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKHtcbiAgICAgICAgICAgIGlkOiB0aGlzLmdlbmVyYXRlUmVjb21tZW5kYXRpb25JZCgpLFxuICAgICAgICAgICAgdHlwZTogXCJydWxlX2FkanVzdG1lbnRcIixcbiAgICAgICAgICAgIHByaW9yaXR5OiBcImhpZ2hcIixcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOlxuICAgICAgICAgICAgICBcIlJvdXRlIG1vcmUgb3BlcmF0aW9ucyB0byBkaXJlY3QgQmVkcm9jayBmb3IgYmV0dGVyIGxhdGVuY3lcIixcbiAgICAgICAgICAgIGV4cGVjdGVkSW1wcm92ZW1lbnQ6IDI1LFxuICAgICAgICAgICAgaW1wbGVtZW50YXRpb246IHtcbiAgICAgICAgICAgICAgYWN0aW9uOiBcImFkanVzdF9yb3V0aW5nX3RocmVzaG9sZHNcIixcbiAgICAgICAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgICAgICAgIGluY3JlYXNlRGlyZWN0Um91dGluZzogdHJ1ZSxcbiAgICAgICAgICAgICAgICBsYXRlbmN5VGhyZXNob2xkOiA4MDAwLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICByb2xsYmFja1BsYW46IFwiUmV2ZXJ0IHRvIHByZXZpb3VzIHJvdXRpbmcgdGhyZXNob2xkc1wiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbmZpZGVuY2U6IDAuODUsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTdWNjZXNzIHJhdGUgb3B0aW1pemF0aW9uIHJlY29tbWVuZGF0aW9uc1xuICAgIGlmIChwZXJmb3JtYW5jZS5vdmVyYWxsU3VjY2Vzc1JhdGUgPCA5NSkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goe1xuICAgICAgICBpZDogdGhpcy5nZW5lcmF0ZVJlY29tbWVuZGF0aW9uSWQoKSxcbiAgICAgICAgdHlwZTogXCJyb3V0ZV9jaGFuZ2VcIixcbiAgICAgICAgcHJpb3JpdHk6IFwiY3JpdGljYWxcIixcbiAgICAgICAgZGVzY3JpcHRpb246IFwiSW1wbGVtZW50IGNpcmN1aXQgYnJlYWtlciB3aXRoIGZhc3RlciBmYWlsb3ZlclwiLFxuICAgICAgICBleHBlY3RlZEltcHJvdmVtZW50OiAxNSxcbiAgICAgICAgaW1wbGVtZW50YXRpb246IHtcbiAgICAgICAgICBhY3Rpb246IFwidXBkYXRlX2NpcmN1aXRfYnJlYWtlcl9jb25maWdcIixcbiAgICAgICAgICBwYXJhbWV0ZXJzOiB7XG4gICAgICAgICAgICBmYWlsdXJlVGhyZXNob2xkOiAyLFxuICAgICAgICAgICAgcmVjb3ZlcnlUaW1lb3V0OiAxNTAwMCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJvbGxiYWNrUGxhbjogXCJSZXZlcnQgY2lyY3VpdCBicmVha2VyIHRvIHByZXZpb3VzIGNvbmZpZ3VyYXRpb25cIixcbiAgICAgICAgfSxcbiAgICAgICAgY29uZmlkZW5jZTogMC45LFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBDb3N0IG9wdGltaXphdGlvbiByZWNvbW1lbmRhdGlvbnNcbiAgICBjb25zdCBiYXNlbGluZUNvc3QgPSB0aGlzLmJhc2VsaW5lTWV0cmljcy5nZXQoXCJ0b3RhbENvc3RcIikgfHwgMDtcbiAgICBpZiAocGVyZm9ybWFuY2Uub3ZlcmFsbENvc3QgPiBiYXNlbGluZUNvc3QgKiAxLjIpIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKHtcbiAgICAgICAgaWQ6IHRoaXMuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbklkKCksXG4gICAgICAgIHR5cGU6IFwic3RyYXRlZ3lfY2hhbmdlXCIsXG4gICAgICAgIHByaW9yaXR5OiBcIm1lZGl1bVwiLFxuICAgICAgICBkZXNjcmlwdGlvbjogXCJSb3V0ZSBzdGFuZGFyZCBvcGVyYXRpb25zIHRvIE1DUCB0byByZWR1Y2UgY29zdHNcIixcbiAgICAgICAgZXhwZWN0ZWRJbXByb3ZlbWVudDogMzAsXG4gICAgICAgIGltcGxlbWVudGF0aW9uOiB7XG4gICAgICAgICAgYWN0aW9uOiBcInVwZGF0ZV9yb3V0aW5nX3N0cmF0ZWd5XCIsXG4gICAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgICAgc3RyYXRlZ3k6IE9wdGltaXphdGlvblN0cmF0ZWd5LkNPU1RfRUZGSUNJRU5ULFxuICAgICAgICAgICAgbWNwUHJlZmVyZW5jZTogMC44LFxuICAgICAgICAgIH0sXG4gICAgICAgICAgcm9sbGJhY2tQbGFuOiBcIlJldmVydCB0byBiYWxhbmNlZCByb3V0aW5nIHN0cmF0ZWd5XCIsXG4gICAgICAgIH0sXG4gICAgICAgIGNvbmZpZGVuY2U6IDAuNzUsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFJvdXRpbmcgZWZmaWNpZW5jeSByZWNvbW1lbmRhdGlvbnNcbiAgICBpZiAocGVyZm9ybWFuY2Uucm91dGluZ0VmZmljaWVuY3kgPCA4MCkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goe1xuICAgICAgICBpZDogdGhpcy5nZW5lcmF0ZVJlY29tbWVuZGF0aW9uSWQoKSxcbiAgICAgICAgdHlwZTogXCJ0aHJlc2hvbGRfdXBkYXRlXCIsXG4gICAgICAgIHByaW9yaXR5OiBcImhpZ2hcIixcbiAgICAgICAgZGVzY3JpcHRpb246XG4gICAgICAgICAgXCJPcHRpbWl6ZSByb3V0aW5nIGRlY2lzaW9uIHRocmVzaG9sZHMgYmFzZWQgb24gY3VycmVudCBwZXJmb3JtYW5jZVwiLFxuICAgICAgICBleHBlY3RlZEltcHJvdmVtZW50OiAyMCxcbiAgICAgICAgaW1wbGVtZW50YXRpb246IHtcbiAgICAgICAgICBhY3Rpb246IFwib3B0aW1pemVfcm91dGluZ190aHJlc2hvbGRzXCIsXG4gICAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgICAgYWRhcHRpdmVUaHJlc2hvbGRzOiB0cnVlLFxuICAgICAgICAgICAgcGVyZm9ybWFuY2VXZWlnaHRpbmc6IDAuNyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJvbGxiYWNrUGxhbjogXCJSZXZlcnQgdG8gc3RhdGljIHJvdXRpbmcgdGhyZXNob2xkc1wiLFxuICAgICAgICB9LFxuICAgICAgICBjb25maWRlbmNlOiAwLjgsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEFkYXB0aXZlIHN0cmF0ZWd5IHJlY29tbWVuZGF0aW9uXG4gICAgaWYgKHRoaXMuY29uZmlnLmVuYWJsZUFkYXB0aXZlU3RyYXRlZ3kgJiYgcmVjb21tZW5kYXRpb25zLmxlbmd0aCA+IDIpIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKHtcbiAgICAgICAgaWQ6IHRoaXMuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbklkKCksXG4gICAgICAgIHR5cGU6IFwic3RyYXRlZ3lfY2hhbmdlXCIsXG4gICAgICAgIHByaW9yaXR5OiBcIm1lZGl1bVwiLFxuICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICBcIkVuYWJsZSBhZGFwdGl2ZSByb3V0aW5nIHN0cmF0ZWd5IGZvciBkeW5hbWljIG9wdGltaXphdGlvblwiLFxuICAgICAgICBleHBlY3RlZEltcHJvdmVtZW50OiAxOCxcbiAgICAgICAgaW1wbGVtZW50YXRpb246IHtcbiAgICAgICAgICBhY3Rpb246IFwiZW5hYmxlX2FkYXB0aXZlX3N0cmF0ZWd5XCIsXG4gICAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgICAgc3RyYXRlZ3k6IE9wdGltaXphdGlvblN0cmF0ZWd5LkFEQVBUSVZFLFxuICAgICAgICAgICAgYWRhcHRhdGlvbkludGVydmFsOiA2MDAwMCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJvbGxiYWNrUGxhbjogXCJEaXNhYmxlIGFkYXB0aXZlIHN0cmF0ZWd5XCIsXG4gICAgICAgIH0sXG4gICAgICAgIGNvbmZpZGVuY2U6IDAuNyxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlY29tbWVuZGF0aW9ucy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICBjb25zdCBwcmlvcml0eU9yZGVyID0geyBjcml0aWNhbDogNCwgaGlnaDogMywgbWVkaXVtOiAyLCBsb3c6IDEgfTtcbiAgICAgIHJldHVybiBwcmlvcml0eU9yZGVyW2IucHJpb3JpdHldIC0gcHJpb3JpdHlPcmRlclthLnByaW9yaXR5XTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBcHBseSBvcHRpbWl6YXRpb24gcmVjb21tZW5kYXRpb25zXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGFwcGx5UmVjb21tZW5kYXRpb25zKFxuICAgIHJlY29tbWVuZGF0aW9uczogT3B0aW1pemF0aW9uUmVjb21tZW5kYXRpb25bXVxuICApOiBQcm9taXNlPE9wdGltaXphdGlvblJlY29tbWVuZGF0aW9uW10+IHtcbiAgICBjb25zdCBhcHBsaWVkOiBPcHRpbWl6YXRpb25SZWNvbW1lbmRhdGlvbltdID0gW107XG4gICAgbGV0IGNoYW5nZXNBcHBsaWVkID0gMDtcblxuICAgIGZvciAoY29uc3QgcmVjb21tZW5kYXRpb24gb2YgcmVjb21tZW5kYXRpb25zKSB7XG4gICAgICBpZiAoY2hhbmdlc0FwcGxpZWQgPj0gdGhpcy5jb25maWcubWF4Um91dGluZ1J1bGVDaGFuZ2VzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgIFwiW1JvdXRpbmdFZmZpY2llbmN5T3B0aW1pemVyXSBNYXhpbXVtIGNoYW5nZXMgcGVyIGN5Y2xlIHJlYWNoZWRcIlxuICAgICAgICApO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc3VjY2VzcyA9IGF3YWl0IHRoaXMuYXBwbHlSZWNvbW1lbmRhdGlvbihyZWNvbW1lbmRhdGlvbik7XG4gICAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgICAgYXBwbGllZC5wdXNoKHJlY29tbWVuZGF0aW9uKTtcbiAgICAgICAgICBjaGFuZ2VzQXBwbGllZCsrO1xuXG4gICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICBgW1JvdXRpbmdFZmZpY2llbmN5T3B0aW1pemVyXSBBcHBsaWVkOiAke3JlY29tbWVuZGF0aW9uLmRlc2NyaXB0aW9ufWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICAgIGBbUm91dGluZ0VmZmljaWVuY3lPcHRpbWl6ZXJdIEZhaWxlZCB0byBhcHBseSByZWNvbW1lbmRhdGlvbjogJHtyZWNvbW1lbmRhdGlvbi5kZXNjcmlwdGlvbn1gLFxuICAgICAgICAgIGVycm9yXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5hY3RpdmVSZWNvbW1lbmRhdGlvbnMucHVzaCguLi5hcHBsaWVkKTtcbiAgICByZXR1cm4gYXBwbGllZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBBcHBseSBhIHNpbmdsZSByZWNvbW1lbmRhdGlvblxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBhcHBseVJlY29tbWVuZGF0aW9uKFxuICAgIHJlY29tbWVuZGF0aW9uOiBPcHRpbWl6YXRpb25SZWNvbW1lbmRhdGlvblxuICApOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCB7IGFjdGlvbiwgcGFyYW1ldGVycyB9ID0gcmVjb21tZW5kYXRpb24uaW1wbGVtZW50YXRpb247XG5cbiAgICBzd2l0Y2ggKGFjdGlvbikge1xuICAgICAgY2FzZSBcImFkanVzdF9yb3V0aW5nX3RocmVzaG9sZHNcIjpcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRqdXN0Um91dGluZ1RocmVzaG9sZHMocGFyYW1ldGVycyk7XG5cbiAgICAgIGNhc2UgXCJ1cGRhdGVfY2lyY3VpdF9icmVha2VyX2NvbmZpZ1wiOlxuICAgICAgICByZXR1cm4gdGhpcy51cGRhdGVDaXJjdWl0QnJlYWtlckNvbmZpZyhwYXJhbWV0ZXJzKTtcblxuICAgICAgY2FzZSBcInVwZGF0ZV9yb3V0aW5nX3N0cmF0ZWd5XCI6XG4gICAgICAgIHJldHVybiB0aGlzLnVwZGF0ZVJvdXRpbmdTdHJhdGVneShwYXJhbWV0ZXJzKTtcblxuICAgICAgY2FzZSBcIm9wdGltaXplX3JvdXRpbmdfdGhyZXNob2xkc1wiOlxuICAgICAgICByZXR1cm4gdGhpcy5vcHRpbWl6ZVJvdXRpbmdUaHJlc2hvbGRzKHBhcmFtZXRlcnMpO1xuXG4gICAgICBjYXNlIFwiZW5hYmxlX2FkYXB0aXZlX3N0cmF0ZWd5XCI6XG4gICAgICAgIHJldHVybiB0aGlzLmVuYWJsZUFkYXB0aXZlU3RyYXRlZ3kocGFyYW1ldGVycyk7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGNvbnNvbGUud2FybihgW1JvdXRpbmdFZmZpY2llbmN5T3B0aW1pemVyXSBVbmtub3duIGFjdGlvbjogJHthY3Rpb259YCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQWRqdXN0IHJvdXRpbmcgdGhyZXNob2xkc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBhZGp1c3RSb3V0aW5nVGhyZXNob2xkcyhwYXJhbWV0ZXJzOiBhbnkpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgLy8gR2V0IGN1cnJlbnQgcm91dGluZyBydWxlc1xuICAgICAgY29uc3QgY3VycmVudFJ1bGVzID0gdGhpcy5yb3V0ZXIuZ2V0Um91dGluZ1J1bGVzPy4oKSB8fCBbXTtcblxuICAgICAgLy8gQWRqdXN0IGxhdGVuY3kgdGhyZXNob2xkc1xuICAgICAgY29uc3QgdXBkYXRlZFJ1bGVzID0gY3VycmVudFJ1bGVzLm1hcCgocnVsZSkgPT4gKHtcbiAgICAgICAgLi4ucnVsZSxcbiAgICAgICAgbGF0ZW5jeVJlcXVpcmVtZW50OlxuICAgICAgICAgIHBhcmFtZXRlcnMubGF0ZW5jeVRocmVzaG9sZCB8fCBydWxlLmxhdGVuY3lSZXF1aXJlbWVudCxcbiAgICAgIH0pKTtcblxuICAgICAgLy8gVXBkYXRlIHJvdXRlciB3aXRoIG5ldyBydWxlc1xuICAgICAgdGhpcy5yb3V0ZXIudXBkYXRlUm91dGluZ1J1bGVzPy4odXBkYXRlZFJ1bGVzKTtcblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgIFwiW1JvdXRpbmdFZmZpY2llbmN5T3B0aW1pemVyXSBFcnJvciBhZGp1c3Rpbmcgcm91dGluZyB0aHJlc2hvbGRzOlwiLFxuICAgICAgICBlcnJvclxuICAgICAgKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGNpcmN1aXQgYnJlYWtlciBjb25maWd1cmF0aW9uXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHVwZGF0ZUNpcmN1aXRCcmVha2VyQ29uZmlnKHBhcmFtZXRlcnM6IGFueSk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBUaGlzIHdvdWxkIGludGVncmF0ZSB3aXRoIHRoZSBjaXJjdWl0IGJyZWFrZXIgc3lzdGVtXG4gICAgICAvLyBGb3Igbm93LCB3ZSdsbCBsb2cgdGhlIGNvbmZpZ3VyYXRpb24gY2hhbmdlXG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgXCJbUm91dGluZ0VmZmljaWVuY3lPcHRpbWl6ZXJdIENpcmN1aXQgYnJlYWtlciBjb25maWcgdXBkYXRlZDpcIixcbiAgICAgICAgcGFyYW1ldGVyc1xuICAgICAgKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICBcIltSb3V0aW5nRWZmaWNpZW5jeU9wdGltaXplcl0gRXJyb3IgdXBkYXRpbmcgY2lyY3VpdCBicmVha2VyOlwiLFxuICAgICAgICBlcnJvclxuICAgICAgKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHJvdXRpbmcgc3RyYXRlZ3lcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgdXBkYXRlUm91dGluZ1N0cmF0ZWd5KHBhcmFtZXRlcnM6IGFueSk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLmNvbmZpZy5kZWZhdWx0U3RyYXRlZ3kgPSBwYXJhbWV0ZXJzLnN0cmF0ZWd5O1xuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIGBbUm91dGluZ0VmZmljaWVuY3lPcHRpbWl6ZXJdIFN0cmF0ZWd5IHVwZGF0ZWQgdG86ICR7cGFyYW1ldGVycy5zdHJhdGVneX1gXG4gICAgICApO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgIFwiW1JvdXRpbmdFZmZpY2llbmN5T3B0aW1pemVyXSBFcnJvciB1cGRhdGluZyBzdHJhdGVneTpcIixcbiAgICAgICAgZXJyb3JcbiAgICAgICk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE9wdGltaXplIHJvdXRpbmcgdGhyZXNob2xkc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBvcHRpbWl6ZVJvdXRpbmdUaHJlc2hvbGRzKHBhcmFtZXRlcnM6IGFueSk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBJbXBsZW1lbnQgYWRhcHRpdmUgdGhyZXNob2xkIG9wdGltaXphdGlvblxuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIFwiW1JvdXRpbmdFZmZpY2llbmN5T3B0aW1pemVyXSBSb3V0aW5nIHRocmVzaG9sZHMgb3B0aW1pemVkOlwiLFxuICAgICAgICBwYXJhbWV0ZXJzXG4gICAgICApO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgIFwiW1JvdXRpbmdFZmZpY2llbmN5T3B0aW1pemVyXSBFcnJvciBvcHRpbWl6aW5nIHRocmVzaG9sZHM6XCIsXG4gICAgICAgIGVycm9yXG4gICAgICApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFbmFibGUgYWRhcHRpdmUgc3RyYXRlZ3lcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZW5hYmxlQWRhcHRpdmVTdHJhdGVneShwYXJhbWV0ZXJzOiBhbnkpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5jb25maWcuZW5hYmxlQWRhcHRpdmVTdHJhdGVneSA9IHRydWU7XG4gICAgICB0aGlzLmNvbmZpZy5kZWZhdWx0U3RyYXRlZ3kgPSBPcHRpbWl6YXRpb25TdHJhdGVneS5BREFQVElWRTtcbiAgICAgIGNvbnNvbGUubG9nKFwiW1JvdXRpbmdFZmZpY2llbmN5T3B0aW1pemVyXSBBZGFwdGl2ZSBzdHJhdGVneSBlbmFibGVkXCIpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgIFwiW1JvdXRpbmdFZmZpY2llbmN5T3B0aW1pemVyXSBFcnJvciBlbmFibGluZyBhZGFwdGl2ZSBzdHJhdGVneTpcIixcbiAgICAgICAgZXJyb3JcbiAgICAgICk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEV2YWx1YXRlIHByZXZpb3VzIG9wdGltaXphdGlvbnNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZXZhbHVhdGVQcmV2aW91c09wdGltaXphdGlvbnMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgZXZhbHVhdGlvbldpbmRvdyA9IHRoaXMuY29uZmlnLnBlcmZvcm1hbmNlRXZhbHVhdGlvbldpbmRvd01zO1xuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG5cbiAgICBmb3IgKGNvbnN0IHJlc3VsdCBvZiB0aGlzLm9wdGltaXphdGlvbkhpc3RvcnkpIHtcbiAgICAgIGlmIChyZXN1bHQucGVyZm9ybWFuY2VJbXByb3ZlbWVudCAhPT0gMCkgY29udGludWU7IC8vIEFscmVhZHkgZXZhbHVhdGVkXG5cbiAgICAgIGNvbnN0IHRpbWVTaW5jZU9wdGltaXphdGlvbiA9IG5vdyAtIHJlc3VsdC50aW1lc3RhbXAuZ2V0VGltZSgpO1xuICAgICAgaWYgKHRpbWVTaW5jZU9wdGltaXphdGlvbiA8IGV2YWx1YXRpb25XaW5kb3cpIGNvbnRpbnVlOyAvLyBUb28gZWFybHkgdG8gZXZhbHVhdGVcblxuICAgICAgLy8gQ2FsY3VsYXRlIGFjdHVhbCBwZXJmb3JtYW5jZSBpbXByb3ZlbWVudFxuICAgICAgY29uc3QgaW1wcm92ZW1lbnQgPSBhd2FpdCB0aGlzLmNhbGN1bGF0ZVBlcmZvcm1hbmNlSW1wcm92ZW1lbnQocmVzdWx0KTtcblxuICAgICAgcmVzdWx0LnBlcmZvcm1hbmNlSW1wcm92ZW1lbnQgPSBpbXByb3ZlbWVudC5vdmVyYWxsO1xuICAgICAgcmVzdWx0LmxhdGVuY3lJbXByb3ZlbWVudCA9IGltcHJvdmVtZW50LmxhdGVuY3k7XG4gICAgICByZXN1bHQuc3VjY2Vzc1JhdGVJbXByb3ZlbWVudCA9IGltcHJvdmVtZW50LnN1Y2Nlc3NSYXRlO1xuICAgICAgcmVzdWx0LmNvc3RJbXByb3ZlbWVudCA9IGltcHJvdmVtZW50LmNvc3Q7XG5cbiAgICAgIC8vIENoZWNrIGlmIHJvbGxiYWNrIGlzIG5lZWRlZFxuICAgICAgaWYgKFxuICAgICAgICBpbXByb3ZlbWVudC5vdmVyYWxsIDwgdGhpcy5jb25maWcucm9sbGJhY2tUaHJlc2hvbGQgJiZcbiAgICAgICAgdGhpcy5jb25maWcuZW5hYmxlQXV0b21hdGljUm9sbGJhY2tcbiAgICAgICkge1xuICAgICAgICBhd2FpdCB0aGlzLnJvbGxiYWNrT3B0aW1pemF0aW9uKHJlc3VsdCk7XG4gICAgICAgIHJlc3VsdC5yb2xsYmFja1JlcXVpcmVkID0gdHJ1ZTtcbiAgICAgICAgcmVzdWx0LnN1Y2Nlc3MgPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIGBbUm91dGluZ0VmZmljaWVuY3lPcHRpbWl6ZXJdIE9wdGltaXphdGlvbiAke1xuICAgICAgICAgIHJlc3VsdC5vcHRpbWl6YXRpb25JZFxuICAgICAgICB9IGV2YWx1YXRlZDogJHtpbXByb3ZlbWVudC5vdmVyYWxsLnRvRml4ZWQoMil9JSBpbXByb3ZlbWVudGBcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSBwZXJmb3JtYW5jZSBpbXByb3ZlbWVudFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjYWxjdWxhdGVQZXJmb3JtYW5jZUltcHJvdmVtZW50KFxuICAgIHJlc3VsdDogT3B0aW1pemF0aW9uUmVzdWx0XG4gICk6IFByb21pc2U8e1xuICAgIG92ZXJhbGw6IG51bWJlcjtcbiAgICBsYXRlbmN5OiBudW1iZXI7XG4gICAgc3VjY2Vzc1JhdGU6IG51bWJlcjtcbiAgICBjb3N0OiBudW1iZXI7XG4gIH0+IHtcbiAgICBjb25zdCBjdXJyZW50UGVyZm9ybWFuY2UgPSBhd2FpdCB0aGlzLmFuYWx5emVDdXJyZW50UGVyZm9ybWFuY2UoKTtcblxuICAgIGNvbnN0IGJhc2VsaW5lTGF0ZW5jeSA9XG4gICAgICB0aGlzLmJhc2VsaW5lTWV0cmljcy5nZXQoXCJhdmVyYWdlTGF0ZW5jeVwiKSB8fFxuICAgICAgY3VycmVudFBlcmZvcm1hbmNlLm92ZXJhbGxMYXRlbmN5O1xuICAgIGNvbnN0IGJhc2VsaW5lU3VjY2Vzc1JhdGUgPVxuICAgICAgdGhpcy5iYXNlbGluZU1ldHJpY3MuZ2V0KFwic3VjY2Vzc1JhdGVcIikgfHxcbiAgICAgIGN1cnJlbnRQZXJmb3JtYW5jZS5vdmVyYWxsU3VjY2Vzc1JhdGU7XG4gICAgY29uc3QgYmFzZWxpbmVDb3N0ID1cbiAgICAgIHRoaXMuYmFzZWxpbmVNZXRyaWNzLmdldChcInRvdGFsQ29zdFwiKSB8fCBjdXJyZW50UGVyZm9ybWFuY2Uub3ZlcmFsbENvc3Q7XG5cbiAgICBjb25zdCBsYXRlbmN5SW1wcm92ZW1lbnQgPVxuICAgICAgKChiYXNlbGluZUxhdGVuY3kgLSBjdXJyZW50UGVyZm9ybWFuY2Uub3ZlcmFsbExhdGVuY3kpIC9cbiAgICAgICAgYmFzZWxpbmVMYXRlbmN5KSAqXG4gICAgICAxMDA7XG4gICAgY29uc3Qgc3VjY2Vzc1JhdGVJbXByb3ZlbWVudCA9XG4gICAgICAoKGN1cnJlbnRQZXJmb3JtYW5jZS5vdmVyYWxsU3VjY2Vzc1JhdGUgLSBiYXNlbGluZVN1Y2Nlc3NSYXRlKSAvXG4gICAgICAgIGJhc2VsaW5lU3VjY2Vzc1JhdGUpICpcbiAgICAgIDEwMDtcbiAgICBjb25zdCBjb3N0SW1wcm92ZW1lbnQgPVxuICAgICAgKChiYXNlbGluZUNvc3QgLSBjdXJyZW50UGVyZm9ybWFuY2Uub3ZlcmFsbENvc3QpIC8gYmFzZWxpbmVDb3N0KSAqIDEwMDtcblxuICAgIC8vIE92ZXJhbGwgaW1wcm92ZW1lbnQgaXMgd2VpZ2h0ZWQgYXZlcmFnZVxuICAgIGNvbnN0IG92ZXJhbGxJbXByb3ZlbWVudCA9XG4gICAgICBsYXRlbmN5SW1wcm92ZW1lbnQgKiAwLjQgK1xuICAgICAgc3VjY2Vzc1JhdGVJbXByb3ZlbWVudCAqIDAuMyArXG4gICAgICBjb3N0SW1wcm92ZW1lbnQgKiAwLjM7XG5cbiAgICByZXR1cm4ge1xuICAgICAgb3ZlcmFsbDogb3ZlcmFsbEltcHJvdmVtZW50LFxuICAgICAgbGF0ZW5jeTogbGF0ZW5jeUltcHJvdmVtZW50LFxuICAgICAgc3VjY2Vzc1JhdGU6IHN1Y2Nlc3NSYXRlSW1wcm92ZW1lbnQsXG4gICAgICBjb3N0OiBjb3N0SW1wcm92ZW1lbnQsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSb2xsYmFjayBvcHRpbWl6YXRpb25cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgcm9sbGJhY2tPcHRpbWl6YXRpb24oXG4gICAgcmVzdWx0OiBPcHRpbWl6YXRpb25SZXN1bHRcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc29sZS5sb2coXG4gICAgICBgW1JvdXRpbmdFZmZpY2llbmN5T3B0aW1pemVyXSBSb2xsaW5nIGJhY2sgb3B0aW1pemF0aW9uOiAke3Jlc3VsdC5vcHRpbWl6YXRpb25JZH1gXG4gICAgKTtcblxuICAgIGZvciAoY29uc3QgcmVjb21tZW5kYXRpb24gb2YgcmVzdWx0LmFwcGxpZWRSZWNvbW1lbmRhdGlvbnMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIEV4ZWN1dGUgcm9sbGJhY2sgcGxhblxuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICBgW1JvdXRpbmdFZmZpY2llbmN5T3B0aW1pemVyXSBSb2xsYmFjazogJHtyZWNvbW1lbmRhdGlvbi5pbXBsZW1lbnRhdGlvbi5yb2xsYmFja1BsYW59YFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIExvZyByb2xsYmFja1xuICAgICAgICBhd2FpdCB0aGlzLmF1ZGl0VHJhaWwubG9nUm91dGluZ09wdGltaXphdGlvblJvbGxiYWNrKFxuICAgICAgICAgIHJlc3VsdC5vcHRpbWl6YXRpb25JZCxcbiAgICAgICAgICByZWNvbW1lbmRhdGlvbi5kZXNjcmlwdGlvbixcbiAgICAgICAgICByZXN1bHQucGVyZm9ybWFuY2VJbXByb3ZlbWVudFxuICAgICAgICApO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcbiAgICAgICAgICBgW1JvdXRpbmdFZmZpY2llbmN5T3B0aW1pemVyXSBSb2xsYmFjayBmYWlsZWQgZm9yOiAke3JlY29tbWVuZGF0aW9uLmRlc2NyaXB0aW9ufWAsXG4gICAgICAgICAgZXJyb3JcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IG9wdGltaXphdGlvbiBzdGF0dXNcbiAgICovXG4gIGdldE9wdGltaXphdGlvblN0YXR1cygpOiB7XG4gICAgaXNPcHRpbWl6aW5nOiBib29sZWFuO1xuICAgIGxhc3RPcHRpbWl6YXRpb24/OiBEYXRlO1xuICAgIHRvdGFsT3B0aW1pemF0aW9uczogbnVtYmVyO1xuICAgIG92ZXJhbGxJbXByb3ZlbWVudDogbnVtYmVyO1xuICAgIGFjdGl2ZVJlY29tbWVuZGF0aW9uczogbnVtYmVyO1xuICAgIHRhcmdldEFjaGlldmVkOiBib29sZWFuO1xuICB9IHtcbiAgICBjb25zdCBvdmVyYWxsSW1wcm92ZW1lbnQgPSB0aGlzLmNhbGN1bGF0ZU92ZXJhbGxJbXByb3ZlbWVudCgpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGlzT3B0aW1pemluZzogdGhpcy5pc09wdGltaXppbmcsXG4gICAgICBsYXN0T3B0aW1pemF0aW9uOiB0aGlzLmxhc3RPcHRpbWl6YXRpb24sXG4gICAgICB0b3RhbE9wdGltaXphdGlvbnM6IHRoaXMub3B0aW1pemF0aW9uSGlzdG9yeS5sZW5ndGgsXG4gICAgICBvdmVyYWxsSW1wcm92ZW1lbnQsXG4gICAgICBhY3RpdmVSZWNvbW1lbmRhdGlvbnM6IHRoaXMuYWN0aXZlUmVjb21tZW5kYXRpb25zLmxlbmd0aCxcbiAgICAgIHRhcmdldEFjaGlldmVkOlxuICAgICAgICBvdmVyYWxsSW1wcm92ZW1lbnQgPj0gdGhpcy5jb25maWcudGFyZ2V0UGVyZm9ybWFuY2VJbXByb3ZlbWVudCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBvcHRpbWl6YXRpb24gaGlzdG9yeVxuICAgKi9cbiAgZ2V0T3B0aW1pemF0aW9uSGlzdG9yeSgpOiBPcHRpbWl6YXRpb25SZXN1bHRbXSB7XG4gICAgcmV0dXJuIFsuLi50aGlzLm9wdGltaXphdGlvbkhpc3RvcnldO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhY3RpdmUgcmVjb21tZW5kYXRpb25zXG4gICAqL1xuICBnZXRBY3RpdmVSZWNvbW1lbmRhdGlvbnMoKTogT3B0aW1pemF0aW9uUmVjb21tZW5kYXRpb25bXSB7XG4gICAgcmV0dXJuIFsuLi50aGlzLmFjdGl2ZVJlY29tbWVuZGF0aW9uc107XG4gIH1cblxuICAvLyBQcml2YXRlIGhlbHBlciBtZXRob2RzXG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplUm91dGVQcm9maWxlcygpOiB2b2lkIHtcbiAgICBjb25zdCByb3V0ZXM6IFJvdXRlVHlwZVtdID0gW1wiZGlyZWN0XCIsIFwibWNwXCJdO1xuXG4gICAgZm9yIChjb25zdCByb3V0ZSBvZiByb3V0ZXMpIHtcbiAgICAgIHRoaXMucm91dGVQcm9maWxlcy5zZXQocm91dGUsIHtcbiAgICAgICAgcm91dGUsXG4gICAgICAgIGF2ZXJhZ2VMYXRlbmN5TXM6IDAsXG4gICAgICAgIHA5NUxhdGVuY3lNczogMCxcbiAgICAgICAgc3VjY2Vzc1JhdGU6IDEwMCxcbiAgICAgICAgY29zdFBlclJlcXVlc3Q6IDAsXG4gICAgICAgIHJlbGlhYmlsaXR5OiAxLjAsXG4gICAgICAgIGNhcGFjaXR5OiAxLjAsXG4gICAgICAgIGxhc3RVcGRhdGVkOiBuZXcgRGF0ZSgpLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjYXB0dXJlQmFzZWxpbmVNZXRyaWNzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHBlcmZvcm1hbmNlID0gYXdhaXQgdGhpcy5hbmFseXplQ3VycmVudFBlcmZvcm1hbmNlKCk7XG5cbiAgICB0aGlzLmJhc2VsaW5lTWV0cmljcy5zZXQoXCJhdmVyYWdlTGF0ZW5jeVwiLCBwZXJmb3JtYW5jZS5vdmVyYWxsTGF0ZW5jeSk7XG4gICAgdGhpcy5iYXNlbGluZU1ldHJpY3Muc2V0KFwic3VjY2Vzc1JhdGVcIiwgcGVyZm9ybWFuY2Uub3ZlcmFsbFN1Y2Nlc3NSYXRlKTtcbiAgICB0aGlzLmJhc2VsaW5lTWV0cmljcy5zZXQoXCJ0b3RhbENvc3RcIiwgcGVyZm9ybWFuY2Uub3ZlcmFsbENvc3QpO1xuICAgIHRoaXMuYmFzZWxpbmVNZXRyaWNzLnNldChcbiAgICAgIFwicm91dGluZ0VmZmljaWVuY3lcIixcbiAgICAgIHBlcmZvcm1hbmNlLnJvdXRpbmdFZmZpY2llbmN5XG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgZXN0aW1hdGVDb3N0UGVyUmVxdWVzdChcbiAgICByb3V0ZTogUm91dGVUeXBlLFxuICAgIG1ldHJpY3M6IFJvdXRpbmdQYXRoTWV0cmljc1xuICApOiBudW1iZXIge1xuICAgIC8vIFNpbXBsaWZpZWQgY29zdCBlc3RpbWF0aW9uXG4gICAgY29uc3QgYmFzZUNvc3QgPSByb3V0ZSA9PT0gXCJkaXJlY3RcIiA/IDAuMDAxIDogMC4wMDAzOyAvLyBEaXJlY3QgQmVkcm9jayBjb3N0cyBtb3JlXG4gICAgcmV0dXJuIGJhc2VDb3N0ICogKG1ldHJpY3MuYXZlcmFnZUxhdGVuY3lNcyAvIDEwMDApOyAvLyBDb3N0IHNjYWxlcyB3aXRoIGxhdGVuY3lcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlUmVsaWFiaWxpdHkobWV0cmljczogUm91dGluZ1BhdGhNZXRyaWNzKTogbnVtYmVyIHtcbiAgICByZXR1cm4gbWV0cmljcy5zdWNjZXNzUmF0ZSAvIDEwMDtcbiAgfVxuXG4gIHByaXZhdGUgZXN0aW1hdGVDYXBhY2l0eShcbiAgICByb3V0ZTogUm91dGVUeXBlLFxuICAgIG1ldHJpY3M6IFJvdXRpbmdQYXRoTWV0cmljc1xuICApOiBudW1iZXIge1xuICAgIC8vIFNpbXBsaWZpZWQgY2FwYWNpdHkgZXN0aW1hdGlvbiBiYXNlZCBvbiBsYXRlbmN5XG4gICAgY29uc3QgbWF4TGF0ZW5jeSA9IDMwMDAwOyAvLyAzMCBzZWNvbmRzIG1heFxuICAgIHJldHVybiBNYXRoLm1heCgwLjEsIDEgLSBtZXRyaWNzLnA5NUxhdGVuY3lNcyAvIG1heExhdGVuY3kpO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVPdmVyYWxsSW1wcm92ZW1lbnQoKTogbnVtYmVyIHtcbiAgICBpZiAodGhpcy5vcHRpbWl6YXRpb25IaXN0b3J5Lmxlbmd0aCA9PT0gMCkgcmV0dXJuIDA7XG5cbiAgICBjb25zdCB2YWxpZFJlc3VsdHMgPSB0aGlzLm9wdGltaXphdGlvbkhpc3RvcnkuZmlsdGVyKFxuICAgICAgKHIpID0+IHIucGVyZm9ybWFuY2VJbXByb3ZlbWVudCAhPT0gMFxuICAgICk7XG4gICAgaWYgKHZhbGlkUmVzdWx0cy5sZW5ndGggPT09IDApIHJldHVybiAwO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIHZhbGlkUmVzdWx0cy5yZWR1Y2UoKHN1bSwgcikgPT4gc3VtICsgci5wZXJmb3JtYW5jZUltcHJvdmVtZW50LCAwKSAvXG4gICAgICB2YWxpZFJlc3VsdHMubGVuZ3RoXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVPcHRpbWl6YXRpb25JZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiBgb3B0LSR7RGF0ZS5ub3coKX0tJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YDtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbklkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGByZWMtJHtEYXRlLm5vdygpfS0ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFudXAgcmVzb3VyY2VzXG4gICAqL1xuICBjbGVhbnVwKCk6IHZvaWQge1xuICAgIHRoaXMuc3RvcE9wdGltaXphdGlvbigpO1xuICAgIHRoaXMucm91dGVQcm9maWxlcy5jbGVhcigpO1xuICAgIHRoaXMub3B0aW1pemF0aW9uSGlzdG9yeSA9IFtdO1xuICAgIHRoaXMuYWN0aXZlUmVjb21tZW5kYXRpb25zID0gW107XG4gICAgdGhpcy5iYXNlbGluZU1ldHJpY3MuY2xlYXIoKTtcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSByb3V0aW5nIGVmZmljaWVuY3kgb3B0aW1pemVyXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVSb3V0aW5nRWZmaWNpZW5jeU9wdGltaXplcihcbiAgcm91dGVyOiBJbnRlbGxpZ2VudFJvdXRlcixcbiAgcGVyZm9ybWFuY2VNb25pdG9yOiBIeWJyaWRSb3V0aW5nUGVyZm9ybWFuY2VNb25pdG9yLFxuICBmZWF0dXJlRmxhZ3M6IEFpRmVhdHVyZUZsYWdzLFxuICBhdWRpdFRyYWlsOiBBdWRpdFRyYWlsU3lzdGVtLFxuICBjb25maWc/OiBQYXJ0aWFsPE9wdGltaXplckNvbmZpZz5cbik6IFJvdXRpbmdFZmZpY2llbmN5T3B0aW1pemVyIHtcbiAgcmV0dXJuIG5ldyBSb3V0aW5nRWZmaWNpZW5jeU9wdGltaXplcihcbiAgICByb3V0ZXIsXG4gICAgcGVyZm9ybWFuY2VNb25pdG9yLFxuICAgIGZlYXR1cmVGbGFncyxcbiAgICBhdWRpdFRyYWlsLFxuICAgIGNvbmZpZ1xuICApO1xufVxuIl0sInZlcnNpb24iOjN9