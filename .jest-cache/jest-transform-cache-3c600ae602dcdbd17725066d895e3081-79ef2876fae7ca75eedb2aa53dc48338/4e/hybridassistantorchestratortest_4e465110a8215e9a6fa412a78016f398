3cfa94425513fd8ac7dc7cf1784dffdb
"use strict";
/**
 * Tests for Hybrid Assistant Orchestrator
 */
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
// Mock the AiFeatureFlags to avoid dependency issues
jest.mock("../ai-feature-flags", () => ({
    AiFeatureFlags: jest.fn().mockImplementation(() => ({
        isHybridAssistantModeEnabled: () => true,
        isBedrockAdvisoryModeEnabled: () => true,
        isKiroPrimaryControlEnabled: () => true,
    })),
}));
// Use require for Jest compatibility with CommonJS
const { HybridAssistantOrchestrator, } = require("../hybrid-assistant-orchestrator");
describe("HybridAssistantOrchestrator", () => {
    let orchestrator;
    beforeEach(() => {
        orchestrator = new HybridAssistantOrchestrator();
    });
    describe("Hybrid Assistant Mode Status", () => {
        it("should report hybrid mode as active", () => {
            const status = orchestrator.getHybridAssistantStatus();
            expect(status.hybridModeActive).toBe(true);
            expect(status.bedrockAdvisoryActive).toBe(true);
            expect(status.kiroPrimaryControl).toBe(true);
            expect(status.capabilities).toContain("üéØ User beh√§lt volle Kontrolle");
        });
    });
    describe("Task Processing Workflow", () => {
        it("should process a simple task request", () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const request = {
                id: "test-task-1",
                description: "Implement TypeScript exactOptionalPropertyTypes compliance",
                priority: "medium",
                requester: "user",
            };
            const result = yield orchestrator.processTaskRequest(request);
            expect(result.taskId).toBe("test-task-1");
            expect(result.status).toBe("completed");
            expect(result.bedrockAdvice).toBeDefined();
            expect(result.kiroImplementation).toBeDefined();
            expect(result.finalResult).toBeDefined();
            expect(result.qualityScore).toBeGreaterThan(0);
        }));
        it("should require user approval for critical tasks", () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const criticalRequest = {
                id: "critical-task-1",
                description: "Delete production database",
                priority: "critical",
                requester: "user",
            };
            const result = yield orchestrator.processTaskRequest(criticalRequest);
            expect(result.status).toBe("reviewing");
            expect(result.userApprovalRequired).toBe(true);
        }));
        it("should require user approval for dangerous operations", () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const dangerousRequest = {
                id: "dangerous-task-1",
                description: "Remove all user data",
                priority: "medium",
                requester: "user",
            };
            const result = yield orchestrator.processTaskRequest(dangerousRequest);
            expect(result.status).toBe("reviewing");
            expect(result.userApprovalRequired).toBe(true);
        }));
    });
    describe("User Approval Process", () => {
        it("should handle user approval correctly", () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const request = {
                id: "approval-test",
                description: "Delete old files",
                priority: "high",
                requester: "user",
            };
            // Erstelle Workflow der Approval ben√∂tigt
            const initialResult = yield orchestrator.processTaskRequest(request);
            expect(initialResult.userApprovalRequired).toBe(true);
            // Simuliere User Approval
            const workflowId = `workflow-${request.id}-${Date.now()}`;
            // Note: In real implementation, we'd get the actual workflow ID
            // F√ºr den Test nehmen wir an, dass der Workflow existiert
            // In der echten Implementierung w√ºrde der Workflow ID zur√ºckgegeben
        }));
        it("should handle user rejection correctly", () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            // Test f√ºr User Rejection w√ºrde hier implementiert
            // F√ºr jetzt als Platzhalter
            expect(true).toBe(true);
        }));
    });
    describe("Bedrock Advisory Integration", () => {
        it("should provide bedrock advice for tasks", () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const request = {
                id: "advice-test",
                description: "Optimize database queries",
                priority: "medium",
                requester: "user",
            };
            const result = yield orchestrator.processTaskRequest(request);
            expect(result.bedrockAdvice).toBeDefined();
            expect(result.bedrockAdvice.analysis).toContain("Machbar mit moderatem Aufwand");
            expect(result.bedrockAdvice.recommendations).toHaveLength(3);
            expect(result.bedrockAdvice.risks).toHaveLength(2);
            expect(result.bedrockAdvice.qualityChecks).toHaveLength(4);
        }));
    });
    describe("Kiro Implementation Planning", () => {
        it("should create implementation plan", () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const request = {
                id: "implementation-test",
                description: "Add new feature",
                priority: "low",
                requester: "user",
            };
            const result = yield orchestrator.processTaskRequest(request);
            expect(result.kiroImplementation).toBeDefined();
            expect(result.kiroImplementation.steps.length).toBeGreaterThan(5);
            expect(result.kiroImplementation.testingStrategy).toContain("Unit Tests");
            expect(result.kiroImplementation.rollbackPlan).toContain("Git revert");
        }));
    });
    describe("Quality Assurance", () => {
        it("should perform quality checks", () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const request = {
                id: "quality-test",
                description: "Refactor legacy code",
                priority: "medium",
                requester: "user",
            };
            const result = yield orchestrator.processTaskRequest(request);
            expect(result.qualityScore).toBeDefined();
            expect(result.qualityScore).toBeGreaterThanOrEqual(0);
            expect(result.qualityScore).toBeLessThanOrEqual(100);
        }));
    });
    describe("Workflow Management", () => {
        it("should track active workflows", () => {
            const initialStatus = orchestrator.getHybridAssistantStatus();
            expect(initialStatus.activeWorkflows).toBe(0);
            // Nach dem Ausf√ºhren von Tasks w√ºrde sich die Anzahl √§ndern
            // F√ºr jetzt als Platzhalter
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hdGJha2gtdmlzaWJpbGl0eS1ib29zdC4yMDI1MDkyMC9zcmMvbGliL2FpLW9yY2hlc3RyYXRvci9fX3Rlc3RzX18vaHlicmlkLWFzc2lzdGFudC1vcmNoZXN0cmF0b3IudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7OztBQUVILHFEQUFxRDtBQUNyRCxJQUFJLENBQUMsSUFBSSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDdEMsY0FBYyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ2xELDRCQUE0QixFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUk7UUFDeEMsNEJBQTRCLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBSTtRQUN4QywyQkFBMkIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJO0tBQ3hDLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyxDQUFDO0FBRUosbURBQW1EO0FBQ25ELE1BQU0sRUFDSiwyQkFBMkIsR0FDNUIsR0FBRyxPQUFPLENBQUMsa0NBQWtDLENBQUMsQ0FBQztBQUdoRCxRQUFRLENBQUMsNkJBQTZCLEVBQUUsR0FBRyxFQUFFO0lBQzNDLElBQUksWUFBeUMsQ0FBQztJQUU5QyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsWUFBWSxHQUFHLElBQUksMkJBQTJCLEVBQUUsQ0FBQztJQUNuRCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyw4QkFBOEIsRUFBRSxHQUFHLEVBQUU7UUFDNUMsRUFBRSxDQUFDLHFDQUFxQyxFQUFFLEdBQUcsRUFBRTtZQUM3QyxNQUFNLE1BQU0sR0FBRyxZQUFZLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztZQUV2RCxNQUFNLENBQUMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzNDLE1BQU0sQ0FBQyxNQUFNLENBQUMscUJBQXFCLENBQUMsQ0FBQyxJQUFJLENB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LEVBQUUsR0FBRyxFQUFFO1FBQ2pDLEVBQUUsQ0FBQywrQkFBK0IsRUFBRSxHQUFTLEVBQUU7WUFDN0MsTUFBTSxPQUFPLEdBQWdCO2dCQUMzQixFQUFFLEVBQUUsY0FBYztnQkFDbEIsV0FBVyxFQUFFLHNCQUFzQjtnQkFDbkMsUUFBUSxFQUFFLFFBQVE7Z0JBQ2xCLFNBQVMsRUFBRSxNQUFNO2FBQ2xCLENBQUM7WUFFRixNQUFNLE1BQU0sR0FBRyxNQUFNLFlBQVksQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUU5RCxNQUFNLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN2RCxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO1FBQ25DLEVBQUUsQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUU7WUFDdkMsTUFBTSxhQUFhLEdBQUcsWUFBWSxDQUFDLHdCQUF3QixFQUFFLENBQUM7WUFDOUQsTUFBTSxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFOUMsNERBQTREO1lBQzVELDRCQUE0QjtRQUM5QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL21hdGJha2gtdmlzaWJpbGl0eS1ib29zdC4yMDI1MDkyMC9zcmMvbGliL2FpLW9yY2hlc3RyYXRvci9fX3Rlc3RzX18vaHlicmlkLWFzc2lzdGFudC1vcmNoZXN0cmF0b3IudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRlc3RzIGZvciBIeWJyaWQgQXNzaXN0YW50IE9yY2hlc3RyYXRvclxuICovXG5cbi8vIE1vY2sgdGhlIEFpRmVhdHVyZUZsYWdzIHRvIGF2b2lkIGRlcGVuZGVuY3kgaXNzdWVzXG5qZXN0Lm1vY2soXCIuLi9haS1mZWF0dXJlLWZsYWdzXCIsICgpID0+ICh7XG4gIEFpRmVhdHVyZUZsYWdzOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgaXNIeWJyaWRBc3Npc3RhbnRNb2RlRW5hYmxlZDogKCkgPT4gdHJ1ZSxcbiAgICBpc0JlZHJvY2tBZHZpc29yeU1vZGVFbmFibGVkOiAoKSA9PiB0cnVlLFxuICAgIGlzS2lyb1ByaW1hcnlDb250cm9sRW5hYmxlZDogKCkgPT4gdHJ1ZSxcbiAgfSkpLFxufSkpO1xuXG4vLyBVc2UgcmVxdWlyZSBmb3IgSmVzdCBjb21wYXRpYmlsaXR5IHdpdGggQ29tbW9uSlNcbmNvbnN0IHtcbiAgSHlicmlkQXNzaXN0YW50T3JjaGVzdHJhdG9yLFxufSA9IHJlcXVpcmUoXCIuLi9oeWJyaWQtYXNzaXN0YW50LW9yY2hlc3RyYXRvclwiKTtcbmltcG9ydCB0eXBlIHsgVGFza1JlcXVlc3QgfSBmcm9tIFwiLi4vaHlicmlkLWFzc2lzdGFudC1vcmNoZXN0cmF0b3JcIjtcblxuZGVzY3JpYmUoXCJIeWJyaWRBc3Npc3RhbnRPcmNoZXN0cmF0b3JcIiwgKCkgPT4ge1xuICBsZXQgb3JjaGVzdHJhdG9yOiBIeWJyaWRBc3Npc3RhbnRPcmNoZXN0cmF0b3I7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgb3JjaGVzdHJhdG9yID0gbmV3IEh5YnJpZEFzc2lzdGFudE9yY2hlc3RyYXRvcigpO1xuICB9KTtcblxuICBkZXNjcmliZShcIkh5YnJpZCBBc3Npc3RhbnQgTW9kZSBTdGF0dXNcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHJlcG9ydCBoeWJyaWQgbW9kZSBhcyBhY3RpdmVcIiwgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhdHVzID0gb3JjaGVzdHJhdG9yLmdldEh5YnJpZEFzc2lzdGFudFN0YXR1cygpO1xuXG4gICAgICBleHBlY3Qoc3RhdHVzLmh5YnJpZE1vZGVBY3RpdmUpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3Qoc3RhdHVzLmJlZHJvY2tBZHZpc29yeUFjdGl2ZSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChzdGF0dXMua2lyb1ByaW1hcnlDb250cm9sKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHN0YXR1cy5jYXBhYmlsaXRpZXMpLnRvQ29udGFpbihcIvCfjq8gVXNlciBiZWjDpGx0IHZvbGxlIEtvbnRyb2xsZVwiKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJUYXNrIFByb2Nlc3NpbmcgV29ya2Zsb3dcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHByb2Nlc3MgYSBzaW1wbGUgdGFzayByZXF1ZXN0XCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlcXVlc3Q6IFRhc2tSZXF1ZXN0ID0ge1xuICAgICAgICBpZDogXCJ0ZXN0LXRhc2stMVwiLFxuICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICBcIkltcGxlbWVudCBUeXBlU2NyaXB0IGV4YWN0T3B0aW9uYWxQcm9wZXJ0eVR5cGVzIGNvbXBsaWFuY2VcIixcbiAgICAgICAgcHJpb3JpdHk6IFwibWVkaXVtXCIsXG4gICAgICAgIHJlcXVlc3RlcjogXCJ1c2VyXCIsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBvcmNoZXN0cmF0b3IucHJvY2Vzc1Rhc2tSZXF1ZXN0KHJlcXVlc3QpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnRhc2tJZCkudG9CZShcInRlc3QtdGFzay0xXCIpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoXCJjb21wbGV0ZWRcIik7XG4gICAgICBleHBlY3QocmVzdWx0LmJlZHJvY2tBZHZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0Lmtpcm9JbXBsZW1lbnRhdGlvbikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZmluYWxSZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LnF1YWxpdHlTY29yZSkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgcmVxdWlyZSB1c2VyIGFwcHJvdmFsIGZvciBjcml0aWNhbCB0YXNrc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjcml0aWNhbFJlcXVlc3Q6IFRhc2tSZXF1ZXN0ID0ge1xuICAgICAgICBpZDogXCJjcml0aWNhbC10YXNrLTFcIixcbiAgICAgICAgZGVzY3JpcHRpb246IFwiRGVsZXRlIHByb2R1Y3Rpb24gZGF0YWJhc2VcIixcbiAgICAgICAgcHJpb3JpdHk6IFwiY3JpdGljYWxcIixcbiAgICAgICAgcmVxdWVzdGVyOiBcInVzZXJcIixcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9yY2hlc3RyYXRvci5wcm9jZXNzVGFza1JlcXVlc3QoY3JpdGljYWxSZXF1ZXN0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoXCJyZXZpZXdpbmdcIik7XG4gICAgICBleHBlY3QocmVzdWx0LnVzZXJBcHByb3ZhbFJlcXVpcmVkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgcmVxdWlyZSB1c2VyIGFwcHJvdmFsIGZvciBkYW5nZXJvdXMgb3BlcmF0aW9uc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYW5nZXJvdXNSZXF1ZXN0OiBUYXNrUmVxdWVzdCA9IHtcbiAgICAgICAgaWQ6IFwiZGFuZ2Vyb3VzLXRhc2stMVwiLFxuICAgICAgICBkZXNjcmlwdGlvbjogXCJSZW1vdmUgYWxsIHVzZXIgZGF0YVwiLFxuICAgICAgICBwcmlvcml0eTogXCJtZWRpdW1cIixcbiAgICAgICAgcmVxdWVzdGVyOiBcInVzZXJcIixcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9yY2hlc3RyYXRvci5wcm9jZXNzVGFza1JlcXVlc3QoZGFuZ2Vyb3VzUmVxdWVzdCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKFwicmV2aWV3aW5nXCIpO1xuICAgICAgZXhwZWN0KHJlc3VsdC51c2VyQXBwcm92YWxSZXF1aXJlZCkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJVc2VyIEFwcHJvdmFsIFByb2Nlc3NcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIGhhbmRsZSB1c2VyIGFwcHJvdmFsIGNvcnJlY3RseVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXF1ZXN0OiBUYXNrUmVxdWVzdCA9IHtcbiAgICAgICAgaWQ6IFwiYXBwcm92YWwtdGVzdFwiLFxuICAgICAgICBkZXNjcmlwdGlvbjogXCJEZWxldGUgb2xkIGZpbGVzXCIsXG4gICAgICAgIHByaW9yaXR5OiBcImhpZ2hcIixcbiAgICAgICAgcmVxdWVzdGVyOiBcInVzZXJcIixcbiAgICAgIH07XG5cbiAgICAgIC8vIEVyc3RlbGxlIFdvcmtmbG93IGRlciBBcHByb3ZhbCBiZW7DtnRpZ3RcbiAgICAgIGNvbnN0IGluaXRpYWxSZXN1bHQgPSBhd2FpdCBvcmNoZXN0cmF0b3IucHJvY2Vzc1Rhc2tSZXF1ZXN0KHJlcXVlc3QpO1xuICAgICAgZXhwZWN0KGluaXRpYWxSZXN1bHQudXNlckFwcHJvdmFsUmVxdWlyZWQpLnRvQmUodHJ1ZSk7XG5cbiAgICAgIC8vIFNpbXVsaWVyZSBVc2VyIEFwcHJvdmFsXG4gICAgICBjb25zdCB3b3JrZmxvd0lkID0gYHdvcmtmbG93LSR7cmVxdWVzdC5pZH0tJHtEYXRlLm5vdygpfWA7XG4gICAgICAvLyBOb3RlOiBJbiByZWFsIGltcGxlbWVudGF0aW9uLCB3ZSdkIGdldCB0aGUgYWN0dWFsIHdvcmtmbG93IElEXG5cbiAgICAgIC8vIEbDvHIgZGVuIFRlc3QgbmVobWVuIHdpciBhbiwgZGFzcyBkZXIgV29ya2Zsb3cgZXhpc3RpZXJ0XG4gICAgICAvLyBJbiBkZXIgZWNodGVuIEltcGxlbWVudGllcnVuZyB3w7xyZGUgZGVyIFdvcmtmbG93IElEIHp1csO8Y2tnZWdlYmVuXG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBoYW5kbGUgdXNlciByZWplY3Rpb24gY29ycmVjdGx5XCIsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRlc3QgZsO8ciBVc2VyIFJlamVjdGlvbiB3w7xyZGUgaGllciBpbXBsZW1lbnRpZXJ0XG4gICAgICAvLyBGw7xyIGpldHp0IGFscyBQbGF0emhhbHRlclxuICAgICAgZXhwZWN0KHRydWUpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiQmVkcm9jayBBZHZpc29yeSBJbnRlZ3JhdGlvblwiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgcHJvdmlkZSBiZWRyb2NrIGFkdmljZSBmb3IgdGFza3NcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVxdWVzdDogVGFza1JlcXVlc3QgPSB7XG4gICAgICAgIGlkOiBcImFkdmljZS10ZXN0XCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIk9wdGltaXplIGRhdGFiYXNlIHF1ZXJpZXNcIixcbiAgICAgICAgcHJpb3JpdHk6IFwibWVkaXVtXCIsXG4gICAgICAgIHJlcXVlc3RlcjogXCJ1c2VyXCIsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBvcmNoZXN0cmF0b3IucHJvY2Vzc1Rhc2tSZXF1ZXN0KHJlcXVlc3QpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmJlZHJvY2tBZHZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LmJlZHJvY2tBZHZpY2UhLmFuYWx5c2lzKS50b0NvbnRhaW4oXG4gICAgICAgIFwiTWFjaGJhciBtaXQgbW9kZXJhdGVtIEF1ZndhbmRcIlxuICAgICAgKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYmVkcm9ja0FkdmljZSEucmVjb21tZW5kYXRpb25zKS50b0hhdmVMZW5ndGgoMyk7XG4gICAgICBleHBlY3QocmVzdWx0LmJlZHJvY2tBZHZpY2UhLnJpc2tzKS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QocmVzdWx0LmJlZHJvY2tBZHZpY2UhLnF1YWxpdHlDaGVja3MpLnRvSGF2ZUxlbmd0aCg0KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJLaXJvIEltcGxlbWVudGF0aW9uIFBsYW5uaW5nXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCBjcmVhdGUgaW1wbGVtZW50YXRpb24gcGxhblwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXF1ZXN0OiBUYXNrUmVxdWVzdCA9IHtcbiAgICAgICAgaWQ6IFwiaW1wbGVtZW50YXRpb24tdGVzdFwiLFxuICAgICAgICBkZXNjcmlwdGlvbjogXCJBZGQgbmV3IGZlYXR1cmVcIixcbiAgICAgICAgcHJpb3JpdHk6IFwibG93XCIsXG4gICAgICAgIHJlcXVlc3RlcjogXCJ1c2VyXCIsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBvcmNoZXN0cmF0b3IucHJvY2Vzc1Rhc2tSZXF1ZXN0KHJlcXVlc3QpO1xuXG4gICAgICBleHBlY3QocmVzdWx0Lmtpcm9JbXBsZW1lbnRhdGlvbikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQua2lyb0ltcGxlbWVudGF0aW9uIS5zdGVwcy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbig1KTtcbiAgICAgIGV4cGVjdChyZXN1bHQua2lyb0ltcGxlbWVudGF0aW9uIS50ZXN0aW5nU3RyYXRlZ3kpLnRvQ29udGFpbihcbiAgICAgICAgXCJVbml0IFRlc3RzXCJcbiAgICAgICk7XG4gICAgICBleHBlY3QocmVzdWx0Lmtpcm9JbXBsZW1lbnRhdGlvbiEucm9sbGJhY2tQbGFuKS50b0NvbnRhaW4oXCJHaXQgcmV2ZXJ0XCIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIlF1YWxpdHkgQXNzdXJhbmNlXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCBwZXJmb3JtIHF1YWxpdHkgY2hlY2tzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlcXVlc3Q6IFRhc2tSZXF1ZXN0ID0ge1xuICAgICAgICBpZDogXCJxdWFsaXR5LXRlc3RcIixcbiAgICAgICAgZGVzY3JpcHRpb246IFwiUmVmYWN0b3IgbGVnYWN5IGNvZGVcIixcbiAgICAgICAgcHJpb3JpdHk6IFwibWVkaXVtXCIsXG4gICAgICAgIHJlcXVlc3RlcjogXCJ1c2VyXCIsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBvcmNoZXN0cmF0b3IucHJvY2Vzc1Rhc2tSZXF1ZXN0KHJlcXVlc3QpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnF1YWxpdHlTY29yZSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucXVhbGl0eVNjb3JlKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5xdWFsaXR5U2NvcmUpLnRvQmVMZXNzVGhhbk9yRXF1YWwoMTAwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJXb3JrZmxvdyBNYW5hZ2VtZW50XCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCB0cmFjayBhY3RpdmUgd29ya2Zsb3dzXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IGluaXRpYWxTdGF0dXMgPSBvcmNoZXN0cmF0b3IuZ2V0SHlicmlkQXNzaXN0YW50U3RhdHVzKCk7XG4gICAgICBleHBlY3QoaW5pdGlhbFN0YXR1cy5hY3RpdmVXb3JrZmxvd3MpLnRvQmUoMCk7XG5cbiAgICAgIC8vIE5hY2ggZGVtIEF1c2bDvGhyZW4gdm9uIFRhc2tzIHfDvHJkZSBzaWNoIGRpZSBBbnphaGwgw6RuZGVyblxuICAgICAgLy8gRsO8ciBqZXR6dCBhbHMgUGxhdHpoYWx0ZXJcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==