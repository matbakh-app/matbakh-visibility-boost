c8cf3ddf4d0711df9ae0b1c0fd81c593
"use strict";
/**
 * Bandit Optimizer for AI Model Selection
 *
 * Implements:
 * - UCB (Upper Confidence Bound) algorithm
 * - Thompson Sampling with Beta distribution
 * - Contextual bandits for persona-based routing
 * - Integration with Evidently experiments
 * - Automated optimization and learning
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.BanditUtils = exports.BanditOptimizer = void 0;
const bandit_controller_1 = require("./bandit-controller");
class BanditOptimizer {
    bandit;
    experimentManager;
    config;
    optimizationHistory = [];
    constructor(bandit, experimentManager, config) {
        this.bandit = bandit || new bandit_controller_1.ThompsonBandit();
        this.experimentManager = experimentManager;
        this.config = {
            explorationRate: 0.1,
            confidenceLevel: 0.95,
            minTrialsForConfidence: 20,
            autoOptimizationEnabled: true,
            optimizationInterval: 60, // 1 hour
            ...config,
        };
        if (this.config.autoOptimizationEnabled) {
            this.startAutoOptimization();
        }
    }
    /**
     * UCB (Upper Confidence Bound) algorithm for arm selection
     */
    selectArmUCB(context) {
        const stats = this.bandit.getStats(context);
        const totalTrials = Object.values(stats).reduce((sum, stat) => sum + stat.trials, 0);
        if (totalTrials === 0) {
            // No data yet, return random arm
            const arms = ["bedrock", "google", "meta"];
            const randomArm = arms[Math.floor(Math.random() * arms.length)];
            return {
                recommendedArm: randomArm,
                confidence: 0.33,
                expectedReward: 0.5,
                explorationNeeded: true,
                reasoning: "No historical data available, exploring randomly",
            };
        }
        let bestArm = "bedrock";
        let bestUCB = -1;
        const ucbStats = {};
        // Calculate UCB for each arm
        Object.keys(stats).forEach((arm) => {
            const armStats = stats[arm];
            if (armStats.trials === 0) {
                // Unplayed arm gets infinite UCB
                ucbStats[arm] = {
                    ...armStats,
                    ucbScore: Infinity,
                    confidenceRadius: Infinity,
                };
                bestArm = arm;
                bestUCB = Infinity;
                return;
            }
            // UCB formula: mean + confidence_radius
            const mean = armStats.winRate;
            const confidenceRadius = Math.sqrt((2 * Math.log(totalTrials)) / armStats.trials) *
                this.config.explorationRate;
            const ucbScore = mean + confidenceRadius;
            ucbStats[arm] = {
                ...armStats,
                ucbScore,
                confidenceRadius,
            };
            if (ucbScore > bestUCB) {
                bestUCB = ucbScore;
                bestArm = arm;
            }
        });
        const bestStats = ucbStats[bestArm];
        const confidence = bestStats.trials >= this.config.minTrialsForConfidence
            ? Math.min(0.95, bestStats.winRate + 0.1)
            : Math.max(0.3, bestStats.winRate);
        const explorationNeeded = bestStats.confidenceRadius > 0.1 ||
            bestStats.trials < this.config.minTrialsForConfidence;
        return {
            recommendedArm: bestArm,
            confidence,
            expectedReward: bestStats.winRate,
            explorationNeeded,
            reasoning: explorationNeeded
                ? `Exploration needed: ${bestStats.trials} trials, confidence radius ${bestStats.confidenceRadius.toFixed(3)}`
                : `Exploitation: High confidence in ${bestArm} (${bestStats.trials} trials, ${(bestStats.winRate * 100).toFixed(1)}% win rate)`,
        };
    }
    /**
     * Thompson Sampling with contextual information
     */
    selectArmThompson(context) {
        const chosenArm = this.bandit.choose(context);
        const stats = this.bandit.getStats(context);
        const armStats = stats[chosenArm];
        const confidence = armStats.trials >= this.config.minTrialsForConfidence
            ? Math.min(0.95, armStats.winRate + 0.1)
            : Math.max(0.3, armStats.winRate);
        const explorationNeeded = armStats.trials < this.config.minTrialsForConfidence;
        return {
            recommendedArm: chosenArm,
            confidence,
            expectedReward: armStats.winRate,
            explorationNeeded,
            reasoning: `Thompson Sampling selected ${chosenArm} based on Beta(${1 + armStats.wins}, ${1 + armStats.trials - armStats.wins}) distribution`,
        };
    }
    /**
     * Hybrid approach: UCB for exploration, Thompson for exploitation
     */
    selectArmHybrid(context) {
        const stats = this.bandit.getStats(context);
        const totalTrials = Object.values(stats).reduce((sum, stat) => sum + stat.trials, 0);
        // Use UCB for early exploration
        if (totalTrials < this.config.minTrialsForConfidence * 3) {
            return this.selectArmUCB(context);
        }
        // Use Thompson Sampling for exploitation
        return this.selectArmThompson(context);
    }
    /**
     * Get optimal arm with experiment integration
     */
    async getOptimalArm(context) {
        // Check if experiment manager is available and has active experiments
        if (this.experimentManager) {
            try {
                const experimentResult = await this.experimentManager.getOptimalProvider(context);
                if (experimentResult.source === "experiment") {
                    return {
                        recommendedArm: experimentResult.provider,
                        confidence: experimentResult.confidence,
                        expectedReward: 0.8, // Assume experiments are well-designed
                        explorationNeeded: false,
                        reasoning: `Experiment assignment: ${experimentResult.experimentName}`,
                    };
                }
            }
            catch (error) {
                console.warn("Failed to get experiment assignment, falling back to bandit:", error);
            }
        }
        // Fall back to bandit optimization
        return this.selectArmHybrid(context);
    }
    /**
     * Record outcome and update optimization
     */
    async recordOutcome(context, arm, success, latencyMs, costEuro, qualityScore) {
        // Record in bandit
        this.bandit.record(arm, success, costEuro, latencyMs, context);
        // Record in experiment manager if available
        if (this.experimentManager) {
            try {
                await this.experimentManager.recordExperimentOutcome(context, arm, {
                    success,
                    latencyMs,
                    costEuro,
                    qualityScore,
                });
            }
            catch (error) {
                console.warn("Failed to record experiment outcome:", error);
                // Continue execution - bandit recording is more important
            }
        }
        // Update optimization history
        const lastOptimization = this.optimizationHistory[this.optimizationHistory.length - 1];
        if (lastOptimization && !lastOptimization.actualOutcome) {
            lastOptimization.actualOutcome = success;
        }
    }
    /**
     * Analyze contextual performance across different contexts
     */
    analyzeContextualPerformance() {
        const contexts = this.getUniqueContexts();
        return contexts.map((contextKey) => {
            const context = this.parseContextKey(contextKey);
            const stats = this.bandit.getStats(context);
            const armPerformance = {};
            let bestArm = "bedrock";
            let bestScore = -1;
            Object.keys(stats).forEach((arm) => {
                const armStats = stats[arm];
                const confidence = armStats.trials >= this.config.minTrialsForConfidence
                    ? Math.min(0.95, armStats.winRate + 0.1)
                    : Math.max(0.3, armStats.winRate);
                // Composite score: win rate (50%) + latency (30%) + cost (20%)
                const score = armStats.winRate * 0.5 +
                    (1 / (armStats.avgLatency + 1)) * 0.3 +
                    (1 / (armStats.avgCost + 0.01)) * 0.2;
                armPerformance[arm] = {
                    winRate: armStats.winRate,
                    avgLatency: armStats.avgLatency,
                    avgCost: armStats.avgCost,
                    trials: armStats.trials,
                    confidence,
                };
                if (score > bestScore) {
                    bestScore = score;
                    bestArm = arm;
                }
            });
            // Calculate improvement over random baseline (33% win rate)
            const improvement = (armPerformance[bestArm].winRate - 0.33) / 0.33;
            return {
                context: contextKey,
                armPerformance,
                bestArm,
                improvement,
            };
        });
    }
    /**
     * Get optimization recommendations based on current performance
     */
    getOptimizationRecommendations() {
        const recommendations = [];
        const contextualPerformance = this.analyzeContextualPerformance();
        const globalStats = this.bandit.getStats();
        // Check for under-explored arms
        const underExploredArms = Object.keys(globalStats).filter((arm) => globalStats[arm].trials < this.config.minTrialsForConfidence);
        if (underExploredArms.length > 0) {
            recommendations.push({
                type: "exploration",
                priority: "high",
                description: `Arms ${underExploredArms.join(", ")} need more exploration`,
                action: `Increase exploration rate or force exploration of ${underExploredArms.join(", ")}`,
            });
        }
        // Check for contexts with poor performance
        const poorPerformingContexts = contextualPerformance.filter((ctx) => ctx.improvement < 0.1 // Less than 10% improvement over random
        );
        if (poorPerformingContexts.length > 0) {
            recommendations.push({
                type: "context_specific",
                priority: "medium",
                description: `Poor performance in contexts: ${poorPerformingContexts
                    .map((c) => c.context)
                    .join(", ")}`,
                action: "Consider context-specific optimization or feature engineering",
            });
        }
        // Check for high-confidence winners
        const highConfidenceContexts = contextualPerformance.filter((ctx) => ctx.armPerformance[ctx.bestArm].confidence > 0.9 &&
            ctx.armPerformance[ctx.bestArm].trials > 50);
        if (highConfidenceContexts.length > 0) {
            recommendations.push({
                type: "exploitation",
                priority: "low",
                description: `High confidence winners found in ${highConfidenceContexts.length} contexts`,
                action: "Consider reducing exploration rate for these contexts",
            });
        }
        // Suggest experiments for promising contexts
        const promisingContexts = contextualPerformance.filter((ctx) => ctx.improvement > 0.2 && ctx.armPerformance[ctx.bestArm].trials > 30);
        if (promisingContexts.length > 0 && this.experimentManager) {
            recommendations.push({
                type: "experiment",
                priority: "medium",
                description: `Promising contexts found: ${promisingContexts
                    .map((c) => c.context)
                    .join(", ")}`,
                action: "Consider running formal A/B experiments to validate findings",
            });
        }
        return recommendations;
    }
    /**
     * Start automatic optimization process
     */
    startAutoOptimization() {
        setInterval(() => {
            this.runOptimizationCycle();
        }, this.config.optimizationInterval * 60 * 1000); // Convert minutes to ms
    }
    /**
     * Run a single optimization cycle
     */
    async runOptimizationCycle() {
        try {
            const recommendations = this.getOptimizationRecommendations();
            // Log recommendations
            if (recommendations.length > 0) {
                console.log("Bandit Optimization Recommendations:", recommendations);
            }
            // Auto-apply low-risk optimizations
            const highPriorityRecs = recommendations.filter((r) => r.priority === "high");
            for (const rec of highPriorityRecs) {
                if (rec.type === "exploration") {
                    // Temporarily increase exploration rate
                    this.config.explorationRate = Math.min(0.3, this.config.explorationRate * 1.2);
                    console.log(`Auto-optimization: Increased exploration rate to ${this.config.explorationRate}`);
                }
            }
            // Reset exploration rate after some time
            setTimeout(() => {
                this.config.explorationRate = Math.max(0.05, this.config.explorationRate * 0.9);
            }, 30 * 60 * 1000); // 30 minutes
        }
        catch (error) {
            console.error("Error in optimization cycle:", error);
        }
    }
    /**
     * Get unique contexts from bandit history
     */
    getUniqueContexts() {
        // This would need to be implemented based on how contexts are stored
        // For now, return some common contexts
        return [
            "general|standard|no-tools",
            "legal|premium|tools",
            "culinary|standard|no-tools",
            "medical|premium|tools",
        ];
    }
    /**
     * Parse context key back to BanditContext
     */
    parseContextKey(contextKey) {
        const [domain, budgetTier, tools] = contextKey.split("|");
        return {
            domain: domain === "general" ? undefined : domain,
            budgetTier: budgetTier === "standard" ? undefined : budgetTier,
            requireTools: tools === "tools",
        };
    }
    /**
     * Get current configuration
     */
    getConfig() {
        return { ...this.config };
    }
    /**
     * Update configuration
     */
    updateConfig(updates) {
        this.config = { ...this.config, ...updates };
    }
    /**
     * Get optimization history
     */
    getOptimizationHistory() {
        return [...this.optimizationHistory];
    }
    /**
     * Reset bandit and optimization history
     */
    reset() {
        this.bandit = new bandit_controller_1.ThompsonBandit();
        this.optimizationHistory = [];
    }
    /**
     * Export bandit state for persistence
     */
    exportState() {
        return {
            banditStats: this.bandit.getStats(),
            config: this.config,
            optimizationHistory: this.optimizationHistory,
        };
    }
    /**
     * Get bandit statistics
     */
    getBanditStats() {
        return this.bandit.getStats();
    }
    /**
     * Health check for the optimizer
     */
    healthCheck() {
        const globalStats = this.bandit.getStats();
        const totalTrials = Object.values(globalStats).reduce((sum, stat) => sum + stat.trials, 0);
        const recommendations = this.getOptimizationRecommendations();
        let status = "healthy";
        if (totalTrials < 10) {
            status = "warning"; // Not enough data
        }
        const highPriorityIssues = recommendations.filter((r) => r.priority === "high");
        if (highPriorityIssues.length > 0) {
            status = "warning";
        }
        return {
            status,
            totalTrials,
            activeContexts: this.getUniqueContexts().length,
            autoOptimizationEnabled: this.config.autoOptimizationEnabled,
            lastOptimization: this.optimizationHistory[this.optimizationHistory.length - 1]
                ?.timestamp,
            recommendations: recommendations.length,
        };
    }
}
exports.BanditOptimizer = BanditOptimizer;
// Utility functions for bandit optimization
exports.BanditUtils = {
    /**
     * Calculate statistical significance between two arms
     */
    calculateSignificance(arm1, arm2) {
        if (arm1.trials === 0 || arm2.trials === 0) {
            return { significant: false, pValue: 1, confidenceInterval: [0, 1] };
        }
        const p1 = arm1.wins / arm1.trials;
        const p2 = arm2.wins / arm2.trials;
        const diff = p1 - p2;
        // Simple z-test approximation
        const se = Math.sqrt((p1 * (1 - p1)) / arm1.trials + (p2 * (1 - p2)) / arm2.trials);
        const z = Math.abs(diff) / se;
        const pValue = 2 * (1 - this.normalCDF(z)); // Two-tailed test
        const margin = 1.96 * se; // 95% confidence interval
        const confidenceInterval = [diff - margin, diff + margin];
        return {
            significant: pValue < 0.05,
            pValue,
            confidenceInterval,
        };
    },
    /**
     * Normal CDF approximation
     */
    normalCDF(x) {
        return 0.5 * (1 + this.erf(x / Math.sqrt(2)));
    },
    /**
     * Error function approximation
     */
    erf(x) {
        // Abramowitz and Stegun approximation
        const a1 = 0.254829592;
        const a2 = -0.284496736;
        const a3 = 1.421413741;
        const a4 = -1.453152027;
        const a5 = 1.061405429;
        const p = 0.3275911;
        const sign = x >= 0 ? 1 : -1;
        x = Math.abs(x);
        const t = 1.0 / (1.0 + p * x);
        const y = 1.0 -
            ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
        return sign * y;
    },
    /**
     * Calculate expected regret for an arm selection strategy
     */
    calculateRegret(trueRewards, selections) {
        const optimalReward = Math.max(...Object.values(trueRewards));
        let totalRegret = 0;
        selections.forEach((selection) => {
            const regret = optimalReward - trueRewards[selection.arm];
            totalRegret += regret;
        });
        return totalRegret / selections.length; // Average regret
    },
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hdGJha2gtdmlzaWJpbGl0eS1ib29zdC4yMDI1MDkyMC9zcmMvbGliL2FpLW9yY2hlc3RyYXRvci9iYW5kaXQtb3B0aW1pemVyLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7O0dBU0c7OztBQUVILDJEQUs2QjtBQTJDN0IsTUFBYSxlQUFlO0lBQ2xCLE1BQU0sQ0FBaUI7SUFDdkIsaUJBQWlCLENBQThCO0lBQy9DLE1BQU0sQ0FBcUI7SUFDM0IsbUJBQW1CLEdBS3RCLEVBQUUsQ0FBQztJQUVSLFlBQ0UsTUFBdUIsRUFDdkIsaUJBQThDLEVBQzlDLE1BQW9DO1FBRXBDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxJQUFJLElBQUksa0NBQWMsRUFBRSxDQUFDO1FBQzdDLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxpQkFBaUIsQ0FBQztRQUMzQyxJQUFJLENBQUMsTUFBTSxHQUFHO1lBQ1osZUFBZSxFQUFFLEdBQUc7WUFDcEIsZUFBZSxFQUFFLElBQUk7WUFDckIsc0JBQXNCLEVBQUUsRUFBRTtZQUMxQix1QkFBdUIsRUFBRSxJQUFJO1lBQzdCLG9CQUFvQixFQUFFLEVBQUUsRUFBRSxTQUFTO1lBQ25DLEdBQUcsTUFBTTtTQUNWLENBQUM7UUFFRixJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsdUJBQXVCLEVBQUUsQ0FBQztZQUN4QyxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztRQUMvQixDQUFDO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0gsWUFBWSxDQUFDLE9BQXVCO1FBQ2xDLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzVDLE1BQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxDQUM3QyxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUNoQyxDQUFDLENBQ0YsQ0FBQztRQUVG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RyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUM5QixNQUFNLENBQUMsR0FDTCxHQUFHO1lBQ0gsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBRXhFLE9BQU8sSUFBSSxHQUFHLENBQUMsQ0FBQztJQUNsQixDQUFDO0lBRUQ7O09BRUc7SUFDSCxlQUFlLENBQ2IsV0FBZ0MsRUFDaEMsVUFBK0M7UUFFL0MsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztRQUM5RCxJQUFJLFdBQVcsR0FBRyxDQUFDLENBQUM7UUFFcEIsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsRUFBRSxFQUFFO1lBQy9CLE1BQU0sTUFBTSxHQUFHLGFBQWEsR0FBRyxXQUFXLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzFELFdBQVcsSUFBSSxNQUFNLENBQUM7UUFDeEIsQ0FBQyxDQUFDLENBQUM7UUFFSCxPQUFPLFdBQVcsR0FBRyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsaUJBQWlCO0lBQzNELENBQUM7Q0FDRixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYXRiYWtoLXZpc2liaWxpdHktYm9vc3QuMjAyNTA5MjAvc3JjL2xpYi9haS1vcmNoZXN0cmF0b3IvYmFuZGl0LW9wdGltaXplci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEJhbmRpdCBPcHRpbWl6ZXIgZm9yIEFJIE1vZGVsIFNlbGVjdGlvblxuICpcbiAqIEltcGxlbWVudHM6XG4gKiAtIFVDQiAoVXBwZXIgQ29uZmlkZW5jZSBCb3VuZCkgYWxnb3JpdGhtXG4gKiAtIFRob21wc29uIFNhbXBsaW5nIHdpdGggQmV0YSBkaXN0cmlidXRpb25cbiAqIC0gQ29udGV4dHVhbCBiYW5kaXRzIGZvciBwZXJzb25hLWJhc2VkIHJvdXRpbmdcbiAqIC0gSW50ZWdyYXRpb24gd2l0aCBFdmlkZW50bHkgZXhwZXJpbWVudHNcbiAqIC0gQXV0b21hdGVkIG9wdGltaXphdGlvbiBhbmQgbGVhcm5pbmdcbiAqL1xuXG5pbXBvcnQge1xuICBBcm0sXG4gIEFybVN0YXRzLFxuICBCYW5kaXRDb250ZXh0LFxuICBUaG9tcHNvbkJhbmRpdCxcbn0gZnJvbSBcIi4vYmFuZGl0LWNvbnRyb2xsZXJcIjtcbmltcG9ydCB7XG4gIEV2aWRlbnRseUV4cGVyaW1lbnRNYW5hZ2VyLFxuICBFeHBlcmltZW50Q29udGV4dCxcbn0gZnJvbSBcIi4vZXZpZGVudGx5LWV4cGVyaW1lbnRzXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVUNCU3RhdHMgZXh0ZW5kcyBBcm1TdGF0cyB7XG4gIHVjYlNjb3JlOiBudW1iZXI7XG4gIGNvbmZpZGVuY2VSYWRpdXM6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBPcHRpbWl6YXRpb25Db25maWcge1xuICBleHBsb3JhdGlvblJhdGU6IG51bWJlcjsgLy8gMC0xLCBoaWdoZXIgPSBtb3JlIGV4cGxvcmF0aW9uXG4gIGNvbmZpZGVuY2VMZXZlbDogbnVtYmVyOyAvLyAwLTEsIGZvciBVQ0IgY29uZmlkZW5jZSBpbnRlcnZhbHNcbiAgbWluVHJpYWxzRm9yQ29uZmlkZW5jZTogbnVtYmVyOyAvLyBNaW5pbXVtIHRyaWFscyBiZWZvcmUgdHJ1c3RpbmcgcmVzdWx0c1xuICBhdXRvT3B0aW1pemF0aW9uRW5hYmxlZDogYm9vbGVhbjtcbiAgb3B0aW1pemF0aW9uSW50ZXJ2YWw6IG51bWJlcjsgLy8gTWludXRlcyBiZXR3ZWVuIG9wdGltaXphdGlvbiBydW5zXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgT3B0aW1pemF0aW9uUmVzdWx0IHtcbiAgcmVjb21tZW5kZWRBcm06IEFybTtcbiAgY29uZmlkZW5jZTogbnVtYmVyO1xuICBleHBlY3RlZFJld2FyZDogbnVtYmVyO1xuICBleHBsb3JhdGlvbk5lZWRlZDogYm9vbGVhbjtcbiAgcmVhc29uaW5nOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29udGV4dHVhbFBlcmZvcm1hbmNlIHtcbiAgY29udGV4dDogc3RyaW5nO1xuICBhcm1QZXJmb3JtYW5jZTogUmVjb3JkPFxuICAgIEFybSxcbiAgICB7XG4gICAgICB3aW5SYXRlOiBudW1iZXI7XG4gICAgICBhdmdMYXRlbmN5OiBudW1iZXI7XG4gICAgICBhdmdDb3N0OiBudW1iZXI7XG4gICAgICB0cmlhbHM6IG51bWJlcjtcbiAgICAgIGNvbmZpZGVuY2U6IG51bWJlcjtcbiAgICB9XG4gID47XG4gIGJlc3RBcm06IEFybTtcbiAgaW1wcm92ZW1lbnQ6IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIEJhbmRpdE9wdGltaXplciB7XG4gIHByaXZhdGUgYmFuZGl0OiBUaG9tcHNvbkJhbmRpdDtcbiAgcHJpdmF0ZSBleHBlcmltZW50TWFuYWdlcj86IEV2aWRlbnRseUV4cGVyaW1lbnRNYW5hZ2VyO1xuICBwcml2YXRlIGNvbmZpZzogT3B0aW1pemF0aW9uQ29uZmlnO1xuICBwcml2YXRlIG9wdGltaXphdGlvbkhpc3Rvcnk6IEFycmF5PHtcbiAgICB0aW1lc3RhbXA6IERhdGU7XG4gICAgY29udGV4dD86IEJhbmRpdENvbnRleHQ7XG4gICAgcmVzdWx0OiBPcHRpbWl6YXRpb25SZXN1bHQ7XG4gICAgYWN0dWFsT3V0Y29tZT86IGJvb2xlYW47XG4gIH0+ID0gW107XG5cbiAgY29uc3RydWN0b3IoXG4gICAgYmFuZGl0PzogVGhvbXBzb25CYW5kaXQsXG4gICAgZXhwZXJpbWVudE1hbmFnZXI/OiBFdmlkZW50bHlFeHBlcmltZW50TWFuYWdlcixcbiAgICBjb25maWc/OiBQYXJ0aWFsPE9wdGltaXphdGlvbkNvbmZpZz5cbiAgKSB7XG4gICAgdGhpcy5iYW5kaXQgPSBiYW5kaXQgfHwgbmV3IFRob21wc29uQmFuZGl0KCk7XG4gICAgdGhpcy5leHBlcmltZW50TWFuYWdlciA9IGV4cGVyaW1lbnRNYW5hZ2VyO1xuICAgIHRoaXMuY29uZmlnID0ge1xuICAgICAgZXhwbG9yYXRpb25SYXRlOiAwLjEsXG4gICAgICBjb25maWRlbmNlTGV2ZWw6IDAuOTUsXG4gICAgICBtaW5UcmlhbHNGb3JDb25maWRlbmNlOiAyMCxcbiAgICAgIGF1dG9PcHRpbWl6YXRpb25FbmFibGVkOiB0cnVlLFxuICAgICAgb3B0aW1pemF0aW9uSW50ZXJ2YWw6IDYwLCAvLyAxIGhvdXJcbiAgICAgIC4uLmNvbmZpZyxcbiAgICB9O1xuXG4gICAgaWYgKHRoaXMuY29uZmlnLmF1dG9PcHRpbWl6YXRpb25FbmFibGVkKSB7XG4gICAgICB0aGlzLnN0YXJ0QXV0b09wdGltaXphdGlvbigpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVQ0IgKFVwcGVyIENvbmZpZGVuY2UgQm91bmQpIGFsZ29yaXRobSBmb3IgYXJtIHNlbGVjdGlvblxuICAgKi9cbiAgc2VsZWN0QXJtVUNCKGNvbnRleHQ/OiBCYW5kaXRDb250ZXh0KTogT3B0aW1pemF0aW9uUmVzdWx0IHtcbiAgICBjb25zdCBzdGF0cyA9IHRoaXMuYmFuZGl0LmdldFN0YXRzKGNvbnRleHQpO1xuICAgIGNvbnN0IHRvdGFsVHJpYWxzID0gT2JqZWN0LnZhbHVlcyhzdGF0cykucmVkdWNlKFxuICAgICAgKHN1bSwgc3RhdCkgPT4gc3VtICsgc3RhdC50cmlhbHMsXG4gICAgICAwXG4gICAgKTtcblxuICAgIGlmICh0b3RhbFRyaWFscyA9PT0gMCkge1xuICAgICAgLy8gTm8gZGF0YSB5ZXQsIHJldHVybiByYW5kb20gYXJtXG4gICAgICBjb25zdCBhcm1zOiBBcm1bXSA9IFtcImJlZHJvY2tcIiwgXCJnb29nbGVcIiwgXCJtZXRhXCJdO1xuICAgICAgY29uc3QgcmFuZG9tQXJtID0gYXJtc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBhcm1zLmxlbmd0aCldO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmVjb21tZW5kZWRBcm06IHJhbmRvbUFybSxcbiAgICAgICAgY29uZmlkZW5jZTogMC4zMyxcbiAgICAgICAgZXhwZWN0ZWRSZXdhcmQ6IDAuNSxcbiAgICAgICAgZXhwbG9yYXRpb25OZWVkZWQ6IHRydWUsXG4gICAgICAgIHJlYXNvbmluZzogXCJObyBoaXN0b3JpY2FsIGRhdGEgYXZhaWxhYmxlLCBleHBsb3JpbmcgcmFuZG9tbHlcIixcbiAgICAgIH07XG4gICAgfVxuXG4gICAgbGV0IGJlc3RBcm06IEFybSA9IFwiYmVkcm9ja1wiO1xuICAgIGxldCBiZXN0VUNCID0gLTE7XG4gICAgY29uc3QgdWNiU3RhdHM6IFJlY29yZDxBcm0sIFVDQlN0YXRzPiA9IHt9IGFzIGFueTtcblxuICAgIC8vIENhbGN1bGF0ZSBVQ0IgZm9yIGVhY2ggYXJtXG4gICAgKE9iamVjdC5rZXlzKHN0YXRzKSBhcyBBcm1bXSkuZm9yRWFjaCgoYXJtKSA9PiB7XG4gICAgICBjb25zdCBhcm1TdGF0cyA9IHN0YXRzW2FybV07XG5cbiAgICAgIGlmIChhcm1TdGF0cy50cmlhbHMgPT09IDApIHtcbiAgICAgICAgLy8gVW5wbGF5ZWQgYXJtIGdldHMgaW5maW5pdGUgVUNCXG4gICAgICAgIHVjYlN0YXRzW2FybV0gPSB7XG4gICAgICAgICAgLi4uYXJtU3RhdHMsXG4gICAgICAgICAgdWNiU2NvcmU6IEluZmluaXR5LFxuICAgICAgICAgIGNvbmZpZGVuY2VSYWRpdXM6IEluZmluaXR5LFxuICAgICAgICB9O1xuICAgICAgICBiZXN0QXJtID0gYXJtO1xuICAgICAgICBiZXN0VUNCID0gSW5maW5pdHk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gVUNCIGZvcm11bGE6IG1lYW4gKyBjb25maWRlbmNlX3JhZGl1c1xuICAgICAgY29uc3QgbWVhbiA9IGFybVN0YXRzLndpblJhdGU7XG4gICAgICBjb25zdCBjb25maWRlbmNlUmFkaXVzID1cbiAgICAgICAgTWF0aC5zcXJ0KCgyICogTWF0aC5sb2codG90YWxUcmlhbHMpKSAvIGFybVN0YXRzLnRyaWFscykgKlxuICAgICAgICB0aGlzLmNvbmZpZy5leHBsb3JhdGlvblJhdGU7XG5cbiAgICAgIGNvbnN0IHVjYlNjb3JlID0gbWVhbiArIGNvbmZpZGVuY2VSYWRpdXM7XG5cbiAgICAgIHVjYlN0YXRzW2FybV0gPSB7XG4gICAgICAgIC4uLmFybVN0YXRzLFxuICAgICAgICB1Y2JTY29yZSxcbiAgICAgICAgY29uZmlkZW5jZVJhZGl1cyxcbiAgICAgIH07XG5cbiAgICAgIGlmICh1Y2JTY29yZSA+IGJlc3RVQ0IpIHtcbiAgICAgICAgYmVzdFVDQiA9IHVjYlNjb3JlO1xuICAgICAgICBiZXN0QXJtID0gYXJtO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgY29uc3QgYmVzdFN0YXRzID0gdWNiU3RhdHNbYmVzdEFybV07XG4gICAgY29uc3QgY29uZmlkZW5jZSA9XG4gICAgICBiZXN0U3RhdHMudHJpYWxzID49IHRoaXMuY29uZmlnLm1pblRyaWFsc0ZvckNvbmZpZGVuY2VcbiAgICAgICAgPyBNYXRoLm1pbigwLjk1LCBiZXN0U3RhdHMud2luUmF0ZSArIDAuMSlcbiAgICAgICAgOiBNYXRoLm1heCgwLjMsIGJlc3RTdGF0cy53aW5SYXRlKTtcblxuICAgIGNvbnN0IGV4cGxvcmF0aW9uTmVlZGVkID1cbiAgICAgIGJlc3RTdGF0cy5jb25maWRlbmNlUmFkaXVzID4gMC4xIHx8XG4gICAgICBiZXN0U3RhdHMudHJpYWxzIDwgdGhpcy5jb25maWcubWluVHJpYWxzRm9yQ29uZmlkZW5jZTtcblxuICAgIHJldHVybiB7XG4gICAgICByZWNvbW1lbmRlZEFybTogYmVzdEFybSxcbiAgICAgIGNvbmZpZGVuY2UsXG4gICAgICBleHBlY3RlZFJld2FyZDogYmVzdFN0YXRzLndpblJhdGUsXG4gICAgICBleHBsb3JhdGlvbk5lZWRlZCxcbiAgICAgIHJlYXNvbmluZzogZXhwbG9yYXRpb25OZWVkZWRcbiAgICAgICAgPyBgRXhwbG9yYXRpb24gbmVlZGVkOiAke1xuICAgICAgICAgICAgYmVzdFN0YXRzLnRyaWFsc1xuICAgICAgICAgIH0gdHJpYWxzLCBjb25maWRlbmNlIHJhZGl1cyAke2Jlc3RTdGF0cy5jb25maWRlbmNlUmFkaXVzLnRvRml4ZWQoMyl9YFxuICAgICAgICA6IGBFeHBsb2l0YXRpb246IEhpZ2ggY29uZmlkZW5jZSBpbiAke2Jlc3RBcm19ICgke1xuICAgICAgICAgICAgYmVzdFN0YXRzLnRyaWFsc1xuICAgICAgICAgIH0gdHJpYWxzLCAkeyhiZXN0U3RhdHMud2luUmF0ZSAqIDEwMCkudG9GaXhlZCgxKX0lIHdpbiByYXRlKWAsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaG9tcHNvbiBTYW1wbGluZyB3aXRoIGNvbnRleHR1YWwgaW5mb3JtYXRpb25cbiAgICovXG4gIHNlbGVjdEFybVRob21wc29uKGNvbnRleHQ/OiBCYW5kaXRDb250ZXh0KTogT3B0aW1pemF0aW9uUmVzdWx0IHtcbiAgICBjb25zdCBjaG9zZW5Bcm0gPSB0aGlzLmJhbmRpdC5jaG9vc2UoY29udGV4dCk7XG4gICAgY29uc3Qgc3RhdHMgPSB0aGlzLmJhbmRpdC5nZXRTdGF0cyhjb250ZXh0KTtcbiAgICBjb25zdCBhcm1TdGF0cyA9IHN0YXRzW2Nob3NlbkFybV07XG5cbiAgICBjb25zdCBjb25maWRlbmNlID1cbiAgICAgIGFybVN0YXRzLnRyaWFscyA+PSB0aGlzLmNvbmZpZy5taW5UcmlhbHNGb3JDb25maWRlbmNlXG4gICAgICAgID8gTWF0aC5taW4oMC45NSwgYXJtU3RhdHMud2luUmF0ZSArIDAuMSlcbiAgICAgICAgOiBNYXRoLm1heCgwLjMsIGFybVN0YXRzLndpblJhdGUpO1xuXG4gICAgY29uc3QgZXhwbG9yYXRpb25OZWVkZWQgPVxuICAgICAgYXJtU3RhdHMudHJpYWxzIDwgdGhpcy5jb25maWcubWluVHJpYWxzRm9yQ29uZmlkZW5jZTtcblxuICAgIHJldHVybiB7XG4gICAgICByZWNvbW1lbmRlZEFybTogY2hvc2VuQXJtLFxuICAgICAgY29uZmlkZW5jZSxcbiAgICAgIGV4cGVjdGVkUmV3YXJkOiBhcm1TdGF0cy53aW5SYXRlLFxuICAgICAgZXhwbG9yYXRpb25OZWVkZWQsXG4gICAgICByZWFzb25pbmc6IGBUaG9tcHNvbiBTYW1wbGluZyBzZWxlY3RlZCAke2Nob3NlbkFybX0gYmFzZWQgb24gQmV0YSgke1xuICAgICAgICAxICsgYXJtU3RhdHMud2luc1xuICAgICAgfSwgJHsxICsgYXJtU3RhdHMudHJpYWxzIC0gYXJtU3RhdHMud2luc30pIGRpc3RyaWJ1dGlvbmAsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIeWJyaWQgYXBwcm9hY2g6IFVDQiBmb3IgZXhwbG9yYXRpb24sIFRob21wc29uIGZvciBleHBsb2l0YXRpb25cbiAgICovXG4gIHNlbGVjdEFybUh5YnJpZChjb250ZXh0PzogQmFuZGl0Q29udGV4dCk6IE9wdGltaXphdGlvblJlc3VsdCB7XG4gICAgY29uc3Qgc3RhdHMgPSB0aGlzLmJhbmRpdC5nZXRTdGF0cyhjb250ZXh0KTtcbiAgICBjb25zdCB0b3RhbFRyaWFscyA9IE9iamVjdC52YWx1ZXMoc3RhdHMpLnJlZHVjZShcbiAgICAgIChzdW0sIHN0YXQpID0+IHN1bSArIHN0YXQudHJpYWxzLFxuICAgICAgMFxuICAgICk7XG5cbiAgICAvLyBVc2UgVUNCIGZvciBlYXJseSBleHBsb3JhdGlvblxuICAgIGlmICh0b3RhbFRyaWFscyA8IHRoaXMuY29uZmlnLm1pblRyaWFsc0ZvckNvbmZpZGVuY2UgKiAzKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZWxlY3RBcm1VQ0IoY29udGV4dCk7XG4gICAgfVxuXG4gICAgLy8gVXNlIFRob21wc29uIFNhbXBsaW5nIGZvciBleHBsb2l0YXRpb25cbiAgICByZXR1cm4gdGhpcy5zZWxlY3RBcm1UaG9tcHNvbihjb250ZXh0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgb3B0aW1hbCBhcm0gd2l0aCBleHBlcmltZW50IGludGVncmF0aW9uXG4gICAqL1xuICBhc3luYyBnZXRPcHRpbWFsQXJtKGNvbnRleHQ6IEV4cGVyaW1lbnRDb250ZXh0KTogUHJvbWlzZTxPcHRpbWl6YXRpb25SZXN1bHQ+IHtcbiAgICAvLyBDaGVjayBpZiBleHBlcmltZW50IG1hbmFnZXIgaXMgYXZhaWxhYmxlIGFuZCBoYXMgYWN0aXZlIGV4cGVyaW1lbnRzXG4gICAgaWYgKHRoaXMuZXhwZXJpbWVudE1hbmFnZXIpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGV4cGVyaW1lbnRSZXN1bHQgPVxuICAgICAgICAgIGF3YWl0IHRoaXMuZXhwZXJpbWVudE1hbmFnZXIuZ2V0T3B0aW1hbFByb3ZpZGVyKGNvbnRleHQpO1xuXG4gICAgICAgIGlmIChleHBlcmltZW50UmVzdWx0LnNvdXJjZSA9PT0gXCJleHBlcmltZW50XCIpIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVjb21tZW5kZWRBcm06IGV4cGVyaW1lbnRSZXN1bHQucHJvdmlkZXIsXG4gICAgICAgICAgICBjb25maWRlbmNlOiBleHBlcmltZW50UmVzdWx0LmNvbmZpZGVuY2UsXG4gICAgICAgICAgICBleHBlY3RlZFJld2FyZDogMC44LCAvLyBBc3N1bWUgZXhwZXJpbWVudHMgYXJlIHdlbGwtZGVzaWduZWRcbiAgICAgICAgICAgIGV4cGxvcmF0aW9uTmVlZGVkOiBmYWxzZSxcbiAgICAgICAgICAgIHJlYXNvbmluZzogYEV4cGVyaW1lbnQgYXNzaWdubWVudDogJHtleHBlcmltZW50UmVzdWx0LmV4cGVyaW1lbnROYW1lfWAsXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgIFwiRmFpbGVkIHRvIGdldCBleHBlcmltZW50IGFzc2lnbm1lbnQsIGZhbGxpbmcgYmFjayB0byBiYW5kaXQ6XCIsXG4gICAgICAgICAgZXJyb3JcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBGYWxsIGJhY2sgdG8gYmFuZGl0IG9wdGltaXphdGlvblxuICAgIHJldHVybiB0aGlzLnNlbGVjdEFybUh5YnJpZChjb250ZXh0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWNvcmQgb3V0Y29tZSBhbmQgdXBkYXRlIG9wdGltaXphdGlvblxuICAgKi9cbiAgYXN5bmMgcmVjb3JkT3V0Y29tZShcbiAgICBjb250ZXh0OiBFeHBlcmltZW50Q29udGV4dCxcbiAgICBhcm06IEFybSxcbiAgICBzdWNjZXNzOiBib29sZWFuLFxuICAgIGxhdGVuY3lNczogbnVtYmVyLFxuICAgIGNvc3RFdXJvOiBudW1iZXIsXG4gICAgcXVhbGl0eVNjb3JlPzogbnVtYmVyXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIFJlY29yZCBpbiBiYW5kaXRcbiAgICB0aGlzLmJhbmRpdC5yZWNvcmQoYXJtLCBzdWNjZXNzLCBjb3N0RXVybywgbGF0ZW5jeU1zLCBjb250ZXh0KTtcblxuICAgIC8vIFJlY29yZCBpbiBleHBlcmltZW50IG1hbmFnZXIgaWYgYXZhaWxhYmxlXG4gICAgaWYgKHRoaXMuZXhwZXJpbWVudE1hbmFnZXIpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMuZXhwZXJpbWVudE1hbmFnZXIucmVjb3JkRXhwZXJpbWVudE91dGNvbWUoY29udGV4dCwgYXJtLCB7XG4gICAgICAgICAgc3VjY2VzcyxcbiAgICAgICAgICBsYXRlbmN5TXMsXG4gICAgICAgICAgY29zdEV1cm8sXG4gICAgICAgICAgcXVhbGl0eVNjb3JlLFxuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIkZhaWxlZCB0byByZWNvcmQgZXhwZXJpbWVudCBvdXRjb21lOlwiLCBlcnJvcik7XG4gICAgICAgIC8vIENvbnRpbnVlIGV4ZWN1dGlvbiAtIGJhbmRpdCByZWNvcmRpbmcgaXMgbW9yZSBpbXBvcnRhbnRcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgb3B0aW1pemF0aW9uIGhpc3RvcnlcbiAgICBjb25zdCBsYXN0T3B0aW1pemF0aW9uID1cbiAgICAgIHRoaXMub3B0aW1pemF0aW9uSGlzdG9yeVt0aGlzLm9wdGltaXphdGlvbkhpc3RvcnkubGVuZ3RoIC0gMV07XG4gICAgaWYgKGxhc3RPcHRpbWl6YXRpb24gJiYgIWxhc3RPcHRpbWl6YXRpb24uYWN0dWFsT3V0Y29tZSkge1xuICAgICAgbGFzdE9wdGltaXphdGlvbi5hY3R1YWxPdXRjb21lID0gc3VjY2VzcztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQW5hbHl6ZSBjb250ZXh0dWFsIHBlcmZvcm1hbmNlIGFjcm9zcyBkaWZmZXJlbnQgY29udGV4dHNcbiAgICovXG4gIGFuYWx5emVDb250ZXh0dWFsUGVyZm9ybWFuY2UoKTogQ29udGV4dHVhbFBlcmZvcm1hbmNlW10ge1xuICAgIGNvbnN0IGNvbnRleHRzID0gdGhpcy5nZXRVbmlxdWVDb250ZXh0cygpO1xuXG4gICAgcmV0dXJuIGNvbnRleHRzLm1hcCgoY29udGV4dEtleSkgPT4ge1xuICAgICAgY29uc3QgY29udGV4dCA9IHRoaXMucGFyc2VDb250ZXh0S2V5KGNvbnRleHRLZXkpO1xuICAgICAgY29uc3Qgc3RhdHMgPSB0aGlzLmJhbmRpdC5nZXRTdGF0cyhjb250ZXh0KTtcblxuICAgICAgY29uc3QgYXJtUGVyZm9ybWFuY2U6IFJlY29yZDxBcm0sIGFueT4gPSB7fSBhcyBhbnk7XG4gICAgICBsZXQgYmVzdEFybTogQXJtID0gXCJiZWRyb2NrXCI7XG4gICAgICBsZXQgYmVzdFNjb3JlID0gLTE7XG5cbiAgICAgIChPYmplY3Qua2V5cyhzdGF0cykgYXMgQXJtW10pLmZvckVhY2goKGFybSkgPT4ge1xuICAgICAgICBjb25zdCBhcm1TdGF0cyA9IHN0YXRzW2FybV07XG4gICAgICAgIGNvbnN0IGNvbmZpZGVuY2UgPVxuICAgICAgICAgIGFybVN0YXRzLnRyaWFscyA+PSB0aGlzLmNvbmZpZy5taW5UcmlhbHNGb3JDb25maWRlbmNlXG4gICAgICAgICAgICA/IE1hdGgubWluKDAuOTUsIGFybVN0YXRzLndpblJhdGUgKyAwLjEpXG4gICAgICAgICAgICA6IE1hdGgubWF4KDAuMywgYXJtU3RhdHMud2luUmF0ZSk7XG5cbiAgICAgICAgLy8gQ29tcG9zaXRlIHNjb3JlOiB3aW4gcmF0ZSAoNTAlKSArIGxhdGVuY3kgKDMwJSkgKyBjb3N0ICgyMCUpXG4gICAgICAgIGNvbnN0IHNjb3JlID1cbiAgICAgICAgICBhcm1TdGF0cy53aW5SYXRlICogMC41ICtcbiAgICAgICAgICAoMSAvIChhcm1TdGF0cy5hdmdMYXRlbmN5ICsgMSkpICogMC4zICtcbiAgICAgICAgICAoMSAvIChhcm1TdGF0cy5hdmdDb3N0ICsgMC4wMSkpICogMC4yO1xuXG4gICAgICAgIGFybVBlcmZvcm1hbmNlW2FybV0gPSB7XG4gICAgICAgICAgd2luUmF0ZTogYXJtU3RhdHMud2luUmF0ZSxcbiAgICAgICAgICBhdmdMYXRlbmN5OiBhcm1TdGF0cy5hdmdMYXRlbmN5LFxuICAgICAgICAgIGF2Z0Nvc3Q6IGFybVN0YXRzLmF2Z0Nvc3QsXG4gICAgICAgICAgdHJpYWxzOiBhcm1TdGF0cy50cmlhbHMsXG4gICAgICAgICAgY29uZmlkZW5jZSxcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAoc2NvcmUgPiBiZXN0U2NvcmUpIHtcbiAgICAgICAgICBiZXN0U2NvcmUgPSBzY29yZTtcbiAgICAgICAgICBiZXN0QXJtID0gYXJtO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgLy8gQ2FsY3VsYXRlIGltcHJvdmVtZW50IG92ZXIgcmFuZG9tIGJhc2VsaW5lICgzMyUgd2luIHJhdGUpXG4gICAgICBjb25zdCBpbXByb3ZlbWVudCA9IChhcm1QZXJmb3JtYW5jZVtiZXN0QXJtXS53aW5SYXRlIC0gMC4zMykgLyAwLjMzO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBjb250ZXh0OiBjb250ZXh0S2V5LFxuICAgICAgICBhcm1QZXJmb3JtYW5jZSxcbiAgICAgICAgYmVzdEFybSxcbiAgICAgICAgaW1wcm92ZW1lbnQsXG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBvcHRpbWl6YXRpb24gcmVjb21tZW5kYXRpb25zIGJhc2VkIG9uIGN1cnJlbnQgcGVyZm9ybWFuY2VcbiAgICovXG4gIGdldE9wdGltaXphdGlvblJlY29tbWVuZGF0aW9ucygpOiBBcnJheTx7XG4gICAgdHlwZTogXCJleHBsb3JhdGlvblwiIHwgXCJleHBsb2l0YXRpb25cIiB8IFwiY29udGV4dF9zcGVjaWZpY1wiIHwgXCJleHBlcmltZW50XCI7XG4gICAgcHJpb3JpdHk6IFwiaGlnaFwiIHwgXCJtZWRpdW1cIiB8IFwibG93XCI7XG4gICAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgICBhY3Rpb246IHN0cmluZztcbiAgfT4ge1xuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9ucyA9IFtdO1xuICAgIGNvbnN0IGNvbnRleHR1YWxQZXJmb3JtYW5jZSA9IHRoaXMuYW5hbHl6ZUNvbnRleHR1YWxQZXJmb3JtYW5jZSgpO1xuICAgIGNvbnN0IGdsb2JhbFN0YXRzID0gdGhpcy5iYW5kaXQuZ2V0U3RhdHMoKTtcblxuICAgIC8vIENoZWNrIGZvciB1bmRlci1leHBsb3JlZCBhcm1zXG4gICAgY29uc3QgdW5kZXJFeHBsb3JlZEFybXMgPSAoT2JqZWN0LmtleXMoZ2xvYmFsU3RhdHMpIGFzIEFybVtdKS5maWx0ZXIoXG4gICAgICAoYXJtKSA9PiBnbG9iYWxTdGF0c1thcm1dLnRyaWFscyA8IHRoaXMuY29uZmlnLm1pblRyaWFsc0ZvckNvbmZpZGVuY2VcbiAgICApO1xuXG4gICAgaWYgKHVuZGVyRXhwbG9yZWRBcm1zLmxlbmd0aCA+IDApIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKHtcbiAgICAgICAgdHlwZTogXCJleHBsb3JhdGlvblwiIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogXCJoaWdoXCIgYXMgY29uc3QsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgQXJtcyAke3VuZGVyRXhwbG9yZWRBcm1zLmpvaW4oXG4gICAgICAgICAgXCIsIFwiXG4gICAgICAgICl9IG5lZWQgbW9yZSBleHBsb3JhdGlvbmAsXG4gICAgICAgIGFjdGlvbjogYEluY3JlYXNlIGV4cGxvcmF0aW9uIHJhdGUgb3IgZm9yY2UgZXhwbG9yYXRpb24gb2YgJHt1bmRlckV4cGxvcmVkQXJtcy5qb2luKFxuICAgICAgICAgIFwiLCBcIlxuICAgICAgICApfWAsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBmb3IgY29udGV4dHMgd2l0aCBwb29yIHBlcmZvcm1hbmNlXG4gICAgY29uc3QgcG9vclBlcmZvcm1pbmdDb250ZXh0cyA9IGNvbnRleHR1YWxQZXJmb3JtYW5jZS5maWx0ZXIoXG4gICAgICAoY3R4KSA9PiBjdHguaW1wcm92ZW1lbnQgPCAwLjEgLy8gTGVzcyB0aGFuIDEwJSBpbXByb3ZlbWVudCBvdmVyIHJhbmRvbVxuICAgICk7XG5cbiAgICBpZiAocG9vclBlcmZvcm1pbmdDb250ZXh0cy5sZW5ndGggPiAwKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6IFwiY29udGV4dF9zcGVjaWZpY1wiIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogXCJtZWRpdW1cIiBhcyBjb25zdCxcbiAgICAgICAgZGVzY3JpcHRpb246IGBQb29yIHBlcmZvcm1hbmNlIGluIGNvbnRleHRzOiAke3Bvb3JQZXJmb3JtaW5nQ29udGV4dHNcbiAgICAgICAgICAubWFwKChjKSA9PiBjLmNvbnRleHQpXG4gICAgICAgICAgLmpvaW4oXCIsIFwiKX1gLFxuICAgICAgICBhY3Rpb246IFwiQ29uc2lkZXIgY29udGV4dC1zcGVjaWZpYyBvcHRpbWl6YXRpb24gb3IgZmVhdHVyZSBlbmdpbmVlcmluZ1wiLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZm9yIGhpZ2gtY29uZmlkZW5jZSB3aW5uZXJzXG4gICAgY29uc3QgaGlnaENvbmZpZGVuY2VDb250ZXh0cyA9IGNvbnRleHR1YWxQZXJmb3JtYW5jZS5maWx0ZXIoXG4gICAgICAoY3R4KSA9PlxuICAgICAgICBjdHguYXJtUGVyZm9ybWFuY2VbY3R4LmJlc3RBcm1dLmNvbmZpZGVuY2UgPiAwLjkgJiZcbiAgICAgICAgY3R4LmFybVBlcmZvcm1hbmNlW2N0eC5iZXN0QXJtXS50cmlhbHMgPiA1MFxuICAgICk7XG5cbiAgICBpZiAoaGlnaENvbmZpZGVuY2VDb250ZXh0cy5sZW5ndGggPiAwKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6IFwiZXhwbG9pdGF0aW9uXCIgYXMgY29uc3QsXG4gICAgICAgIHByaW9yaXR5OiBcImxvd1wiIGFzIGNvbnN0LFxuICAgICAgICBkZXNjcmlwdGlvbjogYEhpZ2ggY29uZmlkZW5jZSB3aW5uZXJzIGZvdW5kIGluICR7aGlnaENvbmZpZGVuY2VDb250ZXh0cy5sZW5ndGh9IGNvbnRleHRzYCxcbiAgICAgICAgYWN0aW9uOiBcIkNvbnNpZGVyIHJlZHVjaW5nIGV4cGxvcmF0aW9uIHJhdGUgZm9yIHRoZXNlIGNvbnRleHRzXCIsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBTdWdnZXN0IGV4cGVyaW1lbnRzIGZvciBwcm9taXNpbmcgY29udGV4dHNcbiAgICBjb25zdCBwcm9taXNpbmdDb250ZXh0cyA9IGNvbnRleHR1YWxQZXJmb3JtYW5jZS5maWx0ZXIoXG4gICAgICAoY3R4KSA9PlxuICAgICAgICBjdHguaW1wcm92ZW1lbnQgPiAwLjIgJiYgY3R4LmFybVBlcmZvcm1hbmNlW2N0eC5iZXN0QXJtXS50cmlhbHMgPiAzMFxuICAgICk7XG5cbiAgICBpZiAocHJvbWlzaW5nQ29udGV4dHMubGVuZ3RoID4gMCAmJiB0aGlzLmV4cGVyaW1lbnRNYW5hZ2VyKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6IFwiZXhwZXJpbWVudFwiIGFzIGNvbnN0LFxuICAgICAgICBwcmlvcml0eTogXCJtZWRpdW1cIiBhcyBjb25zdCxcbiAgICAgICAgZGVzY3JpcHRpb246IGBQcm9taXNpbmcgY29udGV4dHMgZm91bmQ6ICR7cHJvbWlzaW5nQ29udGV4dHNcbiAgICAgICAgICAubWFwKChjKSA9PiBjLmNvbnRleHQpXG4gICAgICAgICAgLmpvaW4oXCIsIFwiKX1gLFxuICAgICAgICBhY3Rpb246IFwiQ29uc2lkZXIgcnVubmluZyBmb3JtYWwgQS9CIGV4cGVyaW1lbnRzIHRvIHZhbGlkYXRlIGZpbmRpbmdzXCIsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVjb21tZW5kYXRpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0YXJ0IGF1dG9tYXRpYyBvcHRpbWl6YXRpb24gcHJvY2Vzc1xuICAgKi9cbiAgcHJpdmF0ZSBzdGFydEF1dG9PcHRpbWl6YXRpb24oKTogdm9pZCB7XG4gICAgc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgdGhpcy5ydW5PcHRpbWl6YXRpb25DeWNsZSgpO1xuICAgIH0sIHRoaXMuY29uZmlnLm9wdGltaXphdGlvbkludGVydmFsICogNjAgKiAxMDAwKTsgLy8gQ29udmVydCBtaW51dGVzIHRvIG1zXG4gIH1cblxuICAvKipcbiAgICogUnVuIGEgc2luZ2xlIG9wdGltaXphdGlvbiBjeWNsZVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBydW5PcHRpbWl6YXRpb25DeWNsZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVjb21tZW5kYXRpb25zID0gdGhpcy5nZXRPcHRpbWl6YXRpb25SZWNvbW1lbmRhdGlvbnMoKTtcblxuICAgICAgLy8gTG9nIHJlY29tbWVuZGF0aW9uc1xuICAgICAgaWYgKHJlY29tbWVuZGF0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiQmFuZGl0IE9wdGltaXphdGlvbiBSZWNvbW1lbmRhdGlvbnM6XCIsIHJlY29tbWVuZGF0aW9ucyk7XG4gICAgICB9XG5cbiAgICAgIC8vIEF1dG8tYXBwbHkgbG93LXJpc2sgb3B0aW1pemF0aW9uc1xuICAgICAgY29uc3QgaGlnaFByaW9yaXR5UmVjcyA9IHJlY29tbWVuZGF0aW9ucy5maWx0ZXIoXG4gICAgICAgIChyKSA9PiByLnByaW9yaXR5ID09PSBcImhpZ2hcIlxuICAgICAgKTtcblxuICAgICAgZm9yIChjb25zdCByZWMgb2YgaGlnaFByaW9yaXR5UmVjcykge1xuICAgICAgICBpZiAocmVjLnR5cGUgPT09IFwiZXhwbG9yYXRpb25cIikge1xuICAgICAgICAgIC8vIFRlbXBvcmFyaWx5IGluY3JlYXNlIGV4cGxvcmF0aW9uIHJhdGVcbiAgICAgICAgICB0aGlzLmNvbmZpZy5leHBsb3JhdGlvblJhdGUgPSBNYXRoLm1pbihcbiAgICAgICAgICAgIDAuMyxcbiAgICAgICAgICAgIHRoaXMuY29uZmlnLmV4cGxvcmF0aW9uUmF0ZSAqIDEuMlxuICAgICAgICAgICk7XG4gICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICBgQXV0by1vcHRpbWl6YXRpb246IEluY3JlYXNlZCBleHBsb3JhdGlvbiByYXRlIHRvICR7dGhpcy5jb25maWcuZXhwbG9yYXRpb25SYXRlfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFJlc2V0IGV4cGxvcmF0aW9uIHJhdGUgYWZ0ZXIgc29tZSB0aW1lXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5jb25maWcuZXhwbG9yYXRpb25SYXRlID0gTWF0aC5tYXgoXG4gICAgICAgICAgMC4wNSxcbiAgICAgICAgICB0aGlzLmNvbmZpZy5leHBsb3JhdGlvblJhdGUgKiAwLjlcbiAgICAgICAgKTtcbiAgICAgIH0sIDMwICogNjAgKiAxMDAwKTsgLy8gMzAgbWludXRlc1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgaW4gb3B0aW1pemF0aW9uIGN5Y2xlOlwiLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCB1bmlxdWUgY29udGV4dHMgZnJvbSBiYW5kaXQgaGlzdG9yeVxuICAgKi9cbiAgcHJpdmF0ZSBnZXRVbmlxdWVDb250ZXh0cygpOiBzdHJpbmdbXSB7XG4gICAgLy8gVGhpcyB3b3VsZCBuZWVkIHRvIGJlIGltcGxlbWVudGVkIGJhc2VkIG9uIGhvdyBjb250ZXh0cyBhcmUgc3RvcmVkXG4gICAgLy8gRm9yIG5vdywgcmV0dXJuIHNvbWUgY29tbW9uIGNvbnRleHRzXG4gICAgcmV0dXJuIFtcbiAgICAgIFwiZ2VuZXJhbHxzdGFuZGFyZHxuby10b29sc1wiLFxuICAgICAgXCJsZWdhbHxwcmVtaXVtfHRvb2xzXCIsXG4gICAgICBcImN1bGluYXJ5fHN0YW5kYXJkfG5vLXRvb2xzXCIsXG4gICAgICBcIm1lZGljYWx8cHJlbWl1bXx0b29sc1wiLFxuICAgIF07XG4gIH1cblxuICAvKipcbiAgICogUGFyc2UgY29udGV4dCBrZXkgYmFjayB0byBCYW5kaXRDb250ZXh0XG4gICAqL1xuICBwcml2YXRlIHBhcnNlQ29udGV4dEtleShjb250ZXh0S2V5OiBzdHJpbmcpOiBCYW5kaXRDb250ZXh0IHtcbiAgICBjb25zdCBbZG9tYWluLCBidWRnZXRUaWVyLCB0b29sc10gPSBjb250ZXh0S2V5LnNwbGl0KFwifFwiKTtcbiAgICByZXR1cm4ge1xuICAgICAgZG9tYWluOiBkb21haW4gPT09IFwiZ2VuZXJhbFwiID8gdW5kZWZpbmVkIDogZG9tYWluLFxuICAgICAgYnVkZ2V0VGllcjogYnVkZ2V0VGllciA9PT0gXCJzdGFuZGFyZFwiID8gdW5kZWZpbmVkIDogYnVkZ2V0VGllcixcbiAgICAgIHJlcXVpcmVUb29sczogdG9vbHMgPT09IFwidG9vbHNcIixcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIGdldENvbmZpZygpOiBPcHRpbWl6YXRpb25Db25maWcge1xuICAgIHJldHVybiB7IC4uLnRoaXMuY29uZmlnIH07XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIHVwZGF0ZUNvbmZpZyh1cGRhdGVzOiBQYXJ0aWFsPE9wdGltaXphdGlvbkNvbmZpZz4pOiB2b2lkIHtcbiAgICB0aGlzLmNvbmZpZyA9IHsgLi4udGhpcy5jb25maWcsIC4uLnVwZGF0ZXMgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgb3B0aW1pemF0aW9uIGhpc3RvcnlcbiAgICovXG4gIGdldE9wdGltaXphdGlvbkhpc3RvcnkoKTogdHlwZW9mIHRoaXMub3B0aW1pemF0aW9uSGlzdG9yeSB7XG4gICAgcmV0dXJuIFsuLi50aGlzLm9wdGltaXphdGlvbkhpc3RvcnldO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0IGJhbmRpdCBhbmQgb3B0aW1pemF0aW9uIGhpc3RvcnlcbiAgICovXG4gIHJlc2V0KCk6IHZvaWQge1xuICAgIHRoaXMuYmFuZGl0ID0gbmV3IFRob21wc29uQmFuZGl0KCk7XG4gICAgdGhpcy5vcHRpbWl6YXRpb25IaXN0b3J5ID0gW107XG4gIH1cblxuICAvKipcbiAgICogRXhwb3J0IGJhbmRpdCBzdGF0ZSBmb3IgcGVyc2lzdGVuY2VcbiAgICovXG4gIGV4cG9ydFN0YXRlKCk6IHtcbiAgICBiYW5kaXRTdGF0czogUmV0dXJuVHlwZTxUaG9tcHNvbkJhbmRpdFtcImdldFN0YXRzXCJdPjtcbiAgICBjb25maWc6IE9wdGltaXphdGlvbkNvbmZpZztcbiAgICBvcHRpbWl6YXRpb25IaXN0b3J5OiB0eXBlb2YgdGhpcy5vcHRpbWl6YXRpb25IaXN0b3J5O1xuICB9IHtcbiAgICByZXR1cm4ge1xuICAgICAgYmFuZGl0U3RhdHM6IHRoaXMuYmFuZGl0LmdldFN0YXRzKCksXG4gICAgICBjb25maWc6IHRoaXMuY29uZmlnLFxuICAgICAgb3B0aW1pemF0aW9uSGlzdG9yeTogdGhpcy5vcHRpbWl6YXRpb25IaXN0b3J5LFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IGJhbmRpdCBzdGF0aXN0aWNzXG4gICAqL1xuICBnZXRCYW5kaXRTdGF0cygpOiBSZXR1cm5UeXBlPFRob21wc29uQmFuZGl0W1wiZ2V0U3RhdHNcIl0+IHtcbiAgICByZXR1cm4gdGhpcy5iYW5kaXQuZ2V0U3RhdHMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIZWFsdGggY2hlY2sgZm9yIHRoZSBvcHRpbWl6ZXJcbiAgICovXG4gIGhlYWx0aENoZWNrKCk6IHtcbiAgICBzdGF0dXM6IFwiaGVhbHRoeVwiIHwgXCJ3YXJuaW5nXCIgfCBcImVycm9yXCI7XG4gICAgdG90YWxUcmlhbHM6IG51bWJlcjtcbiAgICBhY3RpdmVDb250ZXh0czogbnVtYmVyO1xuICAgIGF1dG9PcHRpbWl6YXRpb25FbmFibGVkOiBib29sZWFuO1xuICAgIGxhc3RPcHRpbWl6YXRpb24/OiBEYXRlO1xuICAgIHJlY29tbWVuZGF0aW9uczogbnVtYmVyO1xuICB9IHtcbiAgICBjb25zdCBnbG9iYWxTdGF0cyA9IHRoaXMuYmFuZGl0LmdldFN0YXRzKCk7XG4gICAgY29uc3QgdG90YWxUcmlhbHMgPSBPYmplY3QudmFsdWVzKGdsb2JhbFN0YXRzKS5yZWR1Y2UoXG4gICAgICAoc3VtLCBzdGF0KSA9PiBzdW0gKyBzdGF0LnRyaWFscyxcbiAgICAgIDBcbiAgICApO1xuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9ucyA9IHRoaXMuZ2V0T3B0aW1pemF0aW9uUmVjb21tZW5kYXRpb25zKCk7XG5cbiAgICBsZXQgc3RhdHVzOiBcImhlYWx0aHlcIiB8IFwid2FybmluZ1wiIHwgXCJlcnJvclwiID0gXCJoZWFsdGh5XCI7XG5cbiAgICBpZiAodG90YWxUcmlhbHMgPCAxMCkge1xuICAgICAgc3RhdHVzID0gXCJ3YXJuaW5nXCI7IC8vIE5vdCBlbm91Z2ggZGF0YVxuICAgIH1cblxuICAgIGNvbnN0IGhpZ2hQcmlvcml0eUlzc3VlcyA9IHJlY29tbWVuZGF0aW9ucy5maWx0ZXIoXG4gICAgICAocikgPT4gci5wcmlvcml0eSA9PT0gXCJoaWdoXCJcbiAgICApO1xuICAgIGlmIChoaWdoUHJpb3JpdHlJc3N1ZXMubGVuZ3RoID4gMCkge1xuICAgICAgc3RhdHVzID0gXCJ3YXJuaW5nXCI7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXR1cyxcbiAgICAgIHRvdGFsVHJpYWxzLFxuICAgICAgYWN0aXZlQ29udGV4dHM6IHRoaXMuZ2V0VW5pcXVlQ29udGV4dHMoKS5sZW5ndGgsXG4gICAgICBhdXRvT3B0aW1pemF0aW9uRW5hYmxlZDogdGhpcy5jb25maWcuYXV0b09wdGltaXphdGlvbkVuYWJsZWQsXG4gICAgICBsYXN0T3B0aW1pemF0aW9uOlxuICAgICAgICB0aGlzLm9wdGltaXphdGlvbkhpc3RvcnlbdGhpcy5vcHRpbWl6YXRpb25IaXN0b3J5Lmxlbmd0aCAtIDFdXG4gICAgICAgICAgPy50aW1lc3RhbXAsXG4gICAgICByZWNvbW1lbmRhdGlvbnM6IHJlY29tbWVuZGF0aW9ucy5sZW5ndGgsXG4gICAgfTtcbiAgfVxufVxuXG4vLyBVdGlsaXR5IGZ1bmN0aW9ucyBmb3IgYmFuZGl0IG9wdGltaXphdGlvblxuZXhwb3J0IGNvbnN0IEJhbmRpdFV0aWxzID0ge1xuICAvKipcbiAgICogQ2FsY3VsYXRlIHN0YXRpc3RpY2FsIHNpZ25pZmljYW5jZSBiZXR3ZWVuIHR3byBhcm1zXG4gICAqL1xuICBjYWxjdWxhdGVTaWduaWZpY2FuY2UoXG4gICAgYXJtMTogeyB3aW5zOiBudW1iZXI7IHRyaWFsczogbnVtYmVyIH0sXG4gICAgYXJtMjogeyB3aW5zOiBudW1iZXI7IHRyaWFsczogbnVtYmVyIH1cbiAgKToge1xuICAgIHNpZ25pZmljYW50OiBib29sZWFuO1xuICAgIHBWYWx1ZTogbnVtYmVyO1xuICAgIGNvbmZpZGVuY2VJbnRlcnZhbDogW251bWJlciwgbnVtYmVyXTtcbiAgfSB7XG4gICAgaWYgKGFybTEudHJpYWxzID09PSAwIHx8IGFybTIudHJpYWxzID09PSAwKSB7XG4gICAgICByZXR1cm4geyBzaWduaWZpY2FudDogZmFsc2UsIHBWYWx1ZTogMSwgY29uZmlkZW5jZUludGVydmFsOiBbMCwgMV0gfTtcbiAgICB9XG5cbiAgICBjb25zdCBwMSA9IGFybTEud2lucyAvIGFybTEudHJpYWxzO1xuICAgIGNvbnN0IHAyID0gYXJtMi53aW5zIC8gYXJtMi50cmlhbHM7XG4gICAgY29uc3QgZGlmZiA9IHAxIC0gcDI7XG5cbiAgICAvLyBTaW1wbGUgei10ZXN0IGFwcHJveGltYXRpb25cbiAgICBjb25zdCBzZSA9IE1hdGguc3FydChcbiAgICAgIChwMSAqICgxIC0gcDEpKSAvIGFybTEudHJpYWxzICsgKHAyICogKDEgLSBwMikpIC8gYXJtMi50cmlhbHNcbiAgICApO1xuXG4gICAgY29uc3QgeiA9IE1hdGguYWJzKGRpZmYpIC8gc2U7XG4gICAgY29uc3QgcFZhbHVlID0gMiAqICgxIC0gdGhpcy5ub3JtYWxDREYoeikpOyAvLyBUd28tdGFpbGVkIHRlc3RcblxuICAgIGNvbnN0IG1hcmdpbiA9IDEuOTYgKiBzZTsgLy8gOTUlIGNvbmZpZGVuY2UgaW50ZXJ2YWxcbiAgICBjb25zdCBjb25maWRlbmNlSW50ZXJ2YWw6IFtudW1iZXIsIG51bWJlcl0gPSBbZGlmZiAtIG1hcmdpbiwgZGlmZiArIG1hcmdpbl07XG5cbiAgICByZXR1cm4ge1xuICAgICAgc2lnbmlmaWNhbnQ6IHBWYWx1ZSA8IDAuMDUsXG4gICAgICBwVmFsdWUsXG4gICAgICBjb25maWRlbmNlSW50ZXJ2YWwsXG4gICAgfTtcbiAgfSxcblxuICAvKipcbiAgICogTm9ybWFsIENERiBhcHByb3hpbWF0aW9uXG4gICAqL1xuICBub3JtYWxDREYoeDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICByZXR1cm4gMC41ICogKDEgKyB0aGlzLmVyZih4IC8gTWF0aC5zcXJ0KDIpKSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEVycm9yIGZ1bmN0aW9uIGFwcHJveGltYXRpb25cbiAgICovXG4gIGVyZih4OiBudW1iZXIpOiBudW1iZXIge1xuICAgIC8vIEFicmFtb3dpdHogYW5kIFN0ZWd1biBhcHByb3hpbWF0aW9uXG4gICAgY29uc3QgYTEgPSAwLjI1NDgyOTU5MjtcbiAgICBjb25zdCBhMiA9IC0wLjI4NDQ5NjczNjtcbiAgICBjb25zdCBhMyA9IDEuNDIxNDEzNzQxO1xuICAgIGNvbnN0IGE0ID0gLTEuNDUzMTUyMDI3O1xuICAgIGNvbnN0IGE1ID0gMS4wNjE0MDU0Mjk7XG4gICAgY29uc3QgcCA9IDAuMzI3NTkxMTtcblxuICAgIGNvbnN0IHNpZ24gPSB4ID49IDAgPyAxIDogLTE7XG4gICAgeCA9IE1hdGguYWJzKHgpO1xuXG4gICAgY29uc3QgdCA9IDEuMCAvICgxLjAgKyBwICogeCk7XG4gICAgY29uc3QgeSA9XG4gICAgICAxLjAgLVxuICAgICAgKCgoKGE1ICogdCArIGE0KSAqIHQgKyBhMykgKiB0ICsgYTIpICogdCArIGExKSAqIHQgKiBNYXRoLmV4cCgteCAqIHgpO1xuXG4gICAgcmV0dXJuIHNpZ24gKiB5O1xuICB9LFxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgZXhwZWN0ZWQgcmVncmV0IGZvciBhbiBhcm0gc2VsZWN0aW9uIHN0cmF0ZWd5XG4gICAqL1xuICBjYWxjdWxhdGVSZWdyZXQoXG4gICAgdHJ1ZVJld2FyZHM6IFJlY29yZDxBcm0sIG51bWJlcj4sXG4gICAgc2VsZWN0aW9uczogQXJyYXk8eyBhcm06IEFybTsgcmV3YXJkOiBudW1iZXIgfT5cbiAgKTogbnVtYmVyIHtcbiAgICBjb25zdCBvcHRpbWFsUmV3YXJkID0gTWF0aC5tYXgoLi4uT2JqZWN0LnZhbHVlcyh0cnVlUmV3YXJkcykpO1xuICAgIGxldCB0b3RhbFJlZ3JldCA9IDA7XG5cbiAgICBzZWxlY3Rpb25zLmZvckVhY2goKHNlbGVjdGlvbikgPT4ge1xuICAgICAgY29uc3QgcmVncmV0ID0gb3B0aW1hbFJld2FyZCAtIHRydWVSZXdhcmRzW3NlbGVjdGlvbi5hcm1dO1xuICAgICAgdG90YWxSZWdyZXQgKz0gcmVncmV0O1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRvdGFsUmVncmV0IC8gc2VsZWN0aW9ucy5sZW5ndGg7IC8vIEF2ZXJhZ2UgcmVncmV0XG4gIH0sXG59O1xuIl0sInZlcnNpb24iOjN9