4aad12593b8c63480fa0192fc7e28d8c
"use strict";
/**
 * ðŸŒ‰ Funktionierende Tests fÃ¼r Hybrid Assistant Orchestrator
 * Verwendet die pragmatische BrÃ¼cken-LÃ¶sung
 */
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
jest.mock("../ai-feature-flags", () => ({
    AiFeatureFlags: jest.fn().mockImplementation(() => mockFeatureFlags),
}));
// Mock the AiFeatureFlags BEFORE any imports
const mockFeatureFlags = {
    isHybridAssistantModeEnabled: jest.fn(() => true),
    isBedrockAdvisoryModeEnabled: jest.fn(() => true),
    isKiroPrimaryControlEnabled: jest.fn(() => true),
    getFlag: jest.fn((flag, defaultValue) => defaultValue),
    isEnabled: jest.fn((flag, defaultValue) => defaultValue),
};
const hybrid_assistant_orchestrator_cjs_1 = require("../hybrid-assistant-orchestrator.cjs");
describe("HybridAssistantOrchestrator (Fixed)", () => {
    let orchestrator;
    beforeEach(() => {
        // Reset mocks
        jest.clearAllMocks();
        orchestrator = new hybrid_assistant_orchestrator_cjs_1.HybridAssistantOrchestrator();
    });
    describe("Hybrid Assistant Mode Status", () => {
        it("should report hybrid mode as active", () => {
            const status = orchestrator.getHybridAssistantStatus();
            expect(status.hybridModeActive).toBe(true);
            expect(status.bedrockAdvisoryActive).toBe(true);
            expect(status.kiroPrimaryControl).toBe(true);
            expect(status.capabilities).toContain("ðŸŽ¯ User behÃ¤lt volle Kontrolle");
        });
    });
    describe("Task Processing Workflow", () => {
        it("should process a simple task request", () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const request = {
                id: "test-task-1",
                description: "Implement TypeScript exactOptionalPropertyTypes compliance",
                priority: "medium",
                requester: "user",
            };
            const result = yield orchestrator.processTaskRequest(request);
            expect(result.taskId).toBe("test-task-1");
            expect(result.status).toBe("completed");
            expect(result.bedrockAdvice).toBeDefined();
            expect(result.kiroImplementation).toBeDefined();
            expect(result.finalResult).toBeDefined();
            expect(result.qualityScore).toBeGreaterThan(0);
        }));
        it("should require user approval for critical tasks", () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const criticalRequest = {
                id: "critical-task-1",
                description: "Delete production database",
                priority: "critical",
                requester: "user",
            };
            const result = yield orchestrator.processTaskRequest(criticalRequest);
            expect(result.status).toBe("reviewing");
            expect(result.userApprovalRequired).toBe(true);
        }));
        it("should require user approval for dangerous operations", () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const dangerousRequest = {
                id: "dangerous-task-1",
                description: "Remove all user data",
                priority: "medium",
                requester: "user",
            };
            const result = yield orchestrator.processTaskRequest(dangerousRequest);
            expect(result.status).toBe("reviewing");
            expect(result.userApprovalRequired).toBe(true);
        }));
    });
    describe("Bedrock Advisory Integration", () => {
        it("should provide bedrock advice for tasks", () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const request = {
                id: "advice-test",
                description: "Optimize database queries",
                priority: "medium",
                requester: "user",
            };
            const result = yield orchestrator.processTaskRequest(request);
            expect(result.bedrockAdvice).toBeDefined();
            expect(result.bedrockAdvice.analysis).toContain("Machbar mit moderatem Aufwand");
            expect(result.bedrockAdvice.recommendations).toHaveLength(3);
            expect(result.bedrockAdvice.risks).toHaveLength(2);
            expect(result.bedrockAdvice.qualityChecks).toHaveLength(4);
        }));
    });
    describe("Kiro Implementation Planning", () => {
        it("should create implementation plan", () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const request = {
                id: "implementation-test",
                description: "Add new feature",
                priority: "low",
                requester: "user",
            };
            const result = yield orchestrator.processTaskRequest(request);
            expect(result.kiroImplementation).toBeDefined();
            expect(result.kiroImplementation.steps.length).toBeGreaterThan(5);
            expect(result.kiroImplementation.testingStrategy).toContain("Unit Tests");
            expect(result.kiroImplementation.rollbackPlan).toContain("Git revert");
        }));
    });
    describe("Quality Assurance", () => {
        it("should perform quality checks", () => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
            const request = {
                id: "quality-test",
                description: "Refactor legacy code",
                priority: "medium",
                requester: "user",
            };
            const result = yield orchestrator.processTaskRequest(request);
            expect(result.qualityScore).toBeDefined();
            expect(result.qualityScore).toBeGreaterThanOrEqual(0);
            expect(result.qualityScore).toBeLessThanOrEqual(100);
        }));
    });
    describe("Workflow Management", () => {
        it("should track active workflows", () => {
            const initialStatus = orchestrator.getHybridAssistantStatus();
            expect(initialStatus.activeWorkflows).toBe(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hdGJha2gtdmlzaWJpbGl0eS1ib29zdC4yMDI1MDkyMC9zcmMvbGliL2FpLW9yY2hlc3RyYXRvci9fX3Rlc3RzX18vaHlicmlkLWFzc2lzdGFudC1vcmNoZXN0cmF0b3ItZml4ZWQudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOzs7QUFXSCxJQUFJLENBQUMsSUFBSSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDdEMsY0FBYyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQztDQUNyRSxDQUFDLENBQUMsQ0FBQztBQVhKLDZDQUE2QztBQUM3QyxNQUFNLGdCQUFnQixHQUFHO0lBQ3ZCLDRCQUE0QixFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDO0lBQ2pELDRCQUE0QixFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDO0lBQ2pELDJCQUEyQixFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDO0lBQ2hELE9BQU8sRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBWSxFQUFFLFlBQXFCLEVBQUUsRUFBRSxDQUFDLFlBQVksQ0FBQztJQUN2RSxTQUFTLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQVksRUFBRSxZQUFxQixFQUFFLEVBQUUsQ0FBQyxZQUFZLENBQUM7Q0FDMUUsQ0FBQztBQVFGLDRGQUFtRjtBQUVuRixRQUFRLENBQUMscUNBQXFDLEVBQUUsR0FBRyxFQUFFO0lBQ25ELElBQUksWUFBeUMsQ0FBQztJQUU5QyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsY0FBYztRQUNkLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUNyQixZQUFZLEdBQUcsSUFBSSwrREFBMkIsRUFBRSxDQUFDO0lBQ25ELENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLDhCQUE4QixFQUFFLEdBQUcsRUFBRTtRQUM1QyxFQUFFLENBQUMscUNBQXFDLEVBQUUsR0FBRyxFQUFFO1lBQzdDLE1BQU0sTUFBTSxHQUFHLFlBQVksQ0FBQyx3QkFBd0IsRUFBRSxDQUFDO1lBRXZELE1BQU0sQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDM0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNoRCxNQUFNLENBQUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzdDLE1BQU0sQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsU0FBUyxDQUFDLGdDQUFnQyxDQUFDLENBQUM7UUFDMUUsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQywwQkFBMEIsRUFBRSxHQUFHLEVBQUU7UUFDeEMsRUFBRSxDQUFDLHNDQUFzQyxFQUFFLEdBQVMsRUFBRTtZQUNwRCxNQUFNLE9BQU8sR0FBZ0I7Z0JBQzNCLEVBQUUsRUFBRSxhQUFhO2dCQUNqQixXQUFXLEVBQ1QsNERBQTREO2dCQUM5RCxRQUFRLEVBQUUsUUFBUTtnQkFDbEIsU0FBUyxFQUFFLE1BQU07YUFDbEIsQ0FBQztZQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sWUFBWSxDQUFDLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRTlELE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQzFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3hDLE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDM0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ2hELE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDekMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDakQsQ0FBQyxDQUFBLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxpREFBaUQsRUFBRSxHQUFTLEVBQUU7WUFDL0QsTUFBTSxlQUFlLEdBQWdCO2dCQUNuQyxFQUFFLEVBQUUsaUJBQWlCO2dCQUNyQixXQUFXLEVBQUUsNEJBQTRCO2dCQUN6QyxRQUFRLEVBQUUsVUFBVTtnQkFDcEIsU0FBUyxFQUFFLE1BQU07YUFDbEIsQ0FBQztZQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sWUFBWSxDQUFDLGtCQUFrQixDQUFDLGVBQWUsQ0FBQyxDQUFDO1lBRXRFLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3hDLE1BQU0sQ0FBQyxNQUFNLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDakQsQ0FBQyxDQUFBLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx1REFBdUQsRUFBRSxHQUFTLEVBQUU7WUFDckUsTUFBTSxnQkFBZ0IsR0FBZ0I7Z0JBQ3BDLEVBQUUsRUFBRSxrQkFBa0I7Z0JBQ3RCLFdBQVcsRUFBRSxzQkFBc0I7Z0JBQ25DLFFBQVEsRUFBRSxRQUFRO2dCQUNsQixTQUFTLEVBQUUsTUFBTTthQUNsQixDQUFDO1lBRUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxZQUFZLENBQUMsa0JBQWtCLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztZQUV2RSxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUN4QyxNQUFNLENBQUMsTUFBTSxDQUFDLG9CQUFvQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2pELENBQUMsQ0FBQSxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyw4QkFBOEIsRUFBRSxHQUFHLEVBQUU7UUFDNUMsRUFBRSxDQUFDLHlDQUF5QyxFQUFFLEdBQVMsRUFBRTtZQUN2RCxNQUFNLE9BQU8sR0FBZ0I7Z0JBQzNCLEVBQUUsRUFBRSxhQUFhO2dCQUNqQixXQUFXLEVBQUUsMkJBQTJCO2dCQUN4QyxRQUFRLEVBQUUsUUFBUTtnQkFDbEIsU0FBUyxFQUFFLE1BQU07YUFDbEIsQ0FBQztZQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sWUFBWSxDQUFDLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRTlELE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDM0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFjLENBQUMsUUFBUSxDQUFDLENBQUMsU0FBUyxDQUM5QywrQkFBK0IsQ0FDaEMsQ0FBQztZQUNGLE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYyxDQUFDLGVBQWUsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM5RCxNQUFNLENBQUMsTUFBTSxDQUFDLGFBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFjLENBQUMsYUFBYSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzlELENBQUMsQ0FBQSxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyw4QkFBOEIsRUFBRSxHQUFHLEVBQUU7UUFDNUMsRUFBRSxDQUFDLG1DQUFtQyxFQUFFLEdBQVMsRUFBRTtZQUNqRCxNQUFNLE9BQU8sR0FBZ0I7Z0JBQzNCLEVBQUUsRUFBRSxxQkFBcUI7Z0JBQ3pCLFdBQVcsRUFBRSxpQkFBaUI7Z0JBQzlCLFFBQVEsRUFBRSxLQUFLO2dCQUNmLFNBQVMsRUFBRSxNQUFNO2FBQ2xCLENBQUM7WUFFRixNQUFNLE1BQU0sR0FBRyxNQUFNLFlBQVksQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUU5RCxNQUFNLENBQUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDaEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxrQkFBbUIsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ25FLE1BQU0sQ0FBQyxNQUFNLENBQUMsa0JBQW1CLENBQUMsZUFBZSxDQUFDLENBQUMsU0FBUyxDQUMxRCxZQUFZLENBQ2IsQ0FBQztZQUNGLE1BQU0sQ0FBQyxNQUFNLENBQUMsa0JBQW1CLENBQUMsWUFBWSxDQUFDLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQzFFLENBQUMsQ0FBQSxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7UUFDakMsRUFBRSxDQUFDLCtCQUErQixFQUFFLEdBQVMsRUFBRTtZQUM3QyxNQUFNLE9BQU8sR0FBZ0I7Z0JBQzNCLEVBQUUsRUFBRSxjQUFjO2dCQUNsQixXQUFXLEVBQUUsc0JBQXNCO2dCQUNuQyxRQUFRLEVBQUUsUUFBUTtnQkFDbEIsU0FBUyxFQUFFLE1BQU07YUFDbEIsQ0FBQztZQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sWUFBWSxDQUFDLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRTlELE1BQU0sQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDMUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN0RCxNQUFNLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3ZELENBQUMsQ0FBQSxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7UUFDbkMsRUFBRSxDQUFDLCtCQUErQixFQUFFLEdBQUcsRUFBRTtZQUN2QyxNQUFNLGFBQWEsR0FBRyxZQUFZLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztZQUM5RCxNQUFNLENBQUMsYUFBYSxDQUFDLGVBQWUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNoRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL21hdGJha2gtdmlzaWJpbGl0eS1ib29zdC4yMDI1MDkyMC9zcmMvbGliL2FpLW9yY2hlc3RyYXRvci9fX3Rlc3RzX18vaHlicmlkLWFzc2lzdGFudC1vcmNoZXN0cmF0b3ItZml4ZWQudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIPCfjIkgRnVua3Rpb25pZXJlbmRlIFRlc3RzIGbDvHIgSHlicmlkIEFzc2lzdGFudCBPcmNoZXN0cmF0b3JcbiAqIFZlcndlbmRldCBkaWUgcHJhZ21hdGlzY2hlIEJyw7xja2VuLUzDtnN1bmdcbiAqL1xuXG4vLyBNb2NrIHRoZSBBaUZlYXR1cmVGbGFncyBCRUZPUkUgYW55IGltcG9ydHNcbmNvbnN0IG1vY2tGZWF0dXJlRmxhZ3MgPSB7XG4gIGlzSHlicmlkQXNzaXN0YW50TW9kZUVuYWJsZWQ6IGplc3QuZm4oKCkgPT4gdHJ1ZSksXG4gIGlzQmVkcm9ja0Fkdmlzb3J5TW9kZUVuYWJsZWQ6IGplc3QuZm4oKCkgPT4gdHJ1ZSksXG4gIGlzS2lyb1ByaW1hcnlDb250cm9sRW5hYmxlZDogamVzdC5mbigoKSA9PiB0cnVlKSxcbiAgZ2V0RmxhZzogamVzdC5mbigoZmxhZzogc3RyaW5nLCBkZWZhdWx0VmFsdWU6IGJvb2xlYW4pID0+IGRlZmF1bHRWYWx1ZSksXG4gIGlzRW5hYmxlZDogamVzdC5mbigoZmxhZzogc3RyaW5nLCBkZWZhdWx0VmFsdWU6IGJvb2xlYW4pID0+IGRlZmF1bHRWYWx1ZSksXG59O1xuXG5qZXN0Lm1vY2soXCIuLi9haS1mZWF0dXJlLWZsYWdzXCIsICgpID0+ICh7XG4gIEFpRmVhdHVyZUZsYWdzOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IG1vY2tGZWF0dXJlRmxhZ3MpLFxufSkpO1xuXG4vLyBJbXBvcnQgYWZ0ZXIgbW9ja2luZ1xuaW1wb3J0IHR5cGUgeyBUYXNrUmVxdWVzdCB9IGZyb20gXCIuLi9oeWJyaWQtYXNzaXN0YW50LW9yY2hlc3RyYXRvclwiO1xuaW1wb3J0IHsgSHlicmlkQXNzaXN0YW50T3JjaGVzdHJhdG9yIH0gZnJvbSBcIi4uL2h5YnJpZC1hc3Npc3RhbnQtb3JjaGVzdHJhdG9yLmNqc1wiO1xuXG5kZXNjcmliZShcIkh5YnJpZEFzc2lzdGFudE9yY2hlc3RyYXRvciAoRml4ZWQpXCIsICgpID0+IHtcbiAgbGV0IG9yY2hlc3RyYXRvcjogSHlicmlkQXNzaXN0YW50T3JjaGVzdHJhdG9yO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIC8vIFJlc2V0IG1vY2tzXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgb3JjaGVzdHJhdG9yID0gbmV3IEh5YnJpZEFzc2lzdGFudE9yY2hlc3RyYXRvcigpO1xuICB9KTtcblxuICBkZXNjcmliZShcIkh5YnJpZCBBc3Npc3RhbnQgTW9kZSBTdGF0dXNcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHJlcG9ydCBoeWJyaWQgbW9kZSBhcyBhY3RpdmVcIiwgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhdHVzID0gb3JjaGVzdHJhdG9yLmdldEh5YnJpZEFzc2lzdGFudFN0YXR1cygpO1xuXG4gICAgICBleHBlY3Qoc3RhdHVzLmh5YnJpZE1vZGVBY3RpdmUpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3Qoc3RhdHVzLmJlZHJvY2tBZHZpc29yeUFjdGl2ZSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChzdGF0dXMua2lyb1ByaW1hcnlDb250cm9sKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHN0YXR1cy5jYXBhYmlsaXRpZXMpLnRvQ29udGFpbihcIvCfjq8gVXNlciBiZWjDpGx0IHZvbGxlIEtvbnRyb2xsZVwiKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJUYXNrIFByb2Nlc3NpbmcgV29ya2Zsb3dcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHByb2Nlc3MgYSBzaW1wbGUgdGFzayByZXF1ZXN0XCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlcXVlc3Q6IFRhc2tSZXF1ZXN0ID0ge1xuICAgICAgICBpZDogXCJ0ZXN0LXRhc2stMVwiLFxuICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICBcIkltcGxlbWVudCBUeXBlU2NyaXB0IGV4YWN0T3B0aW9uYWxQcm9wZXJ0eVR5cGVzIGNvbXBsaWFuY2VcIixcbiAgICAgICAgcHJpb3JpdHk6IFwibWVkaXVtXCIsXG4gICAgICAgIHJlcXVlc3RlcjogXCJ1c2VyXCIsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBvcmNoZXN0cmF0b3IucHJvY2Vzc1Rhc2tSZXF1ZXN0KHJlcXVlc3QpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnRhc2tJZCkudG9CZShcInRlc3QtdGFzay0xXCIpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoXCJjb21wbGV0ZWRcIik7XG4gICAgICBleHBlY3QocmVzdWx0LmJlZHJvY2tBZHZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0Lmtpcm9JbXBsZW1lbnRhdGlvbikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZmluYWxSZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LnF1YWxpdHlTY29yZSkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgcmVxdWlyZSB1c2VyIGFwcHJvdmFsIGZvciBjcml0aWNhbCB0YXNrc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjcml0aWNhbFJlcXVlc3Q6IFRhc2tSZXF1ZXN0ID0ge1xuICAgICAgICBpZDogXCJjcml0aWNhbC10YXNrLTFcIixcbiAgICAgICAgZGVzY3JpcHRpb246IFwiRGVsZXRlIHByb2R1Y3Rpb24gZGF0YWJhc2VcIixcbiAgICAgICAgcHJpb3JpdHk6IFwiY3JpdGljYWxcIixcbiAgICAgICAgcmVxdWVzdGVyOiBcInVzZXJcIixcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9yY2hlc3RyYXRvci5wcm9jZXNzVGFza1JlcXVlc3QoY3JpdGljYWxSZXF1ZXN0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoXCJyZXZpZXdpbmdcIik7XG4gICAgICBleHBlY3QocmVzdWx0LnVzZXJBcHByb3ZhbFJlcXVpcmVkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgcmVxdWlyZSB1c2VyIGFwcHJvdmFsIGZvciBkYW5nZXJvdXMgb3BlcmF0aW9uc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYW5nZXJvdXNSZXF1ZXN0OiBUYXNrUmVxdWVzdCA9IHtcbiAgICAgICAgaWQ6IFwiZGFuZ2Vyb3VzLXRhc2stMVwiLFxuICAgICAgICBkZXNjcmlwdGlvbjogXCJSZW1vdmUgYWxsIHVzZXIgZGF0YVwiLFxuICAgICAgICBwcmlvcml0eTogXCJtZWRpdW1cIixcbiAgICAgICAgcmVxdWVzdGVyOiBcInVzZXJcIixcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9yY2hlc3RyYXRvci5wcm9jZXNzVGFza1JlcXVlc3QoZGFuZ2Vyb3VzUmVxdWVzdCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKFwicmV2aWV3aW5nXCIpO1xuICAgICAgZXhwZWN0KHJlc3VsdC51c2VyQXBwcm92YWxSZXF1aXJlZCkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJCZWRyb2NrIEFkdmlzb3J5IEludGVncmF0aW9uXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCBwcm92aWRlIGJlZHJvY2sgYWR2aWNlIGZvciB0YXNrc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXF1ZXN0OiBUYXNrUmVxdWVzdCA9IHtcbiAgICAgICAgaWQ6IFwiYWR2aWNlLXRlc3RcIixcbiAgICAgICAgZGVzY3JpcHRpb246IFwiT3B0aW1pemUgZGF0YWJhc2UgcXVlcmllc1wiLFxuICAgICAgICBwcmlvcml0eTogXCJtZWRpdW1cIixcbiAgICAgICAgcmVxdWVzdGVyOiBcInVzZXJcIixcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9yY2hlc3RyYXRvci5wcm9jZXNzVGFza1JlcXVlc3QocmVxdWVzdCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuYmVkcm9ja0FkdmljZSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYmVkcm9ja0FkdmljZSEuYW5hbHlzaXMpLnRvQ29udGFpbihcbiAgICAgICAgXCJNYWNoYmFyIG1pdCBtb2RlcmF0ZW0gQXVmd2FuZFwiXG4gICAgICApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5iZWRyb2NrQWR2aWNlIS5yZWNvbW1lbmRhdGlvbnMpLnRvSGF2ZUxlbmd0aCgzKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYmVkcm9ja0FkdmljZSEucmlza3MpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYmVkcm9ja0FkdmljZSEucXVhbGl0eUNoZWNrcykudG9IYXZlTGVuZ3RoKDQpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIktpcm8gSW1wbGVtZW50YXRpb24gUGxhbm5pbmdcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIGNyZWF0ZSBpbXBsZW1lbnRhdGlvbiBwbGFuXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlcXVlc3Q6IFRhc2tSZXF1ZXN0ID0ge1xuICAgICAgICBpZDogXCJpbXBsZW1lbnRhdGlvbi10ZXN0XCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIkFkZCBuZXcgZmVhdHVyZVwiLFxuICAgICAgICBwcmlvcml0eTogXCJsb3dcIixcbiAgICAgICAgcmVxdWVzdGVyOiBcInVzZXJcIixcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9yY2hlc3RyYXRvci5wcm9jZXNzVGFza1JlcXVlc3QocmVxdWVzdCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQua2lyb0ltcGxlbWVudGF0aW9uKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5raXJvSW1wbGVtZW50YXRpb24hLnN0ZXBzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5raXJvSW1wbGVtZW50YXRpb24hLnRlc3RpbmdTdHJhdGVneSkudG9Db250YWluKFxuICAgICAgICBcIlVuaXQgVGVzdHNcIlxuICAgICAgKTtcbiAgICAgIGV4cGVjdChyZXN1bHQua2lyb0ltcGxlbWVudGF0aW9uIS5yb2xsYmFja1BsYW4pLnRvQ29udGFpbihcIkdpdCByZXZlcnRcIik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiUXVhbGl0eSBBc3N1cmFuY2VcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHBlcmZvcm0gcXVhbGl0eSBjaGVja3NcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVxdWVzdDogVGFza1JlcXVlc3QgPSB7XG4gICAgICAgIGlkOiBcInF1YWxpdHktdGVzdFwiLFxuICAgICAgICBkZXNjcmlwdGlvbjogXCJSZWZhY3RvciBsZWdhY3kgY29kZVwiLFxuICAgICAgICBwcmlvcml0eTogXCJtZWRpdW1cIixcbiAgICAgICAgcmVxdWVzdGVyOiBcInVzZXJcIixcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9yY2hlc3RyYXRvci5wcm9jZXNzVGFza1JlcXVlc3QocmVxdWVzdCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucXVhbGl0eVNjb3JlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5xdWFsaXR5U2NvcmUpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XG4gICAgICBleHBlY3QocmVzdWx0LnF1YWxpdHlTY29yZSkudG9CZUxlc3NUaGFuT3JFcXVhbCgxMDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIldvcmtmbG93IE1hbmFnZW1lbnRcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHRyYWNrIGFjdGl2ZSB3b3JrZmxvd3NcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgaW5pdGlhbFN0YXR1cyA9IG9yY2hlc3RyYXRvci5nZXRIeWJyaWRBc3Npc3RhbnRTdGF0dXMoKTtcbiAgICAgIGV4cGVjdChpbml0aWFsU3RhdHVzLmFjdGl2ZVdvcmtmbG93cykudG9CZSgwKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==