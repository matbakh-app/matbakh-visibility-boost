d34e32b0bddbb693b918864942794699
"use strict";
/**
 * Tests for Hybrid Assistant Orchestrator
 */
Object.defineProperty(exports, "__esModule", { value: true });
const hybrid_assistant_orchestrator_1 = require("../hybrid-assistant-orchestrator");
describe("HybridAssistantOrchestrator", () => {
    let orchestrator;
    beforeEach(() => {
        orchestrator = new hybrid_assistant_orchestrator_1.HybridAssistantOrchestrator();
    });
    describe("Hybrid Assistant Mode Status", () => {
        it("should report hybrid mode as active", () => {
            const status = orchestrator.getHybridAssistantStatus();
            expect(status.hybridModeActive).toBe(true);
            expect(status.bedrockAdvisoryActive).toBe(true);
            expect(status.kiroPrimaryControl).toBe(true);
            expect(status.capabilities).toContain("üéØ User beh√§lt volle Kontrolle");
        });
    });
    describe("Task Processing Workflow", () => {
        it("should process a simple task request", async () => {
            const request = {
                id: "test-task-1",
                description: "Implement TypeScript exactOptionalPropertyTypes compliance",
                priority: "medium",
                requester: "user",
            };
            const result = await orchestrator.processTaskRequest(request);
            expect(result.taskId).toBe("test-task-1");
            expect(result.status).toBe("completed");
            expect(result.bedrockAdvice).toBeDefined();
            expect(result.kiroImplementation).toBeDefined();
            expect(result.finalResult).toBeDefined();
            expect(result.qualityScore).toBeGreaterThan(0);
        });
        it("should require user approval for critical tasks", async () => {
            const criticalRequest = {
                id: "critical-task-1",
                description: "Delete production database",
                priority: "critical",
                requester: "user",
            };
            const result = await orchestrator.processTaskRequest(criticalRequest);
            expect(result.status).toBe("reviewing");
            expect(result.userApprovalRequired).toBe(true);
        });
        it("should require user approval for dangerous operations", async () => {
            const dangerousRequest = {
                id: "dangerous-task-1",
                description: "Remove all user data",
                priority: "medium",
                requester: "user",
            };
            const result = await orchestrator.processTaskRequest(dangerousRequest);
            expect(result.status).toBe("reviewing");
            expect(result.userApprovalRequired).toBe(true);
        });
    });
    describe("User Approval Process", () => {
        it("should handle user approval correctly", async () => {
            const request = {
                id: "approval-test",
                description: "Delete old files",
                priority: "high",
                requester: "user",
            };
            // Erstelle Workflow der Approval ben√∂tigt
            const initialResult = await orchestrator.processTaskRequest(request);
            expect(initialResult.userApprovalRequired).toBe(true);
            // Simuliere User Approval
            const workflowId = `workflow-${request.id}-${Date.now()}`;
            // Note: In real implementation, we'd get the actual workflow ID
            // F√ºr den Test nehmen wir an, dass der Workflow existiert
            // In der echten Implementierung w√ºrde der Workflow ID zur√ºckgegeben
        });
        it("should handle user rejection correctly", async () => {
            // Test f√ºr User Rejection w√ºrde hier implementiert
            // F√ºr jetzt als Platzhalter
            expect(true).toBe(true);
        });
    });
    describe("Bedrock Advisory Integration", () => {
        it("should provide bedrock advice for tasks", async () => {
            const request = {
                id: "advice-test",
                description: "Optimize database queries",
                priority: "medium",
                requester: "user",
            };
            const result = await orchestrator.processTaskRequest(request);
            expect(result.bedrockAdvice).toBeDefined();
            expect(result.bedrockAdvice.analysis).toContain("Machbar mit moderatem Aufwand");
            expect(result.bedrockAdvice.recommendations).toHaveLength(3);
            expect(result.bedrockAdvice.risks).toHaveLength(2);
            expect(result.bedrockAdvice.qualityChecks).toHaveLength(4);
        });
    });
    describe("Kiro Implementation Planning", () => {
        it("should create implementation plan", async () => {
            const request = {
                id: "implementation-test",
                description: "Add new feature",
                priority: "low",
                requester: "user",
            };
            const result = await orchestrator.processTaskRequest(request);
            expect(result.kiroImplementation).toBeDefined();
            expect(result.kiroImplementation.steps.length).toBeGreaterThan(5);
            expect(result.kiroImplementation.testingStrategy).toContain("Unit Tests");
            expect(result.kiroImplementation.rollbackPlan).toContain("Git revert");
        });
    });
    describe("Quality Assurance", () => {
        it("should perform quality checks", async () => {
            const request = {
                id: "quality-test",
                description: "Refactor legacy code",
                priority: "medium",
                requester: "user",
            };
            const result = await orchestrator.processTaskRequest(request);
            expect(result.qualityScore).toBeDefined();
            expect(result.qualityScore).toBeGreaterThanOrEqual(0);
            expect(result.qualityScore).toBeLessThanOrEqual(100);
        });
    });
    describe("Workflow Management", () => {
        it("should track active workflows", () => {
            const initialStatus = orchestrator.getHybridAssistantStatus();
            expect(initialStatus.activeWorkflows).toBe(0);
            // Nach dem Ausf√ºhren von Tasks w√ºrde sich die Anzahl √§ndern
            // F√ºr jetzt als Platzhalter
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hdGJha2gtdmlzaWJpbGl0eS1ib29zdC4yMDI1MDkyMC9zcmMvbGliL2FpLW9yY2hlc3RyYXRvci9fX3Rlc3RzX18vaHlicmlkLWFzc2lzdGFudC1vcmNoZXN0cmF0b3IudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7O0FBRUgsb0ZBRzBDO0FBRTFDLFFBQVEsQ0FBQyw2QkFBNkIsRUFBRSxHQUFHLEVBQUU7SUFDM0MsSUFBSSxZQUF5QyxDQUFDO0lBRTlDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxZQUFZLEdBQUcsSUFBSSwyREFBMkIsRUFBRSxDQUFDO0lBQ25ELENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLDhCQUE4QixFQUFFLEdBQUcsRUFBRTtRQUM1QyxFQUFFLENBQUMscUNBQXFDLEVBQUUsR0FBRyxFQUFFO1lBQzdDLE1BQU0sTUFBTSxHQUFHLFlBQVksQ0FBQyx3QkFBd0IsRUFBRSxDQUFDO1lBRXZELE1BQU0sQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDM0MsTUFBTSxDQUFDLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNoRCxNQUFNLENBQUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzdDLE1BQU0sQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsU0FBUyxDQUFDLGdDQUFnQyxDQUFDLENBQUM7UUFDMUUsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQywwQkFBMEIsRUFBRSxHQUFHLEVBQUU7UUFDeEMsRUFBRSxDQUFDLHNDQUFzQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3BELE1BQU0sT0FBTyxHQUFnQjtnQkFDM0IsRUFBRSxFQUFFLGFBQWE7Z0JBQ2pCLFdBQVcsRUFDVCw0REFBNEQ7Z0JBQzlELFFBQVEs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QUMsQ0FBQyxDQUFDO1lBQ3RELE1BQU0sQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDdkQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7UUFDbkMsRUFBRSxDQUFDLCtCQUErQixFQUFFLEdBQUcsRUFBRTtZQUN2QyxNQUFNLGFBQWEsR0FBRyxZQUFZLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztZQUM5RCxNQUFNLENBQUMsYUFBYSxDQUFDLGVBQWUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUU5Qyw0REFBNEQ7WUFDNUQsNEJBQTRCO1FBQzlCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvbWF0YmFraC12aXNpYmlsaXR5LWJvb3N0LjIwMjUwOTIwL3NyYy9saWIvYWktb3JjaGVzdHJhdG9yL19fdGVzdHNfXy9oeWJyaWQtYXNzaXN0YW50LW9yY2hlc3RyYXRvci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGVzdHMgZm9yIEh5YnJpZCBBc3Npc3RhbnQgT3JjaGVzdHJhdG9yXG4gKi9cblxuaW1wb3J0IHtcbiAgSHlicmlkQXNzaXN0YW50T3JjaGVzdHJhdG9yLFxuICB0eXBlIFRhc2tSZXF1ZXN0LFxufSBmcm9tIFwiLi4vaHlicmlkLWFzc2lzdGFudC1vcmNoZXN0cmF0b3JcIjtcblxuZGVzY3JpYmUoXCJIeWJyaWRBc3Npc3RhbnRPcmNoZXN0cmF0b3JcIiwgKCkgPT4ge1xuICBsZXQgb3JjaGVzdHJhdG9yOiBIeWJyaWRBc3Npc3RhbnRPcmNoZXN0cmF0b3I7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgb3JjaGVzdHJhdG9yID0gbmV3IEh5YnJpZEFzc2lzdGFudE9yY2hlc3RyYXRvcigpO1xuICB9KTtcblxuICBkZXNjcmliZShcIkh5YnJpZCBBc3Npc3RhbnQgTW9kZSBTdGF0dXNcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHJlcG9ydCBoeWJyaWQgbW9kZSBhcyBhY3RpdmVcIiwgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhdHVzID0gb3JjaGVzdHJhdG9yLmdldEh5YnJpZEFzc2lzdGFudFN0YXR1cygpO1xuXG4gICAgICBleHBlY3Qoc3RhdHVzLmh5YnJpZE1vZGVBY3RpdmUpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3Qoc3RhdHVzLmJlZHJvY2tBZHZpc29yeUFjdGl2ZSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChzdGF0dXMua2lyb1ByaW1hcnlDb250cm9sKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHN0YXR1cy5jYXBhYmlsaXRpZXMpLnRvQ29udGFpbihcIvCfjq8gVXNlciBiZWjDpGx0IHZvbGxlIEtvbnRyb2xsZVwiKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJUYXNrIFByb2Nlc3NpbmcgV29ya2Zsb3dcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHByb2Nlc3MgYSBzaW1wbGUgdGFzayByZXF1ZXN0XCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlcXVlc3Q6IFRhc2tSZXF1ZXN0ID0ge1xuICAgICAgICBpZDogXCJ0ZXN0LXRhc2stMVwiLFxuICAgICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgICBcIkltcGxlbWVudCBUeXBlU2NyaXB0IGV4YWN0T3B0aW9uYWxQcm9wZXJ0eVR5cGVzIGNvbXBsaWFuY2VcIixcbiAgICAgICAgcHJpb3JpdHk6IFwibWVkaXVtXCIsXG4gICAgICAgIHJlcXVlc3RlcjogXCJ1c2VyXCIsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBvcmNoZXN0cmF0b3IucHJvY2Vzc1Rhc2tSZXF1ZXN0KHJlcXVlc3QpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnRhc2tJZCkudG9CZShcInRlc3QtdGFzay0xXCIpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoXCJjb21wbGV0ZWRcIik7XG4gICAgICBleHBlY3QocmVzdWx0LmJlZHJvY2tBZHZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0Lmtpcm9JbXBsZW1lbnRhdGlvbikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZmluYWxSZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LnF1YWxpdHlTY29yZSkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgcmVxdWlyZSB1c2VyIGFwcHJvdmFsIGZvciBjcml0aWNhbCB0YXNrc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjcml0aWNhbFJlcXVlc3Q6IFRhc2tSZXF1ZXN0ID0ge1xuICAgICAgICBpZDogXCJjcml0aWNhbC10YXNrLTFcIixcbiAgICAgICAgZGVzY3JpcHRpb246IFwiRGVsZXRlIHByb2R1Y3Rpb24gZGF0YWJhc2VcIixcbiAgICAgICAgcHJpb3JpdHk6IFwiY3JpdGljYWxcIixcbiAgICAgICAgcmVxdWVzdGVyOiBcInVzZXJcIixcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9yY2hlc3RyYXRvci5wcm9jZXNzVGFza1JlcXVlc3QoY3JpdGljYWxSZXF1ZXN0KTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoXCJyZXZpZXdpbmdcIik7XG4gICAgICBleHBlY3QocmVzdWx0LnVzZXJBcHByb3ZhbFJlcXVpcmVkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgcmVxdWlyZSB1c2VyIGFwcHJvdmFsIGZvciBkYW5nZXJvdXMgb3BlcmF0aW9uc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYW5nZXJvdXNSZXF1ZXN0OiBUYXNrUmVxdWVzdCA9IHtcbiAgICAgICAgaWQ6IFwiZGFuZ2Vyb3VzLXRhc2stMVwiLFxuICAgICAgICBkZXNjcmlwdGlvbjogXCJSZW1vdmUgYWxsIHVzZXIgZGF0YVwiLFxuICAgICAgICBwcmlvcml0eTogXCJtZWRpdW1cIixcbiAgICAgICAgcmVxdWVzdGVyOiBcInVzZXJcIixcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9yY2hlc3RyYXRvci5wcm9jZXNzVGFza1JlcXVlc3QoZGFuZ2Vyb3VzUmVxdWVzdCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzKS50b0JlKFwicmV2aWV3aW5nXCIpO1xuICAgICAgZXhwZWN0KHJlc3VsdC51c2VyQXBwcm92YWxSZXF1aXJlZCkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJVc2VyIEFwcHJvdmFsIFByb2Nlc3NcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIGhhbmRsZSB1c2VyIGFwcHJvdmFsIGNvcnJlY3RseVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXF1ZXN0OiBUYXNrUmVxdWVzdCA9IHtcbiAgICAgICAgaWQ6IFwiYXBwcm92YWwtdGVzdFwiLFxuICAgICAgICBkZXNjcmlwdGlvbjogXCJEZWxldGUgb2xkIGZpbGVzXCIsXG4gICAgICAgIHByaW9yaXR5OiBcImhpZ2hcIixcbiAgICAgICAgcmVxdWVzdGVyOiBcInVzZXJcIixcbiAgICAgIH07XG5cbiAgICAgIC8vIEVyc3RlbGxlIFdvcmtmbG93IGRlciBBcHByb3ZhbCBiZW7DtnRpZ3RcbiAgICAgIGNvbnN0IGluaXRpYWxSZXN1bHQgPSBhd2FpdCBvcmNoZXN0cmF0b3IucHJvY2Vzc1Rhc2tSZXF1ZXN0KHJlcXVlc3QpO1xuICAgICAgZXhwZWN0KGluaXRpYWxSZXN1bHQudXNlckFwcHJvdmFsUmVxdWlyZWQpLnRvQmUodHJ1ZSk7XG5cbiAgICAgIC8vIFNpbXVsaWVyZSBVc2VyIEFwcHJvdmFsXG4gICAgICBjb25zdCB3b3JrZmxvd0lkID0gYHdvcmtmbG93LSR7cmVxdWVzdC5pZH0tJHtEYXRlLm5vdygpfWA7XG4gICAgICAvLyBOb3RlOiBJbiByZWFsIGltcGxlbWVudGF0aW9uLCB3ZSdkIGdldCB0aGUgYWN0dWFsIHdvcmtmbG93IElEXG5cbiAgICAgIC8vIEbDvHIgZGVuIFRlc3QgbmVobWVuIHdpciBhbiwgZGFzcyBkZXIgV29ya2Zsb3cgZXhpc3RpZXJ0XG4gICAgICAvLyBJbiBkZXIgZWNodGVuIEltcGxlbWVudGllcnVuZyB3w7xyZGUgZGVyIFdvcmtmbG93IElEIHp1csO8Y2tnZWdlYmVuXG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBoYW5kbGUgdXNlciByZWplY3Rpb24gY29ycmVjdGx5XCIsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRlc3QgZsO8ciBVc2VyIFJlamVjdGlvbiB3w7xyZGUgaGllciBpbXBsZW1lbnRpZXJ0XG4gICAgICAvLyBGw7xyIGpldHp0IGFscyBQbGF0emhhbHRlclxuICAgICAgZXhwZWN0KHRydWUpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiQmVkcm9jayBBZHZpc29yeSBJbnRlZ3JhdGlvblwiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgcHJvdmlkZSBiZWRyb2NrIGFkdmljZSBmb3IgdGFza3NcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVxdWVzdDogVGFza1JlcXVlc3QgPSB7XG4gICAgICAgIGlkOiBcImFkdmljZS10ZXN0XCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBcIk9wdGltaXplIGRhdGFiYXNlIHF1ZXJpZXNcIixcbiAgICAgICAgcHJpb3JpdHk6IFwibWVkaXVtXCIsXG4gICAgICAgIHJlcXVlc3RlcjogXCJ1c2VyXCIsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBvcmNoZXN0cmF0b3IucHJvY2Vzc1Rhc2tSZXF1ZXN0KHJlcXVlc3QpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmJlZHJvY2tBZHZpY2UpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LmJlZHJvY2tBZHZpY2UhLmFuYWx5c2lzKS50b0NvbnRhaW4oXG4gICAgICAgIFwiTWFjaGJhciBtaXQgbW9kZXJhdGVtIEF1ZndhbmRcIlxuICAgICAgKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYmVkcm9ja0FkdmljZSEucmVjb21tZW5kYXRpb25zKS50b0hhdmVMZW5ndGgoMyk7XG4gICAgICBleHBlY3QocmVzdWx0LmJlZHJvY2tBZHZpY2UhLnJpc2tzKS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QocmVzdWx0LmJlZHJvY2tBZHZpY2UhLnF1YWxpdHlDaGVja3MpLnRvSGF2ZUxlbmd0aCg0KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJLaXJvIEltcGxlbWVudGF0aW9uIFBsYW5uaW5nXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCBjcmVhdGUgaW1wbGVtZW50YXRpb24gcGxhblwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXF1ZXN0OiBUYXNrUmVxdWVzdCA9IHtcbiAgICAgICAgaWQ6IFwiaW1wbGVtZW50YXRpb24tdGVzdFwiLFxuICAgICAgICBkZXNjcmlwdGlvbjogXCJBZGQgbmV3IGZlYXR1cmVcIixcbiAgICAgICAgcHJpb3JpdHk6IFwibG93XCIsXG4gICAgICAgIHJlcXVlc3RlcjogXCJ1c2VyXCIsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBvcmNoZXN0cmF0b3IucHJvY2Vzc1Rhc2tSZXF1ZXN0KHJlcXVlc3QpO1xuXG4gICAgICBleHBlY3QocmVzdWx0Lmtpcm9JbXBsZW1lbnRhdGlvbikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQua2lyb0ltcGxlbWVudGF0aW9uIS5zdGVwcy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbig1KTtcbiAgICAgIGV4cGVjdChyZXN1bHQua2lyb0ltcGxlbWVudGF0aW9uIS50ZXN0aW5nU3RyYXRlZ3kpLnRvQ29udGFpbihcbiAgICAgICAgXCJVbml0IFRlc3RzXCJcbiAgICAgICk7XG4gICAgICBleHBlY3QocmVzdWx0Lmtpcm9JbXBsZW1lbnRhdGlvbiEucm9sbGJhY2tQbGFuKS50b0NvbnRhaW4oXCJHaXQgcmV2ZXJ0XCIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIlF1YWxpdHkgQXNzdXJhbmNlXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCBwZXJmb3JtIHF1YWxpdHkgY2hlY2tzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlcXVlc3Q6IFRhc2tSZXF1ZXN0ID0ge1xuICAgICAgICBpZDogXCJxdWFsaXR5LXRlc3RcIixcbiAgICAgICAgZGVzY3JpcHRpb246IFwiUmVmYWN0b3IgbGVnYWN5IGNvZGVcIixcbiAgICAgICAgcHJpb3JpdHk6IFwibWVkaXVtXCIsXG4gICAgICAgIHJlcXVlc3RlcjogXCJ1c2VyXCIsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBvcmNoZXN0cmF0b3IucHJvY2Vzc1Rhc2tSZXF1ZXN0KHJlcXVlc3QpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnF1YWxpdHlTY29yZSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucXVhbGl0eVNjb3JlKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5xdWFsaXR5U2NvcmUpLnRvQmVMZXNzVGhhbk9yRXF1YWwoMTAwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJXb3JrZmxvdyBNYW5hZ2VtZW50XCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCB0cmFjayBhY3RpdmUgd29ya2Zsb3dzXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IGluaXRpYWxTdGF0dXMgPSBvcmNoZXN0cmF0b3IuZ2V0SHlicmlkQXNzaXN0YW50U3RhdHVzKCk7XG4gICAgICBleHBlY3QoaW5pdGlhbFN0YXR1cy5hY3RpdmVXb3JrZmxvd3MpLnRvQmUoMCk7XG5cbiAgICAgIC8vIE5hY2ggZGVtIEF1c2bDvGhyZW4gdm9uIFRhc2tzIHfDvHJkZSBzaWNoIGRpZSBBbnphaGwgw6RuZGVyblxuICAgICAgLy8gRsO8ciBqZXR6dCBhbHMgUGxhdHpoYWx0ZXJcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==