12c0fdc70069d8210519c72025b55191
"use strict";
/**
 * Bedrock Support Mode Configuration Loader
 *
 * Loads environment-specific configuration for Bedrock support mode
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.BedrockConfigLoader = void 0;
exports.getBedrockConfig = getBedrockConfig;
exports.validateBedrockConfig = validateBedrockConfig;
/**
 * Configuration loader for Bedrock support mode
 */
class BedrockConfigLoader {
    static instance;
    config = null;
    constructor() { }
    /**
     * Get singleton instance
     */
    static getInstance() {
        if (!BedrockConfigLoader.instance) {
            BedrockConfigLoader.instance = new BedrockConfigLoader();
        }
        return BedrockConfigLoader.instance;
    }
    /**
     * Load configuration for the specified environment
     */
    loadConfig(environment) {
        if (this.config) {
            return this.config;
        }
        // Load from environment variables with fallbacks
        this.config = {
            // Feature Flags
            supportModeEnabled: this.getBooleanEnv("VITE_ENABLE_BEDROCK_SUPPORT_MODE", false),
            intelligentRoutingEnabled: this.getBooleanEnv("VITE_ENABLE_INTELLIGENT_ROUTING", true),
            directBedrockFallbackEnabled: this.getBooleanEnv("VITE_ENABLE_DIRECT_BEDROCK_FALLBACK", environment !== "development"),
            // Support Mode Configuration
            auditInterval: this.getNumberEnv("VITE_BEDROCK_AUDIT_INTERVAL", this.getDefaultAuditInterval(environment)),
            monitoringLevel: this.getStringEnv("VITE_BEDROCK_MONITORING_LEVEL", this.getDefaultMonitoringLevel(environment)),
            autoResolutionEnabled: this.getBooleanEnv("VITE_BEDROCK_AUTO_RESOLUTION_ENABLED", environment !== "production"),
            // Environment-specific settings
            debugMode: this.getBooleanEnv("VITE_BEDROCK_DEBUG_MODE", environment === "development"),
            verboseLogging: this.getBooleanEnv("VITE_BEDROCK_VERBOSE_LOGGING", environment === "development"),
            mockInfrastructureAudit: this.getBooleanEnv("VITE_BEDROCK_MOCK_INFRASTRUCTURE_AUDIT", environment === "development"),
            // AWS Configuration
            awsRegion: this.getStringEnv("VITE_AWS_REGION", "eu-central-1"),
            bedrockModelId: this.getStringEnv("VITE_BEDROCK_MODEL_ID", "anthropic.claude-3-5-sonnet-20241022-v2:0"),
            // Safety Settings
            rateLimitEnabled: this.getBooleanEnv("VITE_BEDROCK_RATE_LIMIT_ENABLED", true),
            costLimitEnabled: this.getBooleanEnv("VITE_BEDROCK_COST_LIMIT_ENABLED", true),
            maxRequestsPerMinute: this.getNumberEnv("VITE_BEDROCK_MAX_REQUESTS_PER_MINUTE", this.getDefaultRateLimit(environment)),
            // Notification Settings
            notificationChannels: this.getArrayEnv("VITE_BEDROCK_NOTIFICATION_CHANNELS", this.getDefaultNotificationChannels(environment)),
            slackWebhookUrl: this.getStringEnv("VITE_BEDROCK_SLACK_WEBHOOK_URL"),
            pagerdutyIntegrationKey: this.getStringEnv("VITE_BEDROCK_PAGERDUTY_INTEGRATION_KEY"),
            webhookUrl: this.getStringEnv("VITE_BEDROCK_WEBHOOK_URL"),
            // Production-specific settings
            circuitBreakerEnabled: this.getBooleanEnv("VITE_BEDROCK_CIRCUIT_BREAKER_ENABLED", environment === "production"),
            circuitBreakerThreshold: this.getNumberEnv("VITE_BEDROCK_CIRCUIT_BREAKER_THRESHOLD", 5),
            circuitBreakerTimeout: this.getNumberEnv("VITE_BEDROCK_CIRCUIT_BREAKER_TIMEOUT", 60000),
            auditTrailEnabled: this.getBooleanEnv("VITE_BEDROCK_AUDIT_TRAIL_ENABLED", environment === "production"),
            gdprComplianceEnabled: this.getBooleanEnv("VITE_BEDROCK_GDPR_COMPLIANCE_ENABLED", environment === "production"),
            piiDetectionEnabled: this.getBooleanEnv("VITE_BEDROCK_PII_DETECTION_ENABLED", environment === "production"),
            // Testing Configuration
            enableCanaryTesting: this.getBooleanEnv("VITE_BEDROCK_ENABLE_CANARY_TESTING", environment === "staging"),
            canaryPercentage: this.getNumberEnv("VITE_BEDROCK_CANARY_PERCENTAGE", 10),
        };
        return this.config;
    }
    /**
     * Get current configuration (must be loaded first)
     */
    getConfig() {
        if (!this.config) {
            throw new Error("Configuration not loaded. Call loadConfig() first.");
        }
        return this.config;
    }
    /**
     * Reload configuration (clears cache)
     */
    reloadConfig(environment) {
        this.config = null;
        return this.loadConfig(environment);
    }
    /**
     * Validate configuration
     */
    validateConfig(config) {
        const errors = [];
        const warnings = [];
        // Validate audit interval
        if (config.auditInterval < 60000) {
            // Less than 1 minute
            errors.push("Audit interval must be at least 60 seconds");
        }
        // Validate rate limits
        if (config.maxRequestsPerMinute < 1) {
            errors.push("Max requests per minute must be at least 1");
        }
        // Validate notification channels
        if (config.notificationChannels.length === 0) {
            warnings.push("No notification channels configured");
        }
        // Validate Slack configuration
        if (config.notificationChannels.includes("slack") &&
            !config.slackWebhookUrl) {
            warnings.push("Slack notification channel enabled but no webhook URL configured");
        }
        // Validate PagerDuty configuration
        if (config.notificationChannels.includes("pagerduty") &&
            !config.pagerdutyIntegrationKey) {
            warnings.push("PagerDuty notification channel enabled but no integration key configured");
        }
        // Validate circuit breaker settings
        if (config.circuitBreakerEnabled) {
            if (!config.circuitBreakerThreshold ||
                config.circuitBreakerThreshold < 1) {
                errors.push("Circuit breaker threshold must be at least 1");
            }
            if (!config.circuitBreakerTimeout ||
                config.circuitBreakerTimeout < 1000) {
                errors.push("Circuit breaker timeout must be at least 1000ms");
            }
        }
        return {
            isValid: errors.length === 0,
            errors,
            warnings,
        };
    }
    // Helper methods for environment variable parsing
    getBooleanEnv(key, defaultValue = false) {
        const value = this.getEnvValue(key);
        if (value === undefined)
            return defaultValue;
        return value.toLowerCase() === "true";
    }
    getNumberEnv(key, defaultValue = 0) {
        const value = this.getEnvValue(key);
        if (value === undefined)
            return defaultValue;
        const parsed = parseInt(value, 10);
        return isNaN(parsed) ? defaultValue : parsed;
    }
    getStringEnv(key, defaultValue) {
        return this.getEnvValue(key) || defaultValue;
    }
    getArrayEnv(key, defaultValue = []) {
        const value = this.getEnvValue(key);
        if (value === undefined)
            return defaultValue;
        return value
            .split(",")
            .map((item) => item.trim())
            .filter((item) => item.length > 0);
    }
    getEnvValue(key) {
        // In browser/Vite environment, check import.meta.env
        // Use dynamic evaluation to avoid Jest parsing issues
        const importMeta = this.getImportMeta();
        if (importMeta && importMeta.env) {
            return importMeta.env[key];
        }
        // Fallback to process.env for Node.js environments
        if (typeof process !== "undefined" && process.env) {
            return process.env[key];
        }
        return undefined;
    }
    getImportMeta() {
        try {
            // Safe access to import.meta without eval
            if (typeof window !== "undefined" && "import" in globalThis) {
                return globalThis.import?.meta;
            }
            return undefined;
        }
        catch (error) {
            return undefined;
        }
    }
    // Default value helpers
    getDefaultAuditInterval(environment) {
        switch (environment) {
            case "development":
                return 300000; // 5 minutes
            case "staging":
                return 600000; // 10 minutes
            case "production":
                return 1800000; // 30 minutes
            default:
                return 600000;
        }
    }
    getDefaultMonitoringLevel(environment) {
        switch (environment) {
            case "development":
                return "comprehensive";
            case "staging":
                return "detailed";
            case "production":
                return "basic";
            default:
                return "basic";
        }
    }
    getDefaultRateLimit(environment) {
        switch (environment) {
            case "development":
                return 10;
            case "staging":
                return 30;
            case "production":
                return 100;
            default:
                return 30;
        }
    }
    getDefaultNotificationChannels(environment) {
        switch (environment) {
            case "development":
                return ["console", "webhook"];
            case "staging":
                return ["slack", "webhook"];
            case "production":
                return ["slack", "pagerduty", "webhook"];
            default:
                return ["console"];
        }
    }
}
exports.BedrockConfigLoader = BedrockConfigLoader;
/**
 * Convenience function to get configuration for current environment
 */
function getBedrockConfig() {
    const loader = BedrockConfigLoader.getInstance();
    // Determine current environment
    let environment = "development";
    if (typeof process !== "undefined" && process.env) {
        const env = process.env.NODE_ENV || process.env.ENVIRONMENT;
        if (env === "production" || env === "staging") {
            environment = env;
        }
    }
    return loader.loadConfig(environment);
}
/**
 * Convenience function to validate current configuration
 */
function validateBedrockConfig() {
    const config = getBedrockConfig();
    const loader = BedrockConfigLoader.getInstance();
    return loader.validateConfig(config);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hdGJha2gtdmlzaWJpbGl0eS1ib29zdC4yMDI1MDkyMC9zcmMvbGliL2FpLW9yY2hlc3RyYXRvci9iZWRyb2NrLWNvbmZpZy1sb2FkZXIudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7OztBQXNZSCw0Q0FjQztBQUtELHNEQVFDO0FBblhEOztHQUVHO0FBQ0gsTUFBYSxtQkFBbUI7SUFDdEIsTUFBTSxDQUFDLFFBQVEsQ0FBc0I7SUFDckMsTUFBTSxHQUFvQyxJQUFJLENBQUM7SUFFdkQsZ0JBQXVCLENBQUM7SUFFeEI7O09BRUc7SUFDSCxNQUFNLENBQUMsV0FBVztRQUNoQixJQUFJLENBQUMsbUJBQW1CLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDbEMsbUJBQW1CLENBQUMsUUFBUSxHQUFHLElBQUksbUJBQW1CLEVBQUUsQ0FBQztRQUMzRCxDQUFDO1FBQ0QsT0FBTyxtQkFBbUIsQ0FBQyxRQUFRLENBQUM7SUFDdEMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsVUFBVSxDQUNSLFdBQXFEO1FBRXJELElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ2hCLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUNyQixDQUFDO1FBRUQsaURBQWlEO1FBQ2pELElBQUksQ0FBQyxNQUFNLEdBQUc7WUFDWixnQkFBZ0I7WUFDaEIsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FDcEMsa0NBQWtDLEVBQ2xDLEtBQUssQ0FDTjtZQUNELHlCQUF5QixFQUFFLElBQUksQ0FBQyxhQUFhLENBQzNDLGlDQUFpQyxFQUNqQyxJQUFJLENBQ0w7WUFDRCw0QkFBNEIsRUFBRSxJQUFJLENBQUMsYUFBYSxDQUM5QyxxQ0FBcUMsRUFDckMsV0FBVyxLQUFLLGFBQWEsQ0FDOUI7WUFFRCw2QkFBNkI7WUFDN0IsYUFBYSxFQUFFLElBQUksQ0FBQyxZQUFZLENBQzlCLDZCQUE2QixFQUM3QixJQUFJLENBQUMsdUJBQXVCLENBQUMsV0FBVyxDQUFDLENBQzFDO1lBQ0QsZUFBZSxFQUFF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QUFTLENBQUMsQ0FBQztZQUM5QixLQUFLLFlBQVk7Z0JBQ2YsT0FBTyxDQUFDLE9BQU8sRUFBRSxXQUFXLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFDM0M7Z0JBQ0UsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3ZCLENBQUM7SUFDSCxDQUFDO0NBQ0Y7QUFoVkQsa0RBZ1ZDO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQixnQkFBZ0I7SUFDOUIsTUFBTSxNQUFNLEdBQUcsbUJBQW1CLENBQUMsV0FBVyxFQUFFLENBQUM7SUFFakQsZ0NBQWdDO0lBQ2hDLElBQUksV0FBVyxHQUE2QyxhQUFhLENBQUM7SUFFMUUsSUFBSSxPQUFPLE9BQU8sS0FBSyxXQUFXLElBQUksT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ2xELE1BQU0sR0FBRyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDO1FBQzVELElBQUksR0FBRyxLQUFLLFlBQVksSUFBSSxHQUFHLEtBQUssU0FBUyxFQUFFLENBQUM7WUFDOUMsV0FBVyxHQUFHLEdBQStCLENBQUM7UUFDaEQsQ0FBQztJQUNILENBQUM7SUFFRCxPQUFPLE1BQU0sQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDeEMsQ0FBQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IscUJBQXFCO0lBS25DLE1BQU0sTUFBTSxHQUFHLGdCQUFnQixFQUFFLENBQUM7SUFDbEMsTUFBTSxNQUFNLEdBQUcsbUJBQW1CLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDakQsT0FBTyxNQUFNLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQ3ZDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL21hdGJha2gtdmlzaWJpbGl0eS1ib29zdC4yMDI1MDkyMC9zcmMvbGliL2FpLW9yY2hlc3RyYXRvci9iZWRyb2NrLWNvbmZpZy1sb2FkZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBCZWRyb2NrIFN1cHBvcnQgTW9kZSBDb25maWd1cmF0aW9uIExvYWRlclxuICpcbiAqIExvYWRzIGVudmlyb25tZW50LXNwZWNpZmljIGNvbmZpZ3VyYXRpb24gZm9yIEJlZHJvY2sgc3VwcG9ydCBtb2RlXG4gKi9cblxuZXhwb3J0IGludGVyZmFjZSBCZWRyb2NrRW52aXJvbm1lbnRDb25maWcge1xuICAvLyBGZWF0dXJlIEZsYWdzXG4gIHN1cHBvcnRNb2RlRW5hYmxlZDogYm9vbGVhbjtcbiAgaW50ZWxsaWdlbnRSb3V0aW5nRW5hYmxlZDogYm9vbGVhbjtcbiAgZGlyZWN0QmVkcm9ja0ZhbGxiYWNrRW5hYmxlZDogYm9vbGVhbjtcblxuICAvLyBTdXBwb3J0IE1vZGUgQ29uZmlndXJhdGlvblxuICBhdWRpdEludGVydmFsOiBudW1iZXI7XG4gIG1vbml0b3JpbmdMZXZlbDogXCJiYXNpY1wiIHwgXCJkZXRhaWxlZFwiIHwgXCJjb21wcmVoZW5zaXZlXCI7XG4gIGF1dG9SZXNvbHV0aW9uRW5hYmxlZDogYm9vbGVhbjtcblxuICAvLyBFbnZpcm9ubWVudC1zcGVjaWZpYyBzZXR0aW5nc1xuICBkZWJ1Z01vZGU6IGJvb2xlYW47XG4gIHZlcmJvc2VMb2dnaW5nOiBib29sZWFuO1xuICBtb2NrSW5mcmFzdHJ1Y3R1cmVBdWRpdDogYm9vbGVhbjtcblxuICAvLyBBV1MgQ29uZmlndXJhdGlvblxuICBhd3NSZWdpb246IHN0cmluZztcbiAgYmVkcm9ja01vZGVsSWQ6IHN0cmluZztcblxuICAvLyBTYWZldHkgU2V0dGluZ3NcbiAgcmF0ZUxpbWl0RW5hYmxlZDogYm9vbGVhbjtcbiAgY29zdExpbWl0RW5hYmxlZDogYm9vbGVhbjtcbiAgbWF4UmVxdWVzdHNQZXJNaW51dGU6IG51bWJlcjtcblxuICAvLyBOb3RpZmljYXRpb24gU2V0dGluZ3NcbiAgbm90aWZpY2F0aW9uQ2hhbm5lbHM6IHN0cmluZ1tdO1xuICBzbGFja1dlYmhvb2tVcmw/OiBzdHJpbmc7XG4gIHBhZ2VyZHV0eUludGVncmF0aW9uS2V5Pzogc3RyaW5nO1xuICB3ZWJob29rVXJsPzogc3RyaW5nO1xuXG4gIC8vIEFkZGl0aW9uYWwgUHJvZHVjdGlvbiBTZXR0aW5nc1xuICBjaXJjdWl0QnJlYWtlckVuYWJsZWQ/OiBib29sZWFuO1xuICBjaXJjdWl0QnJlYWtlclRocmVzaG9sZD86IG51bWJlcjtcbiAgY2lyY3VpdEJyZWFrZXJUaW1lb3V0PzogbnVtYmVyO1xuICBhdWRpdFRyYWlsRW5hYmxlZD86IGJvb2xlYW47XG4gIGdkcHJDb21wbGlhbmNlRW5hYmxlZD86IGJvb2xlYW47XG4gIHBpaURldGVjdGlvbkVuYWJsZWQ/OiBib29sZWFuO1xuXG4gIC8vIFRlc3RpbmcgQ29uZmlndXJhdGlvblxuICBlbmFibGVDYW5hcnlUZXN0aW5nPzogYm9vbGVhbjtcbiAgY2FuYXJ5UGVyY2VudGFnZT86IG51bWJlcjtcbn1cblxuLyoqXG4gKiBDb25maWd1cmF0aW9uIGxvYWRlciBmb3IgQmVkcm9jayBzdXBwb3J0IG1vZGVcbiAqL1xuZXhwb3J0IGNsYXNzIEJlZHJvY2tDb25maWdMb2FkZXIge1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogQmVkcm9ja0NvbmZpZ0xvYWRlcjtcbiAgcHJpdmF0ZSBjb25maWc6IEJlZHJvY2tFbnZpcm9ubWVudENvbmZpZyB8IG51bGwgPSBudWxsO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IoKSB7fVxuXG4gIC8qKlxuICAgKiBHZXQgc2luZ2xldG9uIGluc3RhbmNlXG4gICAqL1xuICBzdGF0aWMgZ2V0SW5zdGFuY2UoKTogQmVkcm9ja0NvbmZpZ0xvYWRlciB7XG4gICAgaWYgKCFCZWRyb2NrQ29uZmlnTG9hZGVyLmluc3RhbmNlKSB7XG4gICAgICBCZWRyb2NrQ29uZmlnTG9hZGVyLmluc3RhbmNlID0gbmV3IEJlZHJvY2tDb25maWdMb2FkZXIoKTtcbiAgICB9XG4gICAgcmV0dXJuIEJlZHJvY2tDb25maWdMb2FkZXIuaW5zdGFuY2U7XG4gIH1cblxuICAvKipcbiAgICogTG9hZCBjb25maWd1cmF0aW9uIGZvciB0aGUgc3BlY2lmaWVkIGVudmlyb25tZW50XG4gICAqL1xuICBsb2FkQ29uZmlnKFxuICAgIGVudmlyb25tZW50OiBcImRldmVsb3BtZW50XCIgfCBcInN0YWdpbmdcIiB8IFwicHJvZHVjdGlvblwiXG4gICk6IEJlZHJvY2tFbnZpcm9ubWVudENvbmZpZyB7XG4gICAgaWYgKHRoaXMuY29uZmlnKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb25maWc7XG4gICAgfVxuXG4gICAgLy8gTG9hZCBmcm9tIGVudmlyb25tZW50IHZhcmlhYmxlcyB3aXRoIGZhbGxiYWNrc1xuICAgIHRoaXMuY29uZmlnID0ge1xuICAgICAgLy8gRmVhdHVyZSBGbGFnc1xuICAgICAgc3VwcG9ydE1vZGVFbmFibGVkOiB0aGlzLmdldEJvb2xlYW5FbnYoXG4gICAgICAgIFwiVklURV9FTkFCTEVfQkVEUk9DS19TVVBQT1JUX01PREVcIixcbiAgICAgICAgZmFsc2VcbiAgICAgICksXG4gICAgICBpbnRlbGxpZ2VudFJvdXRpbmdFbmFibGVkOiB0aGlzLmdldEJvb2xlYW5FbnYoXG4gICAgICAgIFwiVklURV9FTkFCTEVfSU5URUxMSUdFTlRfUk9VVElOR1wiLFxuICAgICAgICB0cnVlXG4gICAgICApLFxuICAgICAgZGlyZWN0QmVkcm9ja0ZhbGxiYWNrRW5hYmxlZDogdGhpcy5nZXRCb29sZWFuRW52KFxuICAgICAgICBcIlZJVEVfRU5BQkxFX0RJUkVDVF9CRURST0NLX0ZBTExCQUNLXCIsXG4gICAgICAgIGVudmlyb25tZW50ICE9PSBcImRldmVsb3BtZW50XCJcbiAgICAgICksXG5cbiAgICAgIC8vIFN1cHBvcnQgTW9kZSBDb25maWd1cmF0aW9uXG4gICAgICBhdWRpdEludGVydmFsOiB0aGlzLmdldE51bWJlckVudihcbiAgICAgICAgXCJWSVRFX0JFRFJPQ0tfQVVESVRfSU5URVJWQUxcIixcbiAgICAgICAgdGhpcy5nZXREZWZhdWx0QXVkaXRJbnRlcnZhbChlbnZpcm9ubWVudClcbiAgICAgICksXG4gICAgICBtb25pdG9yaW5nTGV2ZWw6IHRoaXMuZ2V0U3RyaW5nRW52KFxuICAgICAgICBcIlZJVEVfQkVEUk9DS19NT05JVE9SSU5HX0xFVkVMXCIsXG4gICAgICAgIHRoaXMuZ2V0RGVmYXVsdE1vbml0b3JpbmdMZXZlbChlbnZpcm9ubWVudClcbiAgICAgICkgYXMgXCJiYXNpY1wiIHwgXCJkZXRhaWxlZFwiIHwgXCJjb21wcmVoZW5zaXZlXCIsXG4gICAgICBhdXRvUmVzb2x1dGlvbkVuYWJsZWQ6IHRoaXMuZ2V0Qm9vbGVhbkVudihcbiAgICAgICAgXCJWSVRFX0JFRFJPQ0tfQVVUT19SRVNPTFVUSU9OX0VOQUJMRURcIixcbiAgICAgICAgZW52aXJvbm1lbnQgIT09IFwicHJvZHVjdGlvblwiXG4gICAgICApLFxuXG4gICAgICAvLyBFbnZpcm9ubWVudC1zcGVjaWZpYyBzZXR0aW5nc1xuICAgICAgZGVidWdNb2RlOiB0aGlzLmdldEJvb2xlYW5FbnYoXG4gICAgICAgIFwiVklURV9CRURST0NLX0RFQlVHX01PREVcIixcbiAgICAgICAgZW52aXJvbm1lbnQgPT09IFwiZGV2ZWxvcG1lbnRcIlxuICAgICAgKSxcbiAgICAgIHZlcmJvc2VMb2dnaW5nOiB0aGlzLmdldEJvb2xlYW5FbnYoXG4gICAgICAgIFwiVklURV9CRURST0NLX1ZFUkJPU0VfTE9HR0lOR1wiLFxuICAgICAgICBlbnZpcm9ubWVudCA9PT0gXCJkZXZlbG9wbWVudFwiXG4gICAgICApLFxuICAgICAgbW9ja0luZnJhc3RydWN0dXJlQXVkaXQ6IHRoaXMuZ2V0Qm9vbGVhbkVudihcbiAgICAgICAgXCJWSVRFX0JFRFJPQ0tfTU9DS19JTkZSQVNUUlVDVFVSRV9BVURJVFwiLFxuICAgICAgICBlbnZpcm9ubWVudCA9PT0gXCJkZXZlbG9wbWVudFwiXG4gICAgICApLFxuXG4gICAgICAvLyBBV1MgQ29uZmlndXJhdGlvblxuICAgICAgYXdzUmVnaW9uOiB0aGlzLmdldFN0cmluZ0VudihcIlZJVEVfQVdTX1JFR0lPTlwiLCBcImV1LWNlbnRyYWwtMVwiKSxcbiAgICAgIGJlZHJvY2tNb2RlbElkOiB0aGlzLmdldFN0cmluZ0VudihcbiAgICAgICAgXCJWSVRFX0JFRFJPQ0tfTU9ERUxfSURcIixcbiAgICAgICAgXCJhbnRocm9waWMuY2xhdWRlLTMtNS1zb25uZXQtMjAyNDEwMjItdjI6MFwiXG4gICAgICApLFxuXG4gICAgICAvLyBTYWZldHkgU2V0dGluZ3NcbiAgICAgIHJhdGVMaW1pdEVuYWJsZWQ6IHRoaXMuZ2V0Qm9vbGVhbkVudihcbiAgICAgICAgXCJWSVRFX0JFRFJPQ0tfUkFURV9MSU1JVF9FTkFCTEVEXCIsXG4gICAgICAgIHRydWVcbiAgICAgICksXG4gICAgICBjb3N0TGltaXRFbmFibGVkOiB0aGlzLmdldEJvb2xlYW5FbnYoXG4gICAgICAgIFwiVklURV9CRURST0NLX0NPU1RfTElNSVRfRU5BQkxFRFwiLFxuICAgICAgICB0cnVlXG4gICAgICApLFxuICAgICAgbWF4UmVxdWVzdHNQZXJNaW51dGU6IHRoaXMuZ2V0TnVtYmVyRW52KFxuICAgICAgICBcIlZJVEVfQkVEUk9DS19NQVhfUkVRVUVTVFNfUEVSX01JTlVURVwiLFxuICAgICAgICB0aGlzLmdldERlZmF1bHRSYXRlTGltaXQoZW52aXJvbm1lbnQpXG4gICAgICApLFxuXG4gICAgICAvLyBOb3RpZmljYXRpb24gU2V0dGluZ3NcbiAgICAgIG5vdGlmaWNhdGlvbkNoYW5uZWxzOiB0aGlzLmdldEFycmF5RW52KFxuICAgICAgICBcIlZJVEVfQkVEUk9DS19OT1RJRklDQVRJT05fQ0hBTk5FTFNcIixcbiAgICAgICAgdGhpcy5nZXREZWZhdWx0Tm90aWZpY2F0aW9uQ2hhbm5lbHMoZW52aXJvbm1lbnQpXG4gICAgICApLFxuICAgICAgc2xhY2tXZWJob29rVXJsOiB0aGlzLmdldFN0cmluZ0VudihcIlZJVEVfQkVEUk9DS19TTEFDS19XRUJIT09LX1VSTFwiKSxcbiAgICAgIHBhZ2VyZHV0eUludGVncmF0aW9uS2V5OiB0aGlzLmdldFN0cmluZ0VudihcbiAgICAgICAgXCJWSVRFX0JFRFJPQ0tfUEFHRVJEVVRZX0lOVEVHUkFUSU9OX0tFWVwiXG4gICAgICApLFxuICAgICAgd2ViaG9va1VybDogdGhpcy5nZXRTdHJpbmdFbnYoXCJWSVRFX0JFRFJPQ0tfV0VCSE9PS19VUkxcIiksXG5cbiAgICAgIC8vIFByb2R1Y3Rpb24tc3BlY2lmaWMgc2V0dGluZ3NcbiAgICAgIGNpcmN1aXRCcmVha2VyRW5hYmxlZDogdGhpcy5nZXRCb29sZWFuRW52KFxuICAgICAgICBcIlZJVEVfQkVEUk9DS19DSVJDVUlUX0JSRUFLRVJfRU5BQkxFRFwiLFxuICAgICAgICBlbnZpcm9ubWVudCA9PT0gXCJwcm9kdWN0aW9uXCJcbiAgICAgICksXG4gICAgICBjaXJjdWl0QnJlYWtlclRocmVzaG9sZDogdGhpcy5nZXROdW1iZXJFbnYoXG4gICAgICAgIFwiVklURV9CRURST0NLX0NJUkNVSVRfQlJFQUtFUl9USFJFU0hPTERcIixcbiAgICAgICAgNVxuICAgICAgKSxcbiAgICAgIGNpcmN1aXRCcmVha2VyVGltZW91dDogdGhpcy5nZXROdW1iZXJFbnYoXG4gICAgICAgIFwiVklURV9CRURST0NLX0NJUkNVSVRfQlJFQUtFUl9USU1FT1VUXCIsXG4gICAgICAgIDYwMDAwXG4gICAgICApLFxuICAgICAgYXVkaXRUcmFpbEVuYWJsZWQ6IHRoaXMuZ2V0Qm9vbGVhbkVudihcbiAgICAgICAgXCJWSVRFX0JFRFJPQ0tfQVVESVRfVFJBSUxfRU5BQkxFRFwiLFxuICAgICAgICBlbnZpcm9ubWVudCA9PT0gXCJwcm9kdWN0aW9uXCJcbiAgICAgICksXG4gICAgICBnZHByQ29tcGxpYW5jZUVuYWJsZWQ6IHRoaXMuZ2V0Qm9vbGVhbkVudihcbiAgICAgICAgXCJWSVRFX0JFRFJPQ0tfR0RQUl9DT01QTElBTkNFX0VOQUJMRURcIixcbiAgICAgICAgZW52aXJvbm1lbnQgPT09IFwicHJvZHVjdGlvblwiXG4gICAgICApLFxuICAgICAgcGlpRGV0ZWN0aW9uRW5hYmxlZDogdGhpcy5nZXRCb29sZWFuRW52KFxuICAgICAgICBcIlZJVEVfQkVEUk9DS19QSUlfREVURUNUSU9OX0VOQUJMRURcIixcbiAgICAgICAgZW52aXJvbm1lbnQgPT09IFwicHJvZHVjdGlvblwiXG4gICAgICApLFxuXG4gICAgICAvLyBUZXN0aW5nIENvbmZpZ3VyYXRpb25cbiAgICAgIGVuYWJsZUNhbmFyeVRlc3Rpbmc6IHRoaXMuZ2V0Qm9vbGVhbkVudihcbiAgICAgICAgXCJWSVRFX0JFRFJPQ0tfRU5BQkxFX0NBTkFSWV9URVNUSU5HXCIsXG4gICAgICAgIGVudmlyb25tZW50ID09PSBcInN0YWdpbmdcIlxuICAgICAgKSxcbiAgICAgIGNhbmFyeVBlcmNlbnRhZ2U6IHRoaXMuZ2V0TnVtYmVyRW52KFwiVklURV9CRURST0NLX0NBTkFSWV9QRVJDRU5UQUdFXCIsIDEwKSxcbiAgICB9O1xuXG4gICAgcmV0dXJuIHRoaXMuY29uZmlnO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IGNvbmZpZ3VyYXRpb24gKG11c3QgYmUgbG9hZGVkIGZpcnN0KVxuICAgKi9cbiAgZ2V0Q29uZmlnKCk6IEJlZHJvY2tFbnZpcm9ubWVudENvbmZpZyB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ29uZmlndXJhdGlvbiBub3QgbG9hZGVkLiBDYWxsIGxvYWRDb25maWcoKSBmaXJzdC5cIik7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmNvbmZpZztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWxvYWQgY29uZmlndXJhdGlvbiAoY2xlYXJzIGNhY2hlKVxuICAgKi9cbiAgcmVsb2FkQ29uZmlnKFxuICAgIGVudmlyb25tZW50OiBcImRldmVsb3BtZW50XCIgfCBcInN0YWdpbmdcIiB8IFwicHJvZHVjdGlvblwiXG4gICk6IEJlZHJvY2tFbnZpcm9ubWVudENvbmZpZyB7XG4gICAgdGhpcy5jb25maWcgPSBudWxsO1xuICAgIHJldHVybiB0aGlzLmxvYWRDb25maWcoZW52aXJvbm1lbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIHZhbGlkYXRlQ29uZmlnKGNvbmZpZzogQmVkcm9ja0Vudmlyb25tZW50Q29uZmlnKToge1xuICAgIGlzVmFsaWQ6IGJvb2xlYW47XG4gICAgZXJyb3JzOiBzdHJpbmdbXTtcbiAgICB3YXJuaW5nczogc3RyaW5nW107XG4gIH0ge1xuICAgIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCB3YXJuaW5nczogc3RyaW5nW10gPSBbXTtcblxuICAgIC8vIFZhbGlkYXRlIGF1ZGl0IGludGVydmFsXG4gICAgaWYgKGNvbmZpZy5hdWRpdEludGVydmFsIDwgNjAwMDApIHtcbiAgICAgIC8vIExlc3MgdGhhbiAxIG1pbnV0ZVxuICAgICAgZXJyb3JzLnB1c2goXCJBdWRpdCBpbnRlcnZhbCBtdXN0IGJlIGF0IGxlYXN0IDYwIHNlY29uZHNcIik7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgcmF0ZSBsaW1pdHNcbiAgICBpZiAoY29uZmlnLm1heFJlcXVlc3RzUGVyTWludXRlIDwgMSkge1xuICAgICAgZXJyb3JzLnB1c2goXCJNYXggcmVxdWVzdHMgcGVyIG1pbnV0ZSBtdXN0IGJlIGF0IGxlYXN0IDFcIik7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgbm90aWZpY2F0aW9uIGNoYW5uZWxzXG4gICAgaWYgKGNvbmZpZy5ub3RpZmljYXRpb25DaGFubmVscy5sZW5ndGggPT09IDApIHtcbiAgICAgIHdhcm5pbmdzLnB1c2goXCJObyBub3RpZmljYXRpb24gY2hhbm5lbHMgY29uZmlndXJlZFwiKTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBTbGFjayBjb25maWd1cmF0aW9uXG4gICAgaWYgKFxuICAgICAgY29uZmlnLm5vdGlmaWNhdGlvbkNoYW5uZWxzLmluY2x1ZGVzKFwic2xhY2tcIikgJiZcbiAgICAgICFjb25maWcuc2xhY2tXZWJob29rVXJsXG4gICAgKSB7XG4gICAgICB3YXJuaW5ncy5wdXNoKFxuICAgICAgICBcIlNsYWNrIG5vdGlmaWNhdGlvbiBjaGFubmVsIGVuYWJsZWQgYnV0IG5vIHdlYmhvb2sgVVJMIGNvbmZpZ3VyZWRcIlxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBQYWdlckR1dHkgY29uZmlndXJhdGlvblxuICAgIGlmIChcbiAgICAgIGNvbmZpZy5ub3RpZmljYXRpb25DaGFubmVscy5pbmNsdWRlcyhcInBhZ2VyZHV0eVwiKSAmJlxuICAgICAgIWNvbmZpZy5wYWdlcmR1dHlJbnRlZ3JhdGlvbktleVxuICAgICkge1xuICAgICAgd2FybmluZ3MucHVzaChcbiAgICAgICAgXCJQYWdlckR1dHkgbm90aWZpY2F0aW9uIGNoYW5uZWwgZW5hYmxlZCBidXQgbm8gaW50ZWdyYXRpb24ga2V5IGNvbmZpZ3VyZWRcIlxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBjaXJjdWl0IGJyZWFrZXIgc2V0dGluZ3NcbiAgICBpZiAoY29uZmlnLmNpcmN1aXRCcmVha2VyRW5hYmxlZCkge1xuICAgICAgaWYgKFxuICAgICAgICAhY29uZmlnLmNpcmN1aXRCcmVha2VyVGhyZXNob2xkIHx8XG4gICAgICAgIGNvbmZpZy5jaXJjdWl0QnJlYWtlclRocmVzaG9sZCA8IDFcbiAgICAgICkge1xuICAgICAgICBlcnJvcnMucHVzaChcIkNpcmN1aXQgYnJlYWtlciB0aHJlc2hvbGQgbXVzdCBiZSBhdCBsZWFzdCAxXCIpO1xuICAgICAgfVxuICAgICAgaWYgKFxuICAgICAgICAhY29uZmlnLmNpcmN1aXRCcmVha2VyVGltZW91dCB8fFxuICAgICAgICBjb25maWcuY2lyY3VpdEJyZWFrZXJUaW1lb3V0IDwgMTAwMFxuICAgICAgKSB7XG4gICAgICAgIGVycm9ycy5wdXNoKFwiQ2lyY3VpdCBicmVha2VyIHRpbWVvdXQgbXVzdCBiZSBhdCBsZWFzdCAxMDAwbXNcIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGlzVmFsaWQ6IGVycm9ycy5sZW5ndGggPT09IDAsXG4gICAgICBlcnJvcnMsXG4gICAgICB3YXJuaW5ncyxcbiAgICB9O1xuICB9XG5cbiAgLy8gSGVscGVyIG1ldGhvZHMgZm9yIGVudmlyb25tZW50IHZhcmlhYmxlIHBhcnNpbmdcbiAgcHJpdmF0ZSBnZXRCb29sZWFuRW52KGtleTogc3RyaW5nLCBkZWZhdWx0VmFsdWU6IGJvb2xlYW4gPSBmYWxzZSk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHZhbHVlID0gdGhpcy5nZXRFbnZWYWx1ZShrZXkpO1xuICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gZGVmYXVsdFZhbHVlO1xuICAgIHJldHVybiB2YWx1ZS50b0xvd2VyQ2FzZSgpID09PSBcInRydWVcIjtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0TnVtYmVyRW52KGtleTogc3RyaW5nLCBkZWZhdWx0VmFsdWU6IG51bWJlciA9IDApOiBudW1iZXIge1xuICAgIGNvbnN0IHZhbHVlID0gdGhpcy5nZXRFbnZWYWx1ZShrZXkpO1xuICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gZGVmYXVsdFZhbHVlO1xuICAgIGNvbnN0IHBhcnNlZCA9IHBhcnNlSW50KHZhbHVlLCAxMCk7XG4gICAgcmV0dXJuIGlzTmFOKHBhcnNlZCkgPyBkZWZhdWx0VmFsdWUgOiBwYXJzZWQ7XG4gIH1cblxuICBwcml2YXRlIGdldFN0cmluZ0VudihrZXk6IHN0cmluZywgZGVmYXVsdFZhbHVlPzogc3RyaW5nKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5nZXRFbnZWYWx1ZShrZXkpIHx8IGRlZmF1bHRWYWx1ZTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0QXJyYXlFbnYoa2V5OiBzdHJpbmcsIGRlZmF1bHRWYWx1ZTogc3RyaW5nW10gPSBbXSk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0RW52VmFsdWUoa2V5KTtcbiAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbiAgICByZXR1cm4gdmFsdWVcbiAgICAgIC5zcGxpdChcIixcIilcbiAgICAgIC5tYXAoKGl0ZW0pID0+IGl0ZW0udHJpbSgpKVxuICAgICAgLmZpbHRlcigoaXRlbSkgPT4gaXRlbS5sZW5ndGggPiAwKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0RW52VmFsdWUoa2V5OiBzdHJpbmcpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIC8vIEluIGJyb3dzZXIvVml0ZSBlbnZpcm9ubWVudCwgY2hlY2sgaW1wb3J0Lm1ldGEuZW52XG4gICAgLy8gVXNlIGR5bmFtaWMgZXZhbHVhdGlvbiB0byBhdm9pZCBKZXN0IHBhcnNpbmcgaXNzdWVzXG4gICAgY29uc3QgaW1wb3J0TWV0YSA9IHRoaXMuZ2V0SW1wb3J0TWV0YSgpO1xuICAgIGlmIChpbXBvcnRNZXRhICYmIGltcG9ydE1ldGEuZW52KSB7XG4gICAgICByZXR1cm4gaW1wb3J0TWV0YS5lbnZba2V5XTtcbiAgICB9XG5cbiAgICAvLyBGYWxsYmFjayB0byBwcm9jZXNzLmVudiBmb3IgTm9kZS5qcyBlbnZpcm9ubWVudHNcbiAgICBpZiAodHlwZW9mIHByb2Nlc3MgIT09IFwidW5kZWZpbmVkXCIgJiYgcHJvY2Vzcy5lbnYpIHtcbiAgICAgIHJldHVybiBwcm9jZXNzLmVudltrZXldO1xuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBwcml2YXRlIGdldEltcG9ydE1ldGEoKTogYW55IHtcbiAgICB0cnkge1xuICAgICAgLy8gU2FmZSBhY2Nlc3MgdG8gaW1wb3J0Lm1ldGEgd2l0aG91dCBldmFsXG4gICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiAmJiBcImltcG9ydFwiIGluIGdsb2JhbFRoaXMpIHtcbiAgICAgICAgcmV0dXJuIChnbG9iYWxUaGlzIGFzIGFueSkuaW1wb3J0Py5tZXRhO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cblxuICAvLyBEZWZhdWx0IHZhbHVlIGhlbHBlcnNcbiAgcHJpdmF0ZSBnZXREZWZhdWx0QXVkaXRJbnRlcnZhbChlbnZpcm9ubWVudDogc3RyaW5nKTogbnVtYmVyIHtcbiAgICBzd2l0Y2ggKGVudmlyb25tZW50KSB7XG4gICAgICBjYXNlIFwiZGV2ZWxvcG1lbnRcIjpcbiAgICAgICAgcmV0dXJuIDMwMDAwMDsgLy8gNSBtaW51dGVzXG4gICAgICBjYXNlIFwic3RhZ2luZ1wiOlxuICAgICAgICByZXR1cm4gNjAwMDAwOyAvLyAxMCBtaW51dGVzXG4gICAgICBjYXNlIFwicHJvZHVjdGlvblwiOlxuICAgICAgICByZXR1cm4gMTgwMDAwMDsgLy8gMzAgbWludXRlc1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIDYwMDAwMDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldERlZmF1bHRNb25pdG9yaW5nTGV2ZWwoZW52aXJvbm1lbnQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgc3dpdGNoIChlbnZpcm9ubWVudCkge1xuICAgICAgY2FzZSBcImRldmVsb3BtZW50XCI6XG4gICAgICAgIHJldHVybiBcImNvbXByZWhlbnNpdmVcIjtcbiAgICAgIGNhc2UgXCJzdGFnaW5nXCI6XG4gICAgICAgIHJldHVybiBcImRldGFpbGVkXCI7XG4gICAgICBjYXNlIFwicHJvZHVjdGlvblwiOlxuICAgICAgICByZXR1cm4gXCJiYXNpY1wiO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIFwiYmFzaWNcIjtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldERlZmF1bHRSYXRlTGltaXQoZW52aXJvbm1lbnQ6IHN0cmluZyk6IG51bWJlciB7XG4gICAgc3dpdGNoIChlbnZpcm9ubWVudCkge1xuICAgICAgY2FzZSBcImRldmVsb3BtZW50XCI6XG4gICAgICAgIHJldHVybiAxMDtcbiAgICAgIGNhc2UgXCJzdGFnaW5nXCI6XG4gICAgICAgIHJldHVybiAzMDtcbiAgICAgIGNhc2UgXCJwcm9kdWN0aW9uXCI6XG4gICAgICAgIHJldHVybiAxMDA7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gMzA7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXREZWZhdWx0Tm90aWZpY2F0aW9uQ2hhbm5lbHMoZW52aXJvbm1lbnQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICBzd2l0Y2ggKGVudmlyb25tZW50KSB7XG4gICAgICBjYXNlIFwiZGV2ZWxvcG1lbnRcIjpcbiAgICAgICAgcmV0dXJuIFtcImNvbnNvbGVcIiwgXCJ3ZWJob29rXCJdO1xuICAgICAgY2FzZSBcInN0YWdpbmdcIjpcbiAgICAgICAgcmV0dXJuIFtcInNsYWNrXCIsIFwid2ViaG9va1wiXTtcbiAgICAgIGNhc2UgXCJwcm9kdWN0aW9uXCI6XG4gICAgICAgIHJldHVybiBbXCJzbGFja1wiLCBcInBhZ2VyZHV0eVwiLCBcIndlYmhvb2tcIl07XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gW1wiY29uc29sZVwiXTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBDb252ZW5pZW5jZSBmdW5jdGlvbiB0byBnZXQgY29uZmlndXJhdGlvbiBmb3IgY3VycmVudCBlbnZpcm9ubWVudFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0QmVkcm9ja0NvbmZpZygpOiBCZWRyb2NrRW52aXJvbm1lbnRDb25maWcge1xuICBjb25zdCBsb2FkZXIgPSBCZWRyb2NrQ29uZmlnTG9hZGVyLmdldEluc3RhbmNlKCk7XG5cbiAgLy8gRGV0ZXJtaW5lIGN1cnJlbnQgZW52aXJvbm1lbnRcbiAgbGV0IGVudmlyb25tZW50OiBcImRldmVsb3BtZW50XCIgfCBcInN0YWdpbmdcIiB8IFwicHJvZHVjdGlvblwiID0gXCJkZXZlbG9wbWVudFwiO1xuXG4gIGlmICh0eXBlb2YgcHJvY2VzcyAhPT0gXCJ1bmRlZmluZWRcIiAmJiBwcm9jZXNzLmVudikge1xuICAgIGNvbnN0IGVudiA9IHByb2Nlc3MuZW52Lk5PREVfRU5WIHx8IHByb2Nlc3MuZW52LkVOVklST05NRU5UO1xuICAgIGlmIChlbnYgPT09IFwicHJvZHVjdGlvblwiIHx8IGVudiA9PT0gXCJzdGFnaW5nXCIpIHtcbiAgICAgIGVudmlyb25tZW50ID0gZW52IGFzIFwicHJvZHVjdGlvblwiIHwgXCJzdGFnaW5nXCI7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGxvYWRlci5sb2FkQ29uZmlnKGVudmlyb25tZW50KTtcbn1cblxuLyoqXG4gKiBDb252ZW5pZW5jZSBmdW5jdGlvbiB0byB2YWxpZGF0ZSBjdXJyZW50IGNvbmZpZ3VyYXRpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlQmVkcm9ja0NvbmZpZygpOiB7XG4gIGlzVmFsaWQ6IGJvb2xlYW47XG4gIGVycm9yczogc3RyaW5nW107XG4gIHdhcm5pbmdzOiBzdHJpbmdbXTtcbn0ge1xuICBjb25zdCBjb25maWcgPSBnZXRCZWRyb2NrQ29uZmlnKCk7XG4gIGNvbnN0IGxvYWRlciA9IEJlZHJvY2tDb25maWdMb2FkZXIuZ2V0SW5zdGFuY2UoKTtcbiAgcmV0dXJuIGxvYWRlci52YWxpZGF0ZUNvbmZpZyhjb25maWcpO1xufVxuIl0sInZlcnNpb24iOjN9